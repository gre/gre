<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="GaÃ«tan Renaudeau"/><meta name="description" content="This article is the first of a series of small articles on the Q Javascript library and its eco-system. It is a brief introduction to Q Promises."/><meta name="keywords" content="AWOP, javascript, promise, Q, library"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Qep1.: Q, a Promise library"/><meta name="og:title" content="Qep1.: Q, a Promise library"/><meta name="twitter:description" content="This article is the first of a series of small articles on the Q Javascript library and its eco-system. It is a brief introduction to Q Promises."/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2013/07/promise_then_thumbnail.jpg"/><meta name="twitter:image" content="http://greweb.me//images/2013/07/promise_then_thumbnail.jpg"/><link rel="image_src" href="http://greweb.me//images/2013/07/promise_then_thumbnail.jpg"/><title>@greweb - Qep1.: Q, a Promise library</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-11911496995bbdbf52b1.js" defer=""></script><script src="/_next/static/chunks/framework-c93ed74a065331c4bd75.js" defer=""></script><script src="/_next/static/chunks/main-005750ed97c879f2d59b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-092526a60f8cb7d1b3d6.js" defer=""></script><script src="/_next/static/chunks/988-83f401159b53b3fa4628.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-cd0de5438621b7e4f378.js" defer=""></script><script src="/_next/static/xTexrK-zb8emnM7r0hooR/_buildManifest.js" defer=""></script><script src="/_next/static/xTexrK-zb8emnM7r0hooR/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Qep1.: Q, a Promise library</a></h1><time class="date" dateTime="2013-07-10">2013-07-10</time><span class="tags"><a class="tag">AWOP</a><a class="tag">javascript</a><a class="tag">promise</a><a class="tag">Q</a><a class="tag">library</a></span></header><div class="entry-content"><h1 id="a-world-of-promises-episode-1"><a href="/pages/a-world-of-promises/">A World Of Promises</a>, episode 1</h1>
<p><em>This article is the first of a series of small articles 
on the Q Javascript library and its eco-system.
This article is a brief introduction to Q Promises.</em></p>
<img src="/images/2013/07/promise_then_thumbnail.jpg" alt="" class="thumbnail-left" />

<p><a href="http://github.com/kriskowal/q">Q</a> is a <strong>Promise library</strong> in <strong>Javascript</strong> 
created 4 years ago by <a href="https://github.com/kriskowal">Kris Kowal</a> who is one of the main contributor to <a href="http://wiki.commonjs.org/">CommonJS</a>
where we can find the <strong><a href="http://wiki.commonjs.org/wiki/Promises/A">Promises/A</a></strong> specification.</p>
<p><a href="http://github.com/kriskowal/q">Q</a> is probably <strong>the most mature and powerful Promise library in Javascript</strong>
which inspired a lot of libraries like <a href="http://jquery.com/">jQuery</a>.
It exposes a complete API with, in my humble opinion, 
good ideas like the separation of concerns between a &quot;Deferred&quot; object (the resolver) 
and a &quot;Thenable&quot; Promise (the read-only promise).</p>
<p>This article is a brief introduction to Q Promises with some examples.
For more information on the subject, I highly recommend reading
the article <a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/">&quot;You&#39;re Missing the Point of Promises&quot;</a> 
and <a href="https://raw.github.com/kriskowal/q/master/design/README.js">the Q implementation design README</a>.</p>
<!--more-->

<h2 id="what-is-a-promise">What is a Promise</h2>
<p>A <strong>Promise</strong> is an object representing a <strong>possible future value</strong> which has 
a <code>then</code> method to access this value via callback. A Promise is initially 
in a <em>pending</em> state and is then either <em>fulfilled</em> with a value or <em>rejected</em> with an error.</p>
<p><img src="/images/2013/07/promise.png" alt="Schema representing Promise states: pending -&gt; fulfilled|rejected"></p>
<h3 id="some-properties">Some properties</h3>
<p>It is <strong>immutable</strong> because the Promise value never changes and each <code>then</code> creates a new Promise. 
As a consequence, one same Promise can be shared between different code.</p>
<p>It is <strong>chainable</strong> through the <code>then</code> method (and other Q shortcut methods),
which transforms a Promise into a new Promise without knowing what&#39;s inside.</p>
<p>It is <strong>composable</strong> because the <code>then</code> method will unify any Promise returned as 
a result of the callback with the current Promise (act like a map or flatmap). 
<a href="http://github.com/kriskowal/q">Q</a> also has a <code>Q.all</code> helper for combining an Array of Promise into one big Promise.</p>
<h2 id="a-solution-against-the-pyramid-of-doom-effect">A solution against the <a href="http://tritarget.org/blog/2012/11/28/the-pyramid-of-doom-a-javascript-style-trap/">Pyramid of Doom</a> effect</h2>
<p><em>Javascript</em> is by nature an <strong>asynchronous language</strong> based on an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/EventLoop">event loop</a> which enqueue events.
As a consequence, there is no way to block long actions (like Image Loading, ajax requests, other events), but everything is instead asynchronous:
Most of Javascript APIs are using <strong>callbacks</strong> - functions called when the event has succeeded.</p>
<p><strong>Problem with callbacks</strong> is when you start having a lot of asynchronous actions.
It quickly becomes a <a href="http://callbackhell.com/">Callback Hell</a>.</p>
<h3 id="example">Example</h3>
<p>Here is a simple illustration, let&#39;s say we have 2 functions, 
one for <strong>retrieving some photos meta-infos from Flickr</strong> with a search criteria: <code>getFlickrJson(search, callback)</code>, 
another for <strong>loading an image from one photo meta-info</strong>: <code>loadImage(json, callback)</code>. 
Of-course both functions are asynchonous so they need a callback to be called with a result.</p>
<p>With this callback approach, we can then write:</p>
<pre><code class="language-javascript">// search photos for &quot;Paris&quot;, load and display the first one
getFlickrJson(&quot;Paris&quot;, function (imagesMeta) {
  loadImage(imagesMeta[0], function (image) {
    displayImage(image);
  });
});
</code></pre>
<p><em>(Imagine what it can look like with more nested steps.)</em></p>
<blockquote>
<p>we can easily turn a <em>callback</em> API into a <em>Promise</em> API</p>
</blockquote>
<h4 id="promise-style">Promise style</h4>
<p><code>getFlickrJson</code> and <code>loadImage</code> can now be rewritten as Promise APIs:</p>
<p>Each function has clean signatures:</p>
<ul>
<li><code>getFlickrJson</code> is a <code>(search: String) =&gt; Promise[Array of ImageMeta]</code>.</li>
<li><code>loadImage</code> is a <code>(imageMeta: ImageMeta) =&gt; Promise[DOM Image]</code>.</li>
<li><code>displayImage</code> is a <code>(image: DOM Image) =&gt; undefined</code>.</li>
</ul>
<p>...and are easily pluggable together:</p>
<pre><code class="language-javascript">getFlickrJson(&quot;Paris&quot;)
  .then(function (imagesMeta) { return imagesMeta[0]; })
  .then(loadImage)
  .then(displayImage, displayError);
</code></pre>
<p><strong>This is much more flatten, concise, maintainable and beautiful!</strong></p>
<p>Note that if we want to be safer we can write:</p>
<pre><code class="language-javascript">Q.fcall(getFlickrJson, &quot;Paris&quot;)
  .then(function (imagesMeta) { return imagesMeta[0]; })
  .then(loadImage)
  .then(displayImage, displayError);
</code></pre>
<p><code>Q.fcall</code> will call the function with the given parameters and ensure wrapping the returned value into a <strong>Promise</strong>.
So my code should continue working even if we change signatures to:</p>
<ul>
<li><code>getFlickrJson</code> is a <code>(search: String) =&gt; Array of ImageMeta</code>.</li>
<li><code>loadImage</code> is a <code>(imageMeta: ImageMeta) =&gt; DOM Image</code>.</li>
</ul>
<p>One other cool thing about this chain of Promises is <strong>we can easily add more steps</strong> between two <code>then</code> step, for instance a DOM animation, a little delay, etc.</p>
<h3 id="error-handling">Error Handling</h3>
<p>But a much important benefit is, unlike the callbacks approach,
we can properly <strong>handle the error in one row</strong> because one of the following steps eventually fails:</p>
<ul>
<li><code>getFlickrJson</code> fails to perform the ajax request to retrieve the Flickr JSON data.</li>
<li>The array returned by Flickr was empty so <code>loadImage</code> throws an exception.</li>
<li>The <code>loadImage</code> fails (e.g. the image is unavailable).</li>
</ul>
<p>This is called <strong>propagation</strong> and is exactly how <strong>exceptions</strong> work.</p>
<p><strong>Promise Error Handling</strong> really looks like <strong>Exception Handling</strong>.</p>
<p>If it would be possible to have two methods:</p>
<ul>
<li><code>getFlickrJsonSync</code> is a <code>(search: String) =&gt; Array of ImageMeta</code>.</li>
<li><code>loadImageSync</code> is a <code>(imageMeta: ImageMeta) =&gt; DOM Image</code>.</li>
</ul>
<p>Then, the blocking code would look like this:</p>
<pre><code class="language-javascript">try {
  var imagesMeta = getFlickrJsonSync(&quot;Paris&quot;)
  var firstImageMeta = imagesMeta[0]
  var image = loadImageSync(firstImageMeta)
  displayImage(image);
} catch (e) {
  displayError(e);
}
</code></pre>
<p><em>...which is very close to Promise style.</em></p>
<p><strong>Q Promises also unify Exceptions and Rejected Promises</strong>:
throwing an exception in any Q callback will result in a rejected Promise.</p>
<pre><code class="language-javascript">var safePromise = Q.fcall(function () {
  // following eventually throws an exception
  return JSON.parse(someUnsafeJsonString);
});
// safePromise is either fulfilled with a JSON Object
// or rejected with an error.
</code></pre>
<blockquote>
<p>Error handling with the callbacks approach is hell:</p>
</blockquote>
<pre><code class="language-javascript">getFlickrJson(&quot;Paris&quot;, function (imagesMeta) {
  if (imagesMeta.length == 0) {
    displayError();
  }
  else {
    loadImage(imagesMeta[0], function (image) {
      displayImage(image);
    }, displayError);
  }
}, displayError);
</code></pre>
<h2 id="next-episode">Next episode</h2>
<p>Next episode, we will show you how to create your own Promises with <em>Deferred</em> objects.
We will introduce <strong>Qimage</strong>, a simple Image loader wrapped with Q.</p>
<hr>
<p>Special Kudos to <a href="http://twitter.com/42loops">@42loops</a> &amp; <a href="http://twitter.com/bobylito">@bobylito</a>
for bringing Q in my developer life :-P</p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/logo.svg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">generative art, shaders, plotting with fountain pens</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://opensea.io/greweb" class="jsx-2519965637"><img alt="" src="/icons/eth.svg" class="jsx-2519965637"/></a><a href="https://objkt.com/profile/tz1cgQAQfECg5bPASYTMyJ9QJQjSUi8rfL67" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://fxhash.xyz/u/greweb" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2013-07-10-q-a-promise-library","year":"2013","month":"07","day":"10","slug":"q-a-promise-library","content":"\u003ch1 id=\"a-world-of-promises-episode-1\"\u003e\u003ca href=\"/pages/a-world-of-promises/\"\u003eA World Of Promises\u003c/a\u003e, episode 1\u003c/h1\u003e\n\u003cp\u003e\u003cem\u003eThis article is the first of a series of small articles \non the Q Javascript library and its eco-system.\nThis article is a brief introduction to Q Promises.\u003c/em\u003e\u003c/p\u003e\n\u003cimg src=\"/images/2013/07/promise_then_thumbnail.jpg\" alt=\"\" class=\"thumbnail-left\" /\u003e\n\n\u003cp\u003e\u003ca href=\"http://github.com/kriskowal/q\"\u003eQ\u003c/a\u003e is a \u003cstrong\u003ePromise library\u003c/strong\u003e in \u003cstrong\u003eJavascript\u003c/strong\u003e \ncreated 4 years ago by \u003ca href=\"https://github.com/kriskowal\"\u003eKris Kowal\u003c/a\u003e who is one of the main contributor to \u003ca href=\"http://wiki.commonjs.org/\"\u003eCommonJS\u003c/a\u003e\nwhere we can find the \u003cstrong\u003e\u003ca href=\"http://wiki.commonjs.org/wiki/Promises/A\"\u003ePromises/A\u003c/a\u003e\u003c/strong\u003e specification.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://github.com/kriskowal/q\"\u003eQ\u003c/a\u003e is probably \u003cstrong\u003ethe most mature and powerful Promise library in Javascript\u003c/strong\u003e\nwhich inspired a lot of libraries like \u003ca href=\"http://jquery.com/\"\u003ejQuery\u003c/a\u003e.\nIt exposes a complete API with, in my humble opinion, \ngood ideas like the separation of concerns between a \u0026quot;Deferred\u0026quot; object (the resolver) \nand a \u0026quot;Thenable\u0026quot; Promise (the read-only promise).\u003c/p\u003e\n\u003cp\u003eThis article is a brief introduction to Q Promises with some examples.\nFor more information on the subject, I highly recommend reading\nthe article \u003ca href=\"http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/\"\u003e\u0026quot;You\u0026#39;re Missing the Point of Promises\u0026quot;\u003c/a\u003e \nand \u003ca href=\"https://raw.github.com/kriskowal/q/master/design/README.js\"\u003ethe Q implementation design README\u003c/a\u003e.\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003ch2 id=\"what-is-a-promise\"\u003eWhat is a Promise\u003c/h2\u003e\n\u003cp\u003eA \u003cstrong\u003ePromise\u003c/strong\u003e is an object representing a \u003cstrong\u003epossible future value\u003c/strong\u003e which has \na \u003ccode\u003ethen\u003c/code\u003e method to access this value via callback. A Promise is initially \nin a \u003cem\u003epending\u003c/em\u003e state and is then either \u003cem\u003efulfilled\u003c/em\u003e with a value or \u003cem\u003erejected\u003c/em\u003e with an error.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2013/07/promise.png\" alt=\"Schema representing Promise states: pending -\u0026gt; fulfilled|rejected\"\u003e\u003c/p\u003e\n\u003ch3 id=\"some-properties\"\u003eSome properties\u003c/h3\u003e\n\u003cp\u003eIt is \u003cstrong\u003eimmutable\u003c/strong\u003e because the Promise value never changes and each \u003ccode\u003ethen\u003c/code\u003e creates a new Promise. \nAs a consequence, one same Promise can be shared between different code.\u003c/p\u003e\n\u003cp\u003eIt is \u003cstrong\u003echainable\u003c/strong\u003e through the \u003ccode\u003ethen\u003c/code\u003e method (and other Q shortcut methods),\nwhich transforms a Promise into a new Promise without knowing what\u0026#39;s inside.\u003c/p\u003e\n\u003cp\u003eIt is \u003cstrong\u003ecomposable\u003c/strong\u003e because the \u003ccode\u003ethen\u003c/code\u003e method will unify any Promise returned as \na result of the callback with the current Promise (act like a map or flatmap). \n\u003ca href=\"http://github.com/kriskowal/q\"\u003eQ\u003c/a\u003e also has a \u003ccode\u003eQ.all\u003c/code\u003e helper for combining an Array of Promise into one big Promise.\u003c/p\u003e\n\u003ch2 id=\"a-solution-against-the-pyramid-of-doom-effect\"\u003eA solution against the \u003ca href=\"http://tritarget.org/blog/2012/11/28/the-pyramid-of-doom-a-javascript-style-trap/\"\u003ePyramid of Doom\u003c/a\u003e effect\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eJavascript\u003c/em\u003e is by nature an \u003cstrong\u003easynchronous language\u003c/strong\u003e based on an \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/EventLoop\"\u003eevent loop\u003c/a\u003e which enqueue events.\nAs a consequence, there is no way to block long actions (like Image Loading, ajax requests, other events), but everything is instead asynchronous:\nMost of Javascript APIs are using \u003cstrong\u003ecallbacks\u003c/strong\u003e - functions called when the event has succeeded.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eProblem with callbacks\u003c/strong\u003e is when you start having a lot of asynchronous actions.\nIt quickly becomes a \u003ca href=\"http://callbackhell.com/\"\u003eCallback Hell\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"example\"\u003eExample\u003c/h3\u003e\n\u003cp\u003eHere is a simple illustration, let\u0026#39;s say we have 2 functions, \none for \u003cstrong\u003eretrieving some photos meta-infos from Flickr\u003c/strong\u003e with a search criteria: \u003ccode\u003egetFlickrJson(search, callback)\u003c/code\u003e, \nanother for \u003cstrong\u003eloading an image from one photo meta-info\u003c/strong\u003e: \u003ccode\u003eloadImage(json, callback)\u003c/code\u003e. \nOf-course both functions are asynchonous so they need a callback to be called with a result.\u003c/p\u003e\n\u003cp\u003eWith this callback approach, we can then write:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// search photos for \u0026quot;Paris\u0026quot;, load and display the first one\ngetFlickrJson(\u0026quot;Paris\u0026quot;, function (imagesMeta) {\n  loadImage(imagesMeta[0], function (image) {\n    displayImage(image);\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003e(Imagine what it can look like with more nested steps.)\u003c/em\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ewe can easily turn a \u003cem\u003ecallback\u003c/em\u003e API into a \u003cem\u003ePromise\u003c/em\u003e API\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"promise-style\"\u003ePromise style\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003egetFlickrJson\u003c/code\u003e and \u003ccode\u003eloadImage\u003c/code\u003e can now be rewritten as Promise APIs:\u003c/p\u003e\n\u003cp\u003eEach function has clean signatures:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetFlickrJson\u003c/code\u003e is a \u003ccode\u003e(search: String) =\u0026gt; Promise[Array of ImageMeta]\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eloadImage\u003c/code\u003e is a \u003ccode\u003e(imageMeta: ImageMeta) =\u0026gt; Promise[DOM Image]\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edisplayImage\u003c/code\u003e is a \u003ccode\u003e(image: DOM Image) =\u0026gt; undefined\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e...and are easily pluggable together:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003egetFlickrJson(\u0026quot;Paris\u0026quot;)\n  .then(function (imagesMeta) { return imagesMeta[0]; })\n  .then(loadImage)\n  .then(displayImage, displayError);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eThis is much more flatten, concise, maintainable and beautiful!\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eNote that if we want to be safer we can write:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eQ.fcall(getFlickrJson, \u0026quot;Paris\u0026quot;)\n  .then(function (imagesMeta) { return imagesMeta[0]; })\n  .then(loadImage)\n  .then(displayImage, displayError);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eQ.fcall\u003c/code\u003e will call the function with the given parameters and ensure wrapping the returned value into a \u003cstrong\u003ePromise\u003c/strong\u003e.\nSo my code should continue working even if we change signatures to:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetFlickrJson\u003c/code\u003e is a \u003ccode\u003e(search: String) =\u0026gt; Array of ImageMeta\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eloadImage\u003c/code\u003e is a \u003ccode\u003e(imageMeta: ImageMeta) =\u0026gt; DOM Image\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOne other cool thing about this chain of Promises is \u003cstrong\u003ewe can easily add more steps\u003c/strong\u003e between two \u003ccode\u003ethen\u003c/code\u003e step, for instance a DOM animation, a little delay, etc.\u003c/p\u003e\n\u003ch3 id=\"error-handling\"\u003eError Handling\u003c/h3\u003e\n\u003cp\u003eBut a much important benefit is, unlike the callbacks approach,\nwe can properly \u003cstrong\u003ehandle the error in one row\u003c/strong\u003e because one of the following steps eventually fails:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetFlickrJson\u003c/code\u003e fails to perform the ajax request to retrieve the Flickr JSON data.\u003c/li\u003e\n\u003cli\u003eThe array returned by Flickr was empty so \u003ccode\u003eloadImage\u003c/code\u003e throws an exception.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eloadImage\u003c/code\u003e fails (e.g. the image is unavailable).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis is called \u003cstrong\u003epropagation\u003c/strong\u003e and is exactly how \u003cstrong\u003eexceptions\u003c/strong\u003e work.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePromise Error Handling\u003c/strong\u003e really looks like \u003cstrong\u003eException Handling\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIf it would be possible to have two methods:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetFlickrJsonSync\u003c/code\u003e is a \u003ccode\u003e(search: String) =\u0026gt; Array of ImageMeta\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eloadImageSync\u003c/code\u003e is a \u003ccode\u003e(imageMeta: ImageMeta) =\u0026gt; DOM Image\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThen, the blocking code would look like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003etry {\n  var imagesMeta = getFlickrJsonSync(\u0026quot;Paris\u0026quot;)\n  var firstImageMeta = imagesMeta[0]\n  var image = loadImageSync(firstImageMeta)\n  displayImage(image);\n} catch (e) {\n  displayError(e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003e...which is very close to Promise style.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eQ Promises also unify Exceptions and Rejected Promises\u003c/strong\u003e:\nthrowing an exception in any Q callback will result in a rejected Promise.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar safePromise = Q.fcall(function () {\n  // following eventually throws an exception\n  return JSON.parse(someUnsafeJsonString);\n});\n// safePromise is either fulfilled with a JSON Object\n// or rejected with an error.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003eError handling with the callbacks approach is hell:\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003egetFlickrJson(\u0026quot;Paris\u0026quot;, function (imagesMeta) {\n  if (imagesMeta.length == 0) {\n    displayError();\n  }\n  else {\n    loadImage(imagesMeta[0], function (image) {\n      displayImage(image);\n    }, displayError);\n  }\n}, displayError);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"next-episode\"\u003eNext episode\u003c/h2\u003e\n\u003cp\u003eNext episode, we will show you how to create your own Promises with \u003cem\u003eDeferred\u003c/em\u003e objects.\nWe will introduce \u003cstrong\u003eQimage\u003c/strong\u003e, a simple Image loader wrapped with Q.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eSpecial Kudos to \u003ca href=\"http://twitter.com/42loops\"\u003e@42loops\u003c/a\u003e \u0026amp; \u003ca href=\"http://twitter.com/bobylito\"\u003e@bobylito\u003c/a\u003e\nfor bringing Q in my developer life :-P\u003c/p\u003e\n","data":{"title":"Qep1.: Q, a Promise library","description":"This article is the first of a series of small articles on the Q Javascript library and its eco-system. It is a brief introduction to Q Promises.","thumbnail":"/images/2013/07/promise_then_thumbnail.jpg","author":"Gaetan","layout":"post","tags":["AWOP","javascript","promise","Q","library"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2013","month":"07","slug":"q-a-promise-library"},"buildId":"xTexrK-zb8emnM7r0hooR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>