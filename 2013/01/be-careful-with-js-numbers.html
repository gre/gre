<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="Javascript doesn’t have integer type but lets you think it has. In Javascript, all numbers are floating numbers and are prone to floating point approximation."/><meta name="keywords" content="float, javascript"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Be careful with JS numbers!"/><meta name="og:title" content="Be careful with JS numbers!"/><meta name="twitter:description" content="Javascript doesn’t have integer type but lets you think it has. In Javascript, all numbers are floating numbers and are prone to floating point approximation."/><meta name="twitter:creator" content="@greweb"/><title>@greweb - Be careful with JS numbers!</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="22"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-c914a1e31212c00c738a.js" defer=""></script><script src="/_next/static/chunks/framework-bdc1b4e5e48979e16d36.js" defer=""></script><script src="/_next/static/chunks/main-3b0c517193ca5150f81f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c981e0e3ce59f13eb8d0.js" defer=""></script><script src="/_next/static/chunks/5988-738c1ea5f97353b6463e.js" defer=""></script><script src="/_next/static/chunks/2242-9500cb3f15832f959b41.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-476d7e87469cc8a40c59.js" defer=""></script><script src="/_next/static/CvCsN5JwDfoulaxVXv35_/_buildManifest.js" defer=""></script><script src="/_next/static/CvCsN5JwDfoulaxVXv35_/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Be careful with JS numbers!</a></h1><time class="date" dateTime="2013-01-10">2013-01-10</time><span class="tags"><a class="tag">float</a><a class="tag">javascript</a></span></header><div class="entry-content"><blockquote class="twitter-tweet" lang="fr"><p>@<a href="https://twitter.com/greweb">greweb</a> : Let's do a kickstarter to build the 1st space rocket running on embedded Javascript... I think we can discover new physics rules!</p>&mdash; mandubian (@mandubian) <a href="https://twitter.com/mandubian/status/289422662101504000">10 janvier 2013</a></blockquote>

<p>It is <a href="http://wtfjs.com/">common</a> in Javascript to have unexpected behaviors, but this one is particulary vicious.</p>
<blockquote>
<p>10000000000000000 === 10000000000000001</p>
</blockquote>
<p><strong>Javascript doesn’t have integer type but lets you think it has.</strong> <code>parseInt</code> and <code>parseFloat</code> built-in functions, the fact that “1″ is displayed as “1″ and not as “1.0″ (like many languages) contribute to the general misunderstood.</p>
<p><strong>In Javascript, all numbers are floating numbers and are prone to <a href="https://en.wikipedia.org/wiki/Floating_point">floating point approximation</a>.</strong></p>
<p>When you write <code>var i = 1;</code>, and you console.log it, Javascript is nice, you obtain <code>1</code> and not <code>1.0000000000000001</code>. </p>
<p>But you can experiment that, in Javascript, <code>1.0000000000000001 === 1</code> is true…</p>
<blockquote>
<p>I hear you, telling me that <em>this sounds OK, floating point approximation rules, right?</em></p>
</blockquote>
<p>But the same thing occurs for big numbers:</p>
<pre><code class="language-javascript">10000000000000000 === 10000000000000001
</code></pre>
<p>Oh <strong>F**K</strong> !</p>
<p>[edit] where in python:<br><img src="https://pbs.twimg.com/media/BAg2wRyCIAAGuXW.png:large" alt=""></p>
<h2 id="termination-of-loops">Termination of loops</h2>
<p>The following is worse:</p>
<script src="https://gist.github.com/4504986.js"></script>

<p>is logging <code>10000000000000000</code> forever!</p>
<p>Because 10000000000000001 can’t exist in Javascript with approximations, 10000000000000001 is 10000000000000000, so you can’t increment this value, and you are stuck in this crazy f**king loop. </p>
<p>Conclusion, <em>Program termination proof</em> sounds hard to reach in Javascript!</p>
<!--more-->

<h2 id="how-many-numbers-in-a-1000-range">How many numbers in a 1000 range?</h2>
<p>Between 10000000000000000 and 10000000000001000, there are actually 750 Javascript integers.</p>
<script src="https://gist.github.com/4505510.js"></script>

<h2 id="real-world-example">Real World Example</h2>
<p>The issue can actually <strong>lead to real web application disaster</strong>. Imagine if your database use Long for id (well like almost every databases in the world, like twitter does), and <strong>if you use the id as number in Javascript and not as string</strong>, you can have strange behaviors like never being able to represent and access a resource from the Javascript or worse!</p>
<script src="https://gist.github.com/4505517.js"></script>

<h2 id="tldr-the-lesson">TL;DR. The lesson</h2>
<p>This is not something new, floating point approximation, but the way Javascript fix values to round the approximations mislead us.</p>
<p>Now, simple thing, <strong>Avoid numbers when approximation is not permitted</strong> like for resource id (especially when you retrieve it from a server).</p>
<p>This probably impacts your JSON APIs because it’s the last thing you had think of!</p>
<p>Otherwise, <strong>if you need to manipulate big integers in Javascript use a library for that</strong>.</p>
<p>Example: <a href="http://silentmatt.com/biginteger/">http://silentmatt.com/biginteger/</a></p>
<p>[EDIT]<br>9007199254740993 (which is 2^53 1) is the smallest not representable integer in Javascript. In other words, you can trust Javascript numbers before this integer!</p>
<p>[EDIT 2]<br><a href="http://news.ycombinator.com/item?id=5051525">Thanks to 0×0 on HackerNews</a> who told me the twitter id issue example really happened in a previous twitter API: </p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/logo.svg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">As a generative plotter artist, I use code to create art (creative coding), draw with fountain pens on robots (plotting), and explore the boundaries of abstract art using algorithms in pursuit of increasingly realistic imagery. I do not produce prints; instead, I create unique &#x27;plots&#x27; - physical works of art that are truly one-of-a-kind.</div><div class="jsx-2519965637 social"><a href="https://discord.gg/DQBajxzn" class="jsx-2519965637"><img alt="" src="/icons/discord.svg" class="jsx-2519965637"/></a><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://youtube.com/@greweb" class="jsx-2519965637"><img alt="" src="/icons/youtube.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://opensea.io/greweb?tab=created" class="jsx-2519965637"><img alt="" src="/icons/eth.svg" class="jsx-2519965637"/></a><a href="https://fxhash.xyz/u/greweb" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2013-01-10-be-careful-with-js-numbers","year":"2013","month":"01","day":"10","slug":"be-careful-with-js-numbers","content":"\u003cblockquote class=\"twitter-tweet\" lang=\"fr\"\u003e\u003cp\u003e@\u003ca href=\"https://twitter.com/greweb\"\u003egreweb\u003c/a\u003e : Let's do a kickstarter to build the 1st space rocket running on embedded Javascript... I think we can discover new physics rules!\u003c/p\u003e\u0026mdash; mandubian (@mandubian) \u003ca href=\"https://twitter.com/mandubian/status/289422662101504000\"\u003e10 janvier 2013\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cp\u003eIt is \u003ca href=\"http://wtfjs.com/\"\u003ecommon\u003c/a\u003e in Javascript to have unexpected behaviors, but this one is particulary vicious.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e10000000000000000 === 10000000000000001\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eJavascript doesn’t have integer type but lets you think it has.\u003c/strong\u003e \u003ccode\u003eparseInt\u003c/code\u003e and \u003ccode\u003eparseFloat\u003c/code\u003e built-in functions, the fact that “1″ is displayed as “1″ and not as “1.0″ (like many languages) contribute to the general misunderstood.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eIn Javascript, all numbers are floating numbers and are prone to \u003ca href=\"https://en.wikipedia.org/wiki/Floating_point\"\u003efloating point approximation\u003c/a\u003e.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWhen you write \u003ccode\u003evar i = 1;\u003c/code\u003e, and you console.log it, Javascript is nice, you obtain \u003ccode\u003e1\u003c/code\u003e and not \u003ccode\u003e1.0000000000000001\u003c/code\u003e. \u003c/p\u003e\n\u003cp\u003eBut you can experiment that, in Javascript, \u003ccode\u003e1.0000000000000001 === 1\u003c/code\u003e is true…\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI hear you, telling me that \u003cem\u003ethis sounds OK, floating point approximation rules, right?\u003c/em\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBut the same thing occurs for big numbers:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e10000000000000000 === 10000000000000001\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOh \u003cstrong\u003eF**K\u003c/strong\u003e !\u003c/p\u003e\n\u003cp\u003e[edit] where in python:\u003cbr\u003e\u003cimg src=\"https://pbs.twimg.com/media/BAg2wRyCIAAGuXW.png:large\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"termination-of-loops\"\u003eTermination of loops\u003c/h2\u003e\n\u003cp\u003eThe following is worse:\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/4504986.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eis logging \u003ccode\u003e10000000000000000\u003c/code\u003e forever!\u003c/p\u003e\n\u003cp\u003eBecause 10000000000000001 can’t exist in Javascript with approximations, 10000000000000001 is 10000000000000000, so you can’t increment this value, and you are stuck in this crazy f**king loop. \u003c/p\u003e\n\u003cp\u003eConclusion, \u003cem\u003eProgram termination proof\u003c/em\u003e sounds hard to reach in Javascript!\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003ch2 id=\"how-many-numbers-in-a-1000-range\"\u003eHow many numbers in a 1000 range?\u003c/h2\u003e\n\u003cp\u003eBetween 10000000000000000 and 10000000000001000, there are actually 750 Javascript integers.\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/4505510.js\"\u003e\u003c/script\u003e\n\n\u003ch2 id=\"real-world-example\"\u003eReal World Example\u003c/h2\u003e\n\u003cp\u003eThe issue can actually \u003cstrong\u003elead to real web application disaster\u003c/strong\u003e. Imagine if your database use Long for id (well like almost every databases in the world, like twitter does), and \u003cstrong\u003eif you use the id as number in Javascript and not as string\u003c/strong\u003e, you can have strange behaviors like never being able to represent and access a resource from the Javascript or worse!\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/4505517.js\"\u003e\u003c/script\u003e\n\n\u003ch2 id=\"tldr-the-lesson\"\u003eTL;DR. The lesson\u003c/h2\u003e\n\u003cp\u003eThis is not something new, floating point approximation, but the way Javascript fix values to round the approximations mislead us.\u003c/p\u003e\n\u003cp\u003eNow, simple thing, \u003cstrong\u003eAvoid numbers when approximation is not permitted\u003c/strong\u003e like for resource id (especially when you retrieve it from a server).\u003c/p\u003e\n\u003cp\u003eThis probably impacts your JSON APIs because it’s the last thing you had think of!\u003c/p\u003e\n\u003cp\u003eOtherwise, \u003cstrong\u003eif you need to manipulate big integers in Javascript use a library for that\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eExample: \u003ca href=\"http://silentmatt.com/biginteger/\"\u003ehttp://silentmatt.com/biginteger/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e[EDIT]\u003cbr\u003e9007199254740993 (which is 2^53 1) is the smallest not representable integer in Javascript. In other words, you can trust Javascript numbers before this integer!\u003c/p\u003e\n\u003cp\u003e[EDIT 2]\u003cbr\u003e\u003ca href=\"http://news.ycombinator.com/item?id=5051525\"\u003eThanks to 0×0 on HackerNews\u003c/a\u003e who told me the twitter id issue example really happened in a previous twitter API: \u003c/p\u003e\n","data":{"title":"Be careful with JS numbers!","description":"Javascript doesn’t have integer type but lets you think it has. In Javascript, all numbers are floating numbers and are prone to floating point approximation.","author":"Gaetan","layout":"post","permalink":"/2013/01/be-careful-with-js-numbers/","tags":["float","javascript"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2013","month":"01","slug":"be-careful-with-js-numbers"},"buildId":"CvCsN5JwDfoulaxVXv35_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>