(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{4223:function(e,t,n){"use strict";n.r(t),n.d(t,{Previewing:function(){return y},__N_SSG:function(){return g},default:function(){return b}});var r=n(5893),a=n(9008),s=n(5958),i=n(7294),o=n(7250),c=n(3224),d=n(9830),l=n(1532),f=n(4276),u=n(3369),x=n(5988),p=n(1664);function h({Day:e}){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"jsx-1224002593 description",children:[(0,r.jsx)(p.default,{href:`/${e.n}`,children:(0,r.jsxs)("a",{className:"jsx-1224002593",children:["Day ",e.n,"."]})})," ",(0,r.jsxs)("span",{className:"jsx-1224002593 daily",children:['"',e.title,'"']})," by"," ",(0,r.jsx)("a",{href:"https://twitter.com/greweb",target:"_blank",rel:"noreferrer",className:"jsx-1224002593",children:"@greweb"})]}),(0,r.jsxs)("nav",{className:"jsx-1224002593",children:[(0,d.hU)(e.n-1)?(0,r.jsx)(p.default,{href:"/export/"+(e.n-1),children:(0,r.jsx)("a",{className:"jsx-1224002593",children:"\u2190 previous day"})}):(0,r.jsx)("span",{className:"jsx-1224002593"}),(0,d.hU)(e.n+1)?(0,r.jsx)(p.default,{href:`/export/${e.n+1}`,children:(0,r.jsx)("a",{className:"jsx-1224002593",children:"next day \u2192"})}):null]}),(0,r.jsx)(x.default,{id:"1224002593",children:[".description.jsx-1224002593{text-align:center;line-height:1.3rem;font-size:1.3rem;font-weight:300;}",".description.jsx-1224002593 .daily.jsx-1224002593{font-weight:600;}","nav.jsx-1224002593{width:400px;font-size:0.6em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}"]})]})}var m=n(2266);function j({format:e,n:t,Day:n,onFinished:a,size:d,start:l,end:f,framePerSecond:u,exportSkipFrame:x,speed:p,preload:h}){const m=(0,i.useRef)(),j=Math.floor((f-l)*u/p),{0:w,1:g}=(0,i.useState)(0),{1:y}=(0,i.useState)(!1),b=w/j*(f-l)/(1+x),S=Math.floor(w/(1+x)-l*u),{0:k}=(0,i.useState)((()=>{let t,r,i,o,c,d,f=0,p=!1;return{onDraw:()=>{if(!p)return;const h=Math.floor(f/(1+x)-l*u);if(h<0||h===d)g(++f);else if(d=h,"gif"===e){const{width:e,height:o,data:c}=function(){const e=m.current.capture(),{shape:[t,n]}=e,r=new Uint8Array(t*n*4);for(let a=0;a<t;a++)for(let s=0;s<n;s++)for(let i=0;i<4;i++)r[4*(n*a+s)+i]=e.data[4*(n*(t-a-1)+s)+i];return{width:n,height:t,data:r}}();i||(i=(0,s.GIFEncoder)()),t&&n.exportPaletteGenOnce||(t=(0,s.quantize)(c,n.exportPaletteSize||256)),r=(0,s.applyPalette)(c,t),i.writeFrame(r,e,o,{palette:t,delay:1e3/u}),h>=j?(i.finish(),a(new Blob([i.bytes()],{type:"image/gif"}))):g(++f)}else{o||(o=new Worker("/ffmpeg-worker-mp4.js"),c=[]);const e=function(e){var t=e.replace(/^data[^,]+,/,""),n=window.atob(t),r=n.length,a=new Uint8Array(new ArrayBuffer(r));for(let s=0;s<r;s++)a[s]=n.charCodeAt(s);return a}(m.current.captureAsDataURL("image/jpeg",1));c.push({name:"img"+f.toString().padStart(4,0)+".jpeg",data:e}),h>=j?(o.onmessage=function(e){var t=e.data;switch(t.type){case"stdout":case"stderr":console.log(t.data);break;case"exit":console.log("Process exited with code "+t.data);break;case"done":console.log("reached done");const e=new Blob([t.data.MEMFS[0].data],{type:"video/mp4"});a(e)}},o.postMessage({type:"run",TOTAL_MEMORY:268435456,arguments:["-r",String(u),"-i","img%04d.jpeg","-c:v","libx264","-crf","1","-pix_fmt","yuv420p","-vb",n.exportMP4vb||"5M","out.mp4"],MEMFS:c})):g(++f)}},onLoad:()=>{p=!0,y(!0)}}}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.T,{webglContextAttributes:{preserveDrawingBuffer:!0},onLoad:k.onLoad,ref:m,width:d,height:d,pixelRatio:1,preload:h,children:(0,r.jsx)(c.NearestCopy,{onDraw:k.onDraw,children:(0,r.jsx)(n.Shader,{exporting:!0,time:b,n:t})})}),S+" / "+j]})}const w=i.memo(j);var g=!0;function y({n:e,Day:t,start:n,end:a,framePerSecond:s,speed:c}){const{0:d,1:l}=(0,i.useState)(0);(0,i.useEffect)((()=>{let e,t,n;return n=requestAnimationFrame((function r(a){n=requestAnimationFrame(r),e||(t=e=a),a-t>=1e3/s&&(t=a,l((a-e)/1e3))})),()=>cancelAnimationFrame(n)}),[]);const f=n+c*d%(a-n);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.T,{width:400,height:400,children:(0,r.jsx)(t.Shader,{exporting:!0,time:f,n:e})}),f.toFixed(3)]})}function b({day:e}){const{0:t,1:n}=(0,i.useState)(0),{0:s,1:o}=(0,i.useState)(),c=(0,d.hU)(parseInt(e,10));if(!c)return null;const x=c.exportStart||0,p=c.exportEnd||1,j=c.exportFramePerSecond||24,g=c.exportSkipFrame||0,b=c.exportSpeed||1,S=c.exportSize||800,k=c.preload||[];return(0,r.jsx)(f.x,{children:(0,r.jsxs)(l.W,{children:[(0,r.jsxs)(a.default,{children:[(0,r.jsxs)("title",{children:["One Day One Shader \u2013 Day ",c.n,'. "',c.title,'"']}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsxs)(u.o,{children:[(0,r.jsx)(m.h,{children:"Export tools"}),(0,r.jsx)(h,{Day:c}),s?(0,r.jsx)(w,{format:s,n:t,start:x,end:p,framePerSecond:j,exportSkipFrame:g,speed:b,size:S,Day:c,onFinished:function(n){!function(e,t){const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.click()}(n,"shaderday_"+e+"_"+t+"."+s),o(null)},preload:k}):(0,r.jsx)(y,{n:t,start:x,end:p,framePerSecond:j,speed:b,Day:c}),(0,r.jsx)("input",{style:{margin:10},value:t,range:1,onChange:e=>n(parseInt(e.target.value,10)),type:"number"}),(0,r.jsx)("button",{onClick:()=>o("gif"),children:"gif"}),(0,r.jsx)("button",{onClick:()=>o("mp4"),children:"mp4"})]})]})})}},2883:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/export/[day]",function(){return n(4223)}])}},function(e){e.O(0,[774,511,988,976,250,55,958,144,830,888,179],(function(){return t=2883,e(e.s=t);var t}));var t=e.O();_N_E=t}]);