(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{4223:function(e,t,n){"use strict";n.r(t),n.d(t,{Previewing:function(){return y},__N_SSG:function(){return g},default:function(){return b}});var r=n(9008),a=n(5958),s=n(7294),i=n(7250),o=n(3224),c=n(9830),d=n(1532),l=n(4276),f=n(3369),u=n(5988),x=n(1664),p=n(5893);function h({Day:e}){return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("p",{className:"jsx-1224002593 description",children:[(0,p.jsx)(x.default,{href:`/${e.n}`,children:(0,p.jsxs)("a",{className:"jsx-1224002593",children:["Day ",e.n,"."]})})," ",(0,p.jsxs)("span",{className:"jsx-1224002593 daily",children:['"',e.title,'"']})," by"," ",(0,p.jsx)("a",{href:"https://twitter.com/greweb",target:"_blank",rel:"noreferrer",className:"jsx-1224002593",children:"@greweb"})]}),(0,p.jsxs)("nav",{className:"jsx-1224002593",children:[(0,c.hU)(e.n-1)?(0,p.jsx)(x.default,{href:"/export/"+(e.n-1),children:(0,p.jsx)("a",{className:"jsx-1224002593",children:"\u2190 previous day"})}):(0,p.jsx)("span",{className:"jsx-1224002593"}),(0,c.hU)(e.n+1)?(0,p.jsx)(x.default,{href:`/export/${e.n+1}`,children:(0,p.jsx)("a",{className:"jsx-1224002593",children:"next day \u2192"})}):null]}),(0,p.jsx)(u.default,{id:"1224002593",children:[".description.jsx-1224002593{text-align:center;line-height:1.3rem;font-size:1.3rem;font-weight:300;}",".description.jsx-1224002593 .daily.jsx-1224002593{font-weight:600;}","nav.jsx-1224002593{width:400px;font-size:0.6em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}"]})]})}var m=n(2266);function j({format:e,n:t,Day:n,onFinished:r,size:c,start:d,end:l,framePerSecond:f,exportSkipFrame:u,speed:x,preload:h}){const m=(0,s.useRef)(),j=Math.floor((l-d)*f/x),{0:w,1:g}=(0,s.useState)(0),{1:y}=(0,s.useState)(!1),b=w/j*(l-d)/(1+u),S=Math.floor(w/(1+u)-d*f),{0:k}=(0,s.useState)((()=>{let t,s,i,o,c,l,x=0,p=!1;return{onDraw:()=>{if(!p)return;const h=Math.floor(x/(1+u)-d*f);if(h<0||h===l)g(++x);else if(l=h,"gif"===e){const{width:e,height:o,data:c}=function(){const e=m.current.capture(),{shape:[t,n]}=e,r=new Uint8Array(t*n*4);for(let a=0;a<t;a++)for(let s=0;s<n;s++)for(let i=0;i<4;i++)r[4*(n*a+s)+i]=e.data[4*(n*(t-a-1)+s)+i];return{width:n,height:t,data:r}}();i||(i=(0,a.GIFEncoder)()),t&&n.exportPaletteGenOnce||(t=(0,a.quantize)(c,n.exportPaletteSize||256)),s=(0,a.applyPalette)(c,t),i.writeFrame(s,e,o,{palette:t,delay:1e3/f}),h>=j?(i.finish(),r(new Blob([i.bytes()],{type:"image/gif"}))):g(++x)}else{o||(o=new Worker("/ffmpeg-worker-mp4.js"),c=[]);const e=function(e){var t=e.replace(/^data[^,]+,/,""),n=window.atob(t),r=n.length,a=new Uint8Array(new ArrayBuffer(r));for(let s=0;s<r;s++)a[s]=n.charCodeAt(s);return a}(m.current.captureAsDataURL("image/jpeg",1));c.push({name:"img"+x.toString().padStart(4,0)+".jpeg",data:e}),h>=j?(o.onmessage=function(e){var t=e.data;switch(t.type){case"stdout":case"stderr":console.log(t.data);break;case"exit":console.log("Process exited with code "+t.data);break;case"done":console.log("reached done");const e=new Blob([t.data.MEMFS[0].data],{type:"video/mp4"});r(e)}},o.postMessage({type:"run",TOTAL_MEMORY:268435456,arguments:["-r",String(f),"-i","img%04d.jpeg","-c:v","libx264","-crf","1","-pix_fmt","yuv420p","-vb",n.exportMP4vb||"5M","out.mp4"],MEMFS:c})):g(++x)}},onLoad:()=>{p=!0,y(!0)}}}));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.T,{webglContextAttributes:{preserveDrawingBuffer:!0},onLoad:k.onLoad,ref:m,width:c,height:c,pixelRatio:1,preload:h,children:(0,p.jsx)(o.NearestCopy,{onDraw:k.onDraw,children:(0,p.jsx)(n.Shader,{exporting:!0,time:b,n:t})})}),S+" / "+j]})}const w=s.memo(j);var g=!0;function y({n:e,Day:t,start:n,end:r,framePerSecond:a,speed:o}){const{0:c,1:d}=(0,s.useState)(0);(0,s.useEffect)((()=>{let e,t,n;return n=requestAnimationFrame((function r(s){n=requestAnimationFrame(r),e||(t=e=s),s-t>=1e3/a&&(t=s,d((s-e)/1e3))})),()=>cancelAnimationFrame(n)}),[]);const l=n+o*c%(r-n);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.T,{width:400,height:400,children:(0,p.jsx)(t.Shader,{exporting:!0,time:l,n:e})}),l.toFixed(3)]})}function b({day:e}){const{0:t,1:n}=(0,s.useState)(0),{0:a,1:i}=(0,s.useState)(),o=(0,c.hU)(parseInt(e,10));if(!o)return null;const u=o.exportStart||0,x=o.exportEnd||1,j=o.exportFramePerSecond||24,g=o.exportSkipFrame||0,b=o.exportSpeed||1,S=o.exportSize||800,k=o.preload||[];return(0,p.jsx)(l.x,{children:(0,p.jsxs)(d.W,{children:[(0,p.jsxs)(r.default,{children:[(0,p.jsxs)("title",{children:["One Day One Shader \u2013 Day ",o.n,'. "',o.title,'"']}),(0,p.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,p.jsxs)(f.o,{children:[(0,p.jsx)(m.h,{children:"Export tools"}),(0,p.jsx)(h,{Day:o}),a?(0,p.jsx)(w,{format:a,n:t,start:u,end:x,framePerSecond:j,exportSkipFrame:g,speed:b,size:S,Day:o,onFinished:function(n){!function(e,t){const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.click()}(n,"shaderday_"+e+"_"+t+"."+a),i(null)},preload:k}):(0,p.jsx)(y,{n:t,start:u,end:x,framePerSecond:j,speed:b,Day:o}),(0,p.jsx)("input",{style:{margin:10},value:t,range:1,onChange:e=>n(parseInt(e.target.value,10)),type:"number"}),(0,p.jsx)("button",{onClick:()=>i("gif"),children:"gif"}),(0,p.jsx)("button",{onClick:()=>i("mp4"),children:"mp4"})]})]})})}},2883:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/export/[day]",function(){return n(4223)}])}},function(e){e.O(0,[9774,1511,5988,8764,7250,5996,4674,5958,9144,9830,2888,179],(function(){return t=2883,e(e.s=t);var t}));var t=e.O();_N_E=t}]);