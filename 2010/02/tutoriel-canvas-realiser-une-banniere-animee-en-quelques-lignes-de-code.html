<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="Ce tutoriel vise à présenter canvas comme une librairie très simple d’utilisation et haut niveau grâce au langage javascript."/><meta name="keywords" content="animation, canvas, javascript, bezier"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Tutoriel Canvas : Réaliser une bannière animée en quelques lignes de code"/><meta name="og:title" content="Tutoriel Canvas : Réaliser une bannière animée en quelques lignes de code"/><meta name="twitter:description" content="Ce tutoriel vise à présenter canvas comme une librairie très simple d’utilisation et haut niveau grâce au langage javascript."/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2010/animated_banner.png"/><meta name="twitter:image" content="http://greweb.me//images/2010/animated_banner.png"/><link rel="image_src" href="http://greweb.me//images/2010/animated_banner.png"/><title>@greweb - Tutoriel Canvas : Réaliser une bannière animée en quelques lignes de code</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-381dbb3c33243b4920e6.js"></script><script src="/_next/static/chunks/webpack-17597d20e291f72b2439.js" defer=""></script><script src="/_next/static/chunks/framework-bdc1b4e5e48979e16d36.js" defer=""></script><script src="/_next/static/chunks/main-4ac108dd57980e4159e9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c981e0e3ce59f13eb8d0.js" defer=""></script><script src="/_next/static/chunks/5988-738c1ea5f97353b6463e.js" defer=""></script><script src="/_next/static/chunks/2242-e809902ac2d7a524d02b.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-18d367ef37e4735025ef.js" defer=""></script><script src="/_next/static/hiF3UHQLJTodU4STfgnjM/_buildManifest.js" defer=""></script><script src="/_next/static/hiF3UHQLJTodU4STfgnjM/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Tutoriel Canvas : Réaliser une bannière animée en quelques lignes de code</a></h1><time class="date" dateTime="2010-02-03">2010-02-03</time><span class="tags"><a class="tag">animation</a><a class="tag">canvas</a><a class="tag">javascript</a><a class="tag">bezier</a></span></header><div class="entry-content"><p><img src="/images/2010/animated_banner.png" alt=""></p>
<p><strong>Pré-requis conseillé: <a href="/2011/03/html-canvas-pour-les-neophytes">Voir la vidéo : HTML Canvas pour les néophytes</a></strong></p>
<p>Le <strong>HTML 5</strong> intègre de nouvelles technologies comme le <strong>canvas</strong>, une véritable API graphique destinée à remplacer le flash dans les années à venir.</p>
<p>Ce tutoriel vise à présenter <strong>canvas</strong> comme une <strong>librairie très simple d’utilisation et haut niveau</strong> grâce au langage <strong>javascript</strong>.</p>
<p>Il vous apprendra à réaliser une animation similaire à la bannière <del>actuelle</del> (ancienne maintenant) de mon blog en <strong>quelques lignes de code</strong>.</p>
<p>Il est volontairement ordonnancé de manière didactique, si vous maitriser les concepts, n’hésitez pas à avancer.</p>
<!--more-->

<h2 id="code-de-base-skeleton-template">Code de base (skeleton template)</h2>
<p>Nous allons travailler avec ce code <strong>html</strong> de base :</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;canvas id=&quot;tuto&quot; width=&quot;500&quot; height=&quot;100&quot; style=&quot;border: 1px solid;&quot;&gt;&lt;/canvas&gt;
    &lt;script language=&quot;javascript&quot;&gt;
      var canvas = document.getElementById(&#39;tuto&#39;);
      var ctx = canvas.getContext(&#39;2d&#39;);

      // Le code javascript ira ici

    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Ce code nous servira dans tous le reste du tutoriel. </p>
<h3 id="deux-choses-notables-">Deux choses notables :</h3>
<ul>
<li>Nous avons créé un élément <strong>canvas</strong> et indiqué ses dimensions <strong>(500×100)</strong>. Pour mieux pouvoir repérer ses dimensions, nous lui avons ajouté une bordure.</li>
<li>En <strong>javascript</strong>, nous avons récupéré l’élément DOM puis le contexte 2d qui nous servira pas la suite.</li>
</ul>
<h2 id="quelques-notions-de-base-du-canvas">Quelques notions de base du canvas</h2>
<h3 id="la-surface-du-canvas">La surface du canvas</h3>
<p>Le <strong>canvas</strong> occupe une surface dont la dimension est définie par les paramètres <em>width</em> et <em>height</em>.</p>
<p>Pour ceux qui ne serait pas familier avec les <strong>bibliothèques graphiques</strong>, cette surface peut être vu comme un quadrillage de pixel sur <strong>deux dimensions</strong> : <strong>x</strong> variant de <em>0 à width</em> et <strong>y</strong> variant de <em>0 à height</em>.</p>
<p>Le point d’origine de ce repère orthonormé est situé <strong>dans le coin haut gauche du canvas</strong>:</p>
<p><img src="/demo/animate-banner/canvas-cartesian.png" alt=""></p>
<h3 id="le-concept-de-contexte">Le concept de contexte</h3>
<p>Le contexte 2d récupéré dans la variable <strong>ctx</strong> est en fait l’<strong>interface de programmation</strong> (API) de la bibliothèque graphique <strong>canvas</strong>.</p>
<p>C’est en quelque sorte l’<strong>intermédiaire entre le programmeur et la bibliothèque graphique</strong>.</p>
<p>Ainsi par exemple, si l’on veux dessiner un rectangle de dimension <strong>20×10</strong> à la position <strong>(5,6)</strong>, il suffit simplement d’écrire: </p>
<pre><code class="language-javascript">ctx.fillRect(5,6,20,10)
</code></pre>
<h3 id="les-paramètres-globaux-du-canvas">Les paramètres globaux du canvas</h3>
<p>Pour dessiner, toute librairie graphique a besoin de connaitre un certain nombre de paramètres tels que la <em>couleur du trait, la taille de la brosse, etc</em>.</p>
<p>Plutôt que de devoir passer en paramètre ces informations aux fonctions du contexte, <strong>canvas</strong> met directement à disposition ses paramètres afin de pouvoir les modifier facilement.</p>
<p>Ainsi, nous pourrons définir la couleur de remplissage dans <strong>ctx.fillStyle</strong> et la couleur de trait dans <strong>ctx.strokeStyle</strong>.</p>
<h2 id="commençons-à-coder">Commençons à coder</h2>
<p>Avant d’attaquer l’animation, nous allons commencer à manier les <strong>outils de tracage</strong>.</p>
<h3 id="chemins-et-traits-simples">Chemins et traits simples</h3>
<p>Nous allons commencer par tracer un trait simple qui va traverser tous le canvas.</p>
<p>Essayez le code suivant:</p>
<pre><code class="language-javascript">ctx.beginPath();              // commence à tracer un chemin  
ctx.moveTo(, 20);             // défini le premier point de tracage à la position (0, 20)  
ctx.lineTo(canvas.width, 30); // Tracer une ligne jusqu&#39;à la position (canvas.width, 30). canvas.width désigne la largeur du canvas (500 dans notre exemple).  
ctx.stroke();                 // Indique au canvas de dessiner le chemin tracé depuis le beginPath
</code></pre>
<p><a href="/demo/animate-banner/step1.html">Voir le résultat</a></p>
<h3 id="chemins-et-courbes-de-bézier">Chemins et courbes de bézier</h3>
<h4 id="la-notion-de-courbe-de-bézier">La notion de courbe de bézier</h4>
<p>Une courbe de bézier est définie par 4 points :</p>
<ul>
<li>  Deux points désignant le début et la fin du trait.</li>
<li>  Deux points appelés <strong>poignées</strong> permettant de contrôler la courbe.</li>
</ul>
<p><img src="/demo/animate-banner/bezier-schema.png" alt=""></p>
<h4 id="application-en-canvas">Application en canvas</h4>
<p>Essayez le code suivant :</p>
<pre><code class="language-javascript">ctx.beginPath();  
ctx.moveTo(, 20);  
ctx.bezierCurveTo(canvas.width/3, canvas.height, 2*canvas.width/3, , canvas.width, 20);  
ctx.stroke();
</code></pre>
<p><a href="/demo/animate-banner/step2.html">Voir le résultat</a></p>
<p><strong>De la même façon, la procédure consiste à:</strong></p>
<ul>
<li>commencer un chemin,</li>
<li>se placer à une certaine position,</li>
<li>effectuer un traçage (courbe de bézier),</li>
<li>terminer le traçage (<strong>ctx.stroke()</strong>).</li>
</ul>
<p>Intéressons nous plus particulièrement au traçage de la courbe de bézier avec l’appel de <strong>ctx.bezierCurveTo</strong>.</p>
<h5 id="beziercurvetocp1x-cp1y-cp2x-cp2y-x-y">bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)</h5>
<p>Cette fonction prends en argument les coordonnées du premier point de contrôle <strong>(cp1x, cp1y)</strong>, du deuxième point de contrôle <strong>(cp2x, cp2y)</strong> et du point final <strong>(x, y)</strong>. A noter que le point de début est le point sur lequel on s’est placé au moyen de <strong>moveTo</strong>.</p>
<p><strong>Dans notre exemple, les deux points de contrôle sont placés ainsi :</strong></p>
<p><img src="/demo/animate-banner/bezier-exemple.png" alt=""></p>
<h3 id="ajout-de-lanimation">Ajout de l’animation</h3>
<p>Pour animer notre courbe de bézier, nous allons faire varier les 4 points de notre courbe en fonction du temps.</p>
<p>En javascript, il y a deux moyen d’effectuer une animation :</p>
<ul>
<li><del>Au moyen de <strong>setInterval</strong> permettant d’appeler une fonction par interval de temps régulier.</del></li>
<li><del>Au moyen de <strong>setTimeout</strong> permettant d’appeler une fonction après un temps donné.</del></li>
<li><strong>[UPDATE 2011]</strong> Il est maintenant recommandé d’utiliser <strong>requestAnimationFrame</strong> qui est l’équivalent de setTimeout mais destiné à l’animation donc plus performant. <a href="http://paulirish.com/2011/requestanimationframe-for-smart-animating/">Plus d’informations içi (en)</a></li>
</ul>
<p>La première approche est parfaite pour une animation <strong>“statique”, avec peu d’intéraction</strong>.</p>
<p>La seconde approche est intéressante lorsque l’animation <strong>doit être contrôlée</strong> (intéraction). En effet, cette approche consiste à appeler setTimeout à chaque cycle d’animation.</p>
<p>Nous choisirons d’utiliser <strong>setInterval</strong>, plus simple et plus adaptée à notre tutoriel.</p>
<h4 id="approche-linéaire">Approche linéaire</h4>
<p>Commençons simplement par une <strong>évolution linéaire des points</strong>.</p>
<p>Essayez le code suivant :</p>
<pre><code class="language-javascript">var i = 0; // variable fonction du temps
var cycle = function() {
  ctx.clearRect(0,0,canvas.width,canvas.height); // clean the canvas
  var y = Math.abs(canvas.height-i%(2*canvas.height)); // y évolue par rebond entre 0 et canvas.height au cours du temps (linéarité)
  ctx.beginPath();
  ctx.moveTo(0, y);
  ctx.bezierCurveTo(canvas.width/3, canvas.height/2, 2*canvas.width/3, canvas.height/2, canvas.width, y);
  ctx.stroke();
  i++;
};
setInterval(cycle, 30); // lance le cycle chaque 30 millisecondes
</code></pre>
<p><a href="/demo/animate-banner/step3.html">Voir le résultat</a></p>
<p>Pour l’instant les poignées sont fixes et l’évolution linéaire de <strong>y</strong> donne un effet de rebond peu intéréssant.</p>
<p>C’est pour cela que nous abandonnons l’idée d’une évolution linéaire des positions au cours du temps pour l’approche sinusoïdale.</p>
<h4 id="approche-sinusoïdale">Approche sinusoïdale</h4>
<p>Comme nous l’avons vu, l’évolution linéaire n’est pas adaptée pour ce genre d’animation (effet de rebond). Il faudrait rendre l’animation plus fluide.</p>
<p>Pour cela, nous allons utiliser <strong>une évolution sinusoïdale des positions au cours du temps</strong>.</p>
<p>Essayez le code suivant :</p>
<pre><code class="language-javascript">var i = 0; // variable fonction du temps
var cycle = function() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  var offset = i/20;
  var y = (Math.sin(offset)+1)*canvas.height/2; // y varie de 0 à canvas.height
  var cpy1 = (Math.cos(offset)+0.5)*canvas.height; // les poignées évoluent également de façon sinusoïdale
  var cpy2 = canvas.height - cpy1;
  ctx.beginPath();
  ctx.moveTo(0, y);
  ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);
  ctx.stroke();
  i++;
};
setInterval(cycle, 30);
</code></pre>
<p><a href="/demo/animate-banner/step4.html">Voir le résultat</a></p>
<h3 id="peaufinage">Peaufinage</h3>
<h4 id="amélioration-du-style-du-trait">Amélioration du style du trait</h4>
<p>Essayez le code suivant :</p>
<pre><code class="language-javascript">ctx.strokeStyle = &#39;rgba(80,150,240,0.5)&#39;; // couleur bleu avec opacité de 50%
ctx.lineWidth = 5; // épaisseur de trait de 5 pixels
var i = 0;
var cycle = function() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  var offset = i/20;
  var y = (Math.sin(offset)+1)*canvas.height/2;
  var cpy1 = (Math.cos(offset)+0.5)*canvas.height;
  var cpy2 = canvas.height - cpy1;
  ctx.beginPath();
  ctx.moveTo(0, y);
  ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);
  ctx.stroke();
  i++;
};
setInterval(cycle, 30);
</code></pre>
<p><a href="/demo/animate-banner/step5.html">Voir le résultat</a></p>
<h4 id="ajout-de-plusieurs-courbes">Ajout de plusieurs courbes</h4>
<p>Pour avoir un effet plus accrochant, nous allons ajouter plusieurs courbes de bézier avec un décalage temporel entre elles.</p>
<p>Nous allons également attribuer plusieurs styles aux différentes courbes.</p>
<pre><code class="language-javascript">var numberOfLines = 5;
var i = 0;
var cycle = function() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(var j=0; j&lt;numberOfLines; ++j) {
    var offset = (i+j*10)/20;
    ctx.lineWidth = 1+2*(numberOfLines-j); // épaisseur variable en fonction de la ligne
    ctx.strokeStyle = &#39;rgba(80,150,240,&#39;+(j/5+0.1)+&#39;)&#39;; // opacité variable en fonction de la ligne
    var y = (Math.sin(offset)+1)*canvas.height/2;
    var cpy1 = (Math.cos(offset)+0.5)*canvas.height;
    var cpy2 = canvas.height - cpy1;
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);
    ctx.stroke();
  }
  i++;
};
setInterval(cycle, 30);
</code></pre>
<p><a href="/demo/animate-banner/step6.html">Voir le résultat</a></p>
<h3 id="aller-plus-loin">Aller plus loin</h3>
<p>Il est possible de continuer encore plus loin en ajoutant l’<strong>évolution de plusieurs paramètres en fonction du temps</strong>.
Pour conclure, voici la démonstration finale:</p>
<pre><code class="language-javascript">var i = 0;
var cycle = function() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for(var j=0; j&lt;numberOfLines; ++j) {
    ctx.lineWidth = 1+2*(numberOfLines-j);
    ctx.strokeStyle = &#39;rgba(100,200,&#39;+Math.floor(Math.abs(Math.cos(i/80)*256))+&#39;,&#39;+(j/5+0.1)+&#39;)&#39;;
    var offset = (i+j*10*Math.abs(Math.cos(i/100)))/20;
    var y = (Math.sin(offset)+1)*canvas.height/2;
    var cpy1 = (Math.cos(offset)+0.5)*canvas.height;
    var cpy2 = canvas.height - cpy1;
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);
    ctx.stroke();
  }
  i++;
};
setInterval(cycle, 30);
</code></pre>
<p><a href="/demo/animate-banner/final.html">Voir le résultat</a></p>
<p>Nous avons ajouté:</p>
<ul>
<li>L’évolution de la <strong>couleur</strong> au cours du temps.</li>
<li>L’évolution du <strong>décalage entre les courbes</strong> au cours du temps.</li>
</ul>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/logo.svg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">As a generative plotter artist, I use code to create art (creative coding), draw with fountain pens on robots (plotting), and explore the boundaries of abstract art using algorithms in pursuit of increasingly realistic imagery. I do not produce prints; instead, I create unique &#x27;plots&#x27; - physical works of art that are truly one-of-a-kind.</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://opensea.io/greweb?tab=created" class="jsx-2519965637"><img alt="" src="/icons/eth.svg" class="jsx-2519965637"/></a><a href="https://fxhash.xyz/u/greweb" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2010-02-03-tutoriel-canvas-realiser-une-banniere-animee-en-quelques-lignes-de-code","year":"2010","month":"02","day":"03","slug":"tutoriel-canvas-realiser-une-banniere-animee-en-quelques-lignes-de-code","content":"\u003cp\u003e\u003cimg src=\"/images/2010/animated_banner.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePré-requis conseillé: \u003ca href=\"/2011/03/html-canvas-pour-les-neophytes\"\u003eVoir la vidéo : HTML Canvas pour les néophytes\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eLe \u003cstrong\u003eHTML 5\u003c/strong\u003e intègre de nouvelles technologies comme le \u003cstrong\u003ecanvas\u003c/strong\u003e, une véritable API graphique destinée à remplacer le flash dans les années à venir.\u003c/p\u003e\n\u003cp\u003eCe tutoriel vise à présenter \u003cstrong\u003ecanvas\u003c/strong\u003e comme une \u003cstrong\u003elibrairie très simple d’utilisation et haut niveau\u003c/strong\u003e grâce au langage \u003cstrong\u003ejavascript\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIl vous apprendra à réaliser une animation similaire à la bannière \u003cdel\u003eactuelle\u003c/del\u003e (ancienne maintenant) de mon blog en \u003cstrong\u003equelques lignes de code\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIl est volontairement ordonnancé de manière didactique, si vous maitriser les concepts, n’hésitez pas à avancer.\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003ch2 id=\"code-de-base-skeleton-template\"\u003eCode de base (skeleton template)\u003c/h2\u003e\n\u003cp\u003eNous allons travailler avec ce code \u003cstrong\u003ehtml\u003c/strong\u003e de base :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\n\u0026lt;html\u0026gt;\n  \u0026lt;head\u0026gt;\u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt;\n  \u0026lt;body\u0026gt;\n    \u0026lt;canvas id=\u0026quot;tuto\u0026quot; width=\u0026quot;500\u0026quot; height=\u0026quot;100\u0026quot; style=\u0026quot;border: 1px solid;\u0026quot;\u0026gt;\u0026lt;/canvas\u0026gt;\n    \u0026lt;script language=\u0026quot;javascript\u0026quot;\u0026gt;\n      var canvas = document.getElementById(\u0026#39;tuto\u0026#39;);\n      var ctx = canvas.getContext(\u0026#39;2d\u0026#39;);\n\n      // Le code javascript ira ici\n\n    \u0026lt;/script\u0026gt;\n  \u0026lt;/body\u0026gt;\n\u0026lt;/html\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCe code nous servira dans tous le reste du tutoriel. \u003c/p\u003e\n\u003ch3 id=\"deux-choses-notables-\"\u003eDeux choses notables :\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eNous avons créé un élément \u003cstrong\u003ecanvas\u003c/strong\u003e et indiqué ses dimensions \u003cstrong\u003e(500×100)\u003c/strong\u003e. Pour mieux pouvoir repérer ses dimensions, nous lui avons ajouté une bordure.\u003c/li\u003e\n\u003cli\u003eEn \u003cstrong\u003ejavascript\u003c/strong\u003e, nous avons récupéré l’élément DOM puis le contexte 2d qui nous servira pas la suite.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"quelques-notions-de-base-du-canvas\"\u003eQuelques notions de base du canvas\u003c/h2\u003e\n\u003ch3 id=\"la-surface-du-canvas\"\u003eLa surface du canvas\u003c/h3\u003e\n\u003cp\u003eLe \u003cstrong\u003ecanvas\u003c/strong\u003e occupe une surface dont la dimension est définie par les paramètres \u003cem\u003ewidth\u003c/em\u003e et \u003cem\u003eheight\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003ePour ceux qui ne serait pas familier avec les \u003cstrong\u003ebibliothèques graphiques\u003c/strong\u003e, cette surface peut être vu comme un quadrillage de pixel sur \u003cstrong\u003edeux dimensions\u003c/strong\u003e : \u003cstrong\u003ex\u003c/strong\u003e variant de \u003cem\u003e0 à width\u003c/em\u003e et \u003cstrong\u003ey\u003c/strong\u003e variant de \u003cem\u003e0 à height\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eLe point d’origine de ce repère orthonormé est situé \u003cstrong\u003edans le coin haut gauche du canvas\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/demo/animate-banner/canvas-cartesian.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"le-concept-de-contexte\"\u003eLe concept de contexte\u003c/h3\u003e\n\u003cp\u003eLe contexte 2d récupéré dans la variable \u003cstrong\u003ectx\u003c/strong\u003e est en fait l’\u003cstrong\u003einterface de programmation\u003c/strong\u003e (API) de la bibliothèque graphique \u003cstrong\u003ecanvas\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eC’est en quelque sorte l’\u003cstrong\u003eintermédiaire entre le programmeur et la bibliothèque graphique\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eAinsi par exemple, si l’on veux dessiner un rectangle de dimension \u003cstrong\u003e20×10\u003c/strong\u003e à la position \u003cstrong\u003e(5,6)\u003c/strong\u003e, il suffit simplement d’écrire: \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003ectx.fillRect(5,6,20,10)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"les-paramètres-globaux-du-canvas\"\u003eLes paramètres globaux du canvas\u003c/h3\u003e\n\u003cp\u003ePour dessiner, toute librairie graphique a besoin de connaitre un certain nombre de paramètres tels que la \u003cem\u003ecouleur du trait, la taille de la brosse, etc\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003ePlutôt que de devoir passer en paramètre ces informations aux fonctions du contexte, \u003cstrong\u003ecanvas\u003c/strong\u003e met directement à disposition ses paramètres afin de pouvoir les modifier facilement.\u003c/p\u003e\n\u003cp\u003eAinsi, nous pourrons définir la couleur de remplissage dans \u003cstrong\u003ectx.fillStyle\u003c/strong\u003e et la couleur de trait dans \u003cstrong\u003ectx.strokeStyle\u003c/strong\u003e.\u003c/p\u003e\n\u003ch2 id=\"commençons-à-coder\"\u003eCommençons à coder\u003c/h2\u003e\n\u003cp\u003eAvant d’attaquer l’animation, nous allons commencer à manier les \u003cstrong\u003eoutils de tracage\u003c/strong\u003e.\u003c/p\u003e\n\u003ch3 id=\"chemins-et-traits-simples\"\u003eChemins et traits simples\u003c/h3\u003e\n\u003cp\u003eNous allons commencer par tracer un trait simple qui va traverser tous le canvas.\u003c/p\u003e\n\u003cp\u003eEssayez le code suivant:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003ectx.beginPath();              // commence à tracer un chemin  \nctx.moveTo(, 20);             // défini le premier point de tracage à la position (0, 20)  \nctx.lineTo(canvas.width, 30); // Tracer une ligne jusqu\u0026#39;à la position (canvas.width, 30). canvas.width désigne la largeur du canvas (500 dans notre exemple).  \nctx.stroke();                 // Indique au canvas de dessiner le chemin tracé depuis le beginPath\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/step1.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"chemins-et-courbes-de-bézier\"\u003eChemins et courbes de bézier\u003c/h3\u003e\n\u003ch4 id=\"la-notion-de-courbe-de-bézier\"\u003eLa notion de courbe de bézier\u003c/h4\u003e\n\u003cp\u003eUne courbe de bézier est définie par 4 points :\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e  Deux points désignant le début et la fin du trait.\u003c/li\u003e\n\u003cli\u003e  Deux points appelés \u003cstrong\u003epoignées\u003c/strong\u003e permettant de contrôler la courbe.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/demo/animate-banner/bezier-schema.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"application-en-canvas\"\u003eApplication en canvas\u003c/h4\u003e\n\u003cp\u003eEssayez le code suivant :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003ectx.beginPath();  \nctx.moveTo(, 20);  \nctx.bezierCurveTo(canvas.width/3, canvas.height, 2*canvas.width/3, , canvas.width, 20);  \nctx.stroke();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/step2.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDe la même façon, la procédure consiste à:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecommencer un chemin,\u003c/li\u003e\n\u003cli\u003ese placer à une certaine position,\u003c/li\u003e\n\u003cli\u003eeffectuer un traçage (courbe de bézier),\u003c/li\u003e\n\u003cli\u003eterminer le traçage (\u003cstrong\u003ectx.stroke()\u003c/strong\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIntéressons nous plus particulièrement au traçage de la courbe de bézier avec l’appel de \u003cstrong\u003ectx.bezierCurveTo\u003c/strong\u003e.\u003c/p\u003e\n\u003ch5 id=\"beziercurvetocp1x-cp1y-cp2x-cp2y-x-y\"\u003ebezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)\u003c/h5\u003e\n\u003cp\u003eCette fonction prends en argument les coordonnées du premier point de contrôle \u003cstrong\u003e(cp1x, cp1y)\u003c/strong\u003e, du deuxième point de contrôle \u003cstrong\u003e(cp2x, cp2y)\u003c/strong\u003e et du point final \u003cstrong\u003e(x, y)\u003c/strong\u003e. A noter que le point de début est le point sur lequel on s’est placé au moyen de \u003cstrong\u003emoveTo\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDans notre exemple, les deux points de contrôle sont placés ainsi :\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/demo/animate-banner/bezier-exemple.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"ajout-de-lanimation\"\u003eAjout de l’animation\u003c/h3\u003e\n\u003cp\u003ePour animer notre courbe de bézier, nous allons faire varier les 4 points de notre courbe en fonction du temps.\u003c/p\u003e\n\u003cp\u003eEn javascript, il y a deux moyen d’effectuer une animation :\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cdel\u003eAu moyen de \u003cstrong\u003esetInterval\u003c/strong\u003e permettant d’appeler une fonction par interval de temps régulier.\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e\u003cdel\u003eAu moyen de \u003cstrong\u003esetTimeout\u003c/strong\u003e permettant d’appeler une fonction après un temps donné.\u003c/del\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e[UPDATE 2011]\u003c/strong\u003e Il est maintenant recommandé d’utiliser \u003cstrong\u003erequestAnimationFrame\u003c/strong\u003e qui est l’équivalent de setTimeout mais destiné à l’animation donc plus performant. \u003ca href=\"http://paulirish.com/2011/requestanimationframe-for-smart-animating/\"\u003ePlus d’informations içi (en)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLa première approche est parfaite pour une animation \u003cstrong\u003e“statique”, avec peu d’intéraction\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eLa seconde approche est intéressante lorsque l’animation \u003cstrong\u003edoit être contrôlée\u003c/strong\u003e (intéraction). En effet, cette approche consiste à appeler setTimeout à chaque cycle d’animation.\u003c/p\u003e\n\u003cp\u003eNous choisirons d’utiliser \u003cstrong\u003esetInterval\u003c/strong\u003e, plus simple et plus adaptée à notre tutoriel.\u003c/p\u003e\n\u003ch4 id=\"approche-linéaire\"\u003eApproche linéaire\u003c/h4\u003e\n\u003cp\u003eCommençons simplement par une \u003cstrong\u003eévolution linéaire des points\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eEssayez le code suivant :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar i = 0; // variable fonction du temps\nvar cycle = function() {\n  ctx.clearRect(0,0,canvas.width,canvas.height); // clean the canvas\n  var y = Math.abs(canvas.height-i%(2*canvas.height)); // y évolue par rebond entre 0 et canvas.height au cours du temps (linéarité)\n  ctx.beginPath();\n  ctx.moveTo(0, y);\n  ctx.bezierCurveTo(canvas.width/3, canvas.height/2, 2*canvas.width/3, canvas.height/2, canvas.width, y);\n  ctx.stroke();\n  i++;\n};\nsetInterval(cycle, 30); // lance le cycle chaque 30 millisecondes\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/step3.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePour l’instant les poignées sont fixes et l’évolution linéaire de \u003cstrong\u003ey\u003c/strong\u003e donne un effet de rebond peu intéréssant.\u003c/p\u003e\n\u003cp\u003eC’est pour cela que nous abandonnons l’idée d’une évolution linéaire des positions au cours du temps pour l’approche sinusoïdale.\u003c/p\u003e\n\u003ch4 id=\"approche-sinusoïdale\"\u003eApproche sinusoïdale\u003c/h4\u003e\n\u003cp\u003eComme nous l’avons vu, l’évolution linéaire n’est pas adaptée pour ce genre d’animation (effet de rebond). Il faudrait rendre l’animation plus fluide.\u003c/p\u003e\n\u003cp\u003ePour cela, nous allons utiliser \u003cstrong\u003eune évolution sinusoïdale des positions au cours du temps\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eEssayez le code suivant :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar i = 0; // variable fonction du temps\nvar cycle = function() {\n  ctx.clearRect(0,0,canvas.width,canvas.height);\n  var offset = i/20;\n  var y = (Math.sin(offset)+1)*canvas.height/2; // y varie de 0 à canvas.height\n  var cpy1 = (Math.cos(offset)+0.5)*canvas.height; // les poignées évoluent également de façon sinusoïdale\n  var cpy2 = canvas.height - cpy1;\n  ctx.beginPath();\n  ctx.moveTo(0, y);\n  ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);\n  ctx.stroke();\n  i++;\n};\nsetInterval(cycle, 30);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/step4.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"peaufinage\"\u003ePeaufinage\u003c/h3\u003e\n\u003ch4 id=\"amélioration-du-style-du-trait\"\u003eAmélioration du style du trait\u003c/h4\u003e\n\u003cp\u003eEssayez le code suivant :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003ectx.strokeStyle = \u0026#39;rgba(80,150,240,0.5)\u0026#39;; // couleur bleu avec opacité de 50%\nctx.lineWidth = 5; // épaisseur de trait de 5 pixels\nvar i = 0;\nvar cycle = function() {\n  ctx.clearRect(0,0,canvas.width,canvas.height);\n  var offset = i/20;\n  var y = (Math.sin(offset)+1)*canvas.height/2;\n  var cpy1 = (Math.cos(offset)+0.5)*canvas.height;\n  var cpy2 = canvas.height - cpy1;\n  ctx.beginPath();\n  ctx.moveTo(0, y);\n  ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);\n  ctx.stroke();\n  i++;\n};\nsetInterval(cycle, 30);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/step5.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003ch4 id=\"ajout-de-plusieurs-courbes\"\u003eAjout de plusieurs courbes\u003c/h4\u003e\n\u003cp\u003ePour avoir un effet plus accrochant, nous allons ajouter plusieurs courbes de bézier avec un décalage temporel entre elles.\u003c/p\u003e\n\u003cp\u003eNous allons également attribuer plusieurs styles aux différentes courbes.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar numberOfLines = 5;\nvar i = 0;\nvar cycle = function() {\n  ctx.clearRect(0,0,canvas.width,canvas.height);\n  for(var j=0; j\u0026lt;numberOfLines; ++j) {\n    var offset = (i+j*10)/20;\n    ctx.lineWidth = 1+2*(numberOfLines-j); // épaisseur variable en fonction de la ligne\n    ctx.strokeStyle = \u0026#39;rgba(80,150,240,\u0026#39;+(j/5+0.1)+\u0026#39;)\u0026#39;; // opacité variable en fonction de la ligne\n    var y = (Math.sin(offset)+1)*canvas.height/2;\n    var cpy1 = (Math.cos(offset)+0.5)*canvas.height;\n    var cpy2 = canvas.height - cpy1;\n    ctx.beginPath();\n    ctx.moveTo(0, y);\n    ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);\n    ctx.stroke();\n  }\n  i++;\n};\nsetInterval(cycle, 30);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/step6.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"aller-plus-loin\"\u003eAller plus loin\u003c/h3\u003e\n\u003cp\u003eIl est possible de continuer encore plus loin en ajoutant l’\u003cstrong\u003eévolution de plusieurs paramètres en fonction du temps\u003c/strong\u003e.\nPour conclure, voici la démonstration finale:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar i = 0;\nvar cycle = function() {\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  for(var j=0; j\u0026lt;numberOfLines; ++j) {\n    ctx.lineWidth = 1+2*(numberOfLines-j);\n    ctx.strokeStyle = \u0026#39;rgba(100,200,\u0026#39;+Math.floor(Math.abs(Math.cos(i/80)*256))+\u0026#39;,\u0026#39;+(j/5+0.1)+\u0026#39;)\u0026#39;;\n    var offset = (i+j*10*Math.abs(Math.cos(i/100)))/20;\n    var y = (Math.sin(offset)+1)*canvas.height/2;\n    var cpy1 = (Math.cos(offset)+0.5)*canvas.height;\n    var cpy2 = canvas.height - cpy1;\n    ctx.beginPath();\n    ctx.moveTo(0, y);\n    ctx.bezierCurveTo(canvas.width/3, cpy1, 2*canvas.width/3, cpy2, canvas.width, y);\n    ctx.stroke();\n  }\n  i++;\n};\nsetInterval(cycle, 30);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"/demo/animate-banner/final.html\"\u003eVoir le résultat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eNous avons ajouté:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eL’évolution de la \u003cstrong\u003ecouleur\u003c/strong\u003e au cours du temps.\u003c/li\u003e\n\u003cli\u003eL’évolution du \u003cstrong\u003edécalage entre les courbes\u003c/strong\u003e au cours du temps.\u003c/li\u003e\n\u003c/ul\u003e\n","data":{"title":"Tutoriel Canvas : Réaliser une bannière animée en quelques lignes de code","thumbnail":"/images/2010/animated_banner.png","description":"Ce tutoriel vise à présenter canvas comme une librairie très simple d’utilisation et haut niveau grâce au langage javascript.","author":"Gaetan","layout":"post","permalink":"/2010/02/tutoriel-canvas-realiser-une-banniere-animee-en-quelques-lignes-de-code","tags":["animation","canvas","javascript","bezier"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2010","month":"02","slug":"tutoriel-canvas-realiser-une-banniere-animee-en-quelques-lignes-de-code"},"buildId":"hiF3UHQLJTodU4STfgnjM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>