<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="If you have ever made a chart library in your life, you’ve probably asked yourself how to find the best scale for the grid in order to have nice values to display in the axis."/><meta name="keywords" content="javascript, math"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Chart libraries headaches – finding the best grid step"/><meta name="og:title" content="Chart libraries headaches – finding the best grid step"/><meta name="twitter:description" content="If you have ever made a chart library in your life, you’ve probably asked yourself how to find the best scale for the grid in order to have nice values to display in the axis."/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2012/02/wrong-chart-scale.png"/><meta name="twitter:image" content="http://greweb.me//images/2012/02/wrong-chart-scale.png"/><link rel="image_src" href="http://greweb.me//images/2012/02/wrong-chart-scale.png"/><title>@greweb - Chart libraries headaches – finding the best grid step</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-682ed58dee9e3e5c50ef.js" defer=""></script><script src="/_next/static/chunks/framework-c93ed74a065331c4bd75.js" defer=""></script><script src="/_next/static/chunks/main-005750ed97c879f2d59b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-092526a60f8cb7d1b3d6.js" defer=""></script><script src="/_next/static/chunks/988-83f401159b53b3fa4628.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-0f67605ef98ac8184736.js" defer=""></script><script src="/_next/static/S3Z5qT3u2kAg4fq91nZqQ/_buildManifest.js" defer=""></script><script src="/_next/static/S3Z5qT3u2kAg4fq91nZqQ/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Chart libraries headaches – finding the best grid step</a></h1><time class="date" dateTime="2012-03-06">2012-03-06</time><span class="tags"><a class="tag">javascript</a><a class="tag">math</a></span></header><div class="entry-content"><h1 id=""></h1>
<img src="/images/2012/02/wrong-chart-scale.png" class="thumbnail-left" />

<p>If you have ever made a chart library in your life, you’ve probably asked yourself how to find the best scale for the grid in order to have <strong>nice values to display in the axis</strong>.</p>
<p>Most of the time, <strong>data ranges are unknown</strong>, hence we need to <strong>adapt the grid step</strong> to provide the best display.</p>
<h2 id="check-this-out">Check this out</h2>
<iframe src="/demo/grid-utils/" frameborder="0" width="525" height="140"></iframe>

<p>Let’s explain the algorithm…</p>
<!--more-->

<h2 id="about-scientific-notation">About scientific notation</h2>
<p>Any number can be formatted in scientific notation. It is written in the form of <strong>A x 10N</strong> and is noted <strong>AeN</strong>.</p>
<p>For instance, 2300 becomes <strong>2.3e3</strong> (because 2300 = 2.3 x 103), 12 becomes <strong>1.2e1</strong>, and 0.23 becomes <strong>2.3e-1</strong>.</p>
<p>Scientific notation is exactly made for <strong>displaying huge or tiny values in a few characters</strong>.<br>We can use the same principle for finding good values for the step scale, we can just <strong>keep the pow of 10</strong> part (<strong>N</strong>) and <strong>round the value part</strong> (<strong>A</strong>).</p>
<h2 id="magic-numbers">Magic numbers</h2>
<p>But <strong>rounding is not enough</strong>, I have found that good pattern numbers of step range is those divisible by 2, 5 and 10.</p>
<p>In math term, we need to find a step range <em>sr</em>, where</p>
<pre><code>∀ n ∈ |N, ∀ a ∈ {1, 2, 5}, ∃ sr, sr = a x 10^n
</code></pre>
<p>This is basically because 2 x 5 = 10 : using a step of 5 we have a 10 modularity every 2 step, and, using a step of 2 we have a 10 modularity every 5 step.</p>
<p>** 2 step:** 0 2 4 6 8 <strong>10</strong> 12 14 16 18 <strong>20</strong> …<br>** 5 step:** 0 5 <strong>10</strong> 15 <strong>20</strong> 25 <strong>30</strong> 35 <strong>40</strong> 45 …<br><strong>10 step:</strong> <strong>0 10 20 30 40 50 60 70 80 90</strong> …</p>
<p>For any dataset, we need to fallback on the closest step range in all of possible step ranges: … 0.002, 0.02, 0.2, 2, 20, 200, …, … 0.005, 0.05, 0.5, 5, 50, 500, …, and … 0.001, 0.01, 0.1, 1, 10, 100, …,</p>
<h3 id="calculate-the-pow-of-10">Calculate the pow of 10</h3>
<p>To get the <strong>N</strong> value of the <strong>A x 10N</strong> form, we can use the log of 10:</p>
<pre><code class="language-javascript">N = Math.log(number) / Math.log(10);
</code></pre>
<h3 id="calculate-the-value-modulo-10">Calculate the value modulo 10</h3>
<p>To get the <strong>A</strong> value of the <strong>A x 10N</strong> form, we can just divide the number by <strong>10N</strong>:</p>
<pre><code class="language-javascript">A = number / Math.pow(10, N);
</code></pre>
<h3 id="rounding-the-number">‘Rounding’ the number</h3>
<p>We know just need to change the value of <strong>A</strong> and make it more “readable”.<br>We can map the value as follow:</p>
<pre><code>if A ∈ [0, 1.5[ then A becomes 1
if A ∈ [1.5, 3.5[ then A becomes 2
if A ∈ [3.5, 7.5[ then A becomes 5
if A ∈ [7.5, 10[ then A becomes 10
</code></pre>
<p>Note that these rules may probably be improved, I would love if someone could improve this (because I use a arithmetic mean approach and it should probably be arithmetic).</p>
<h2 id="implementation">Implementation</h2>
<h3 id="scala">Scala</h3>
<script src="https://gist.github.com/1987311.js?file=GridUtils.scala"></script>

<h3 id="javascript">Javascript</h3>
<script src="https://gist.github.com/1987311.js?file=GridUtils.js"></script>

<p><strong>Usage example:</strong></p>
<pre><code class="language-javascript">GridUtils.findNiceRoundStep(xMax, 10);
</code></pre>
<p>where <em>xMax</em> is the scale of the axis, and <em>10</em> is the desired number of graduation split.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Finding the best grid step is finally a simple thing to implement but is an essential feature every chart libraries should have.</p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/profile.jpg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">creative coder experimenting with GLSL shaders, Rust, and fountain pens robot plots. infinite noise explorer.</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a><a href="https://hic.link/greweb" class="jsx-2519965637"><img alt="" src="/icons/hic.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2012-03-06-chart-libraries-headaches-finding-the-best-grid-step","year":"2012","month":"03","day":"06","slug":"chart-libraries-headaches-finding-the-best-grid-step","content":"\u003ch1 id=\"\"\u003e\u003c/h1\u003e\n\u003cimg src=\"/images/2012/02/wrong-chart-scale.png\" class=\"thumbnail-left\" /\u003e\n\n\u003cp\u003eIf you have ever made a chart library in your life, you’ve probably asked yourself how to find the best scale for the grid in order to have \u003cstrong\u003enice values to display in the axis\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eMost of the time, \u003cstrong\u003edata ranges are unknown\u003c/strong\u003e, hence we need to \u003cstrong\u003eadapt the grid step\u003c/strong\u003e to provide the best display.\u003c/p\u003e\n\u003ch2 id=\"check-this-out\"\u003eCheck this out\u003c/h2\u003e\n\u003ciframe src=\"/demo/grid-utils/\" frameborder=\"0\" width=\"525\" height=\"140\"\u003e\u003c/iframe\u003e\n\n\u003cp\u003eLet’s explain the algorithm…\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003ch2 id=\"about-scientific-notation\"\u003eAbout scientific notation\u003c/h2\u003e\n\u003cp\u003eAny number can be formatted in scientific notation. It is written in the form of \u003cstrong\u003eA x 10N\u003c/strong\u003e and is noted \u003cstrong\u003eAeN\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eFor instance, 2300 becomes \u003cstrong\u003e2.3e3\u003c/strong\u003e (because 2300 = 2.3 x 103), 12 becomes \u003cstrong\u003e1.2e1\u003c/strong\u003e, and 0.23 becomes \u003cstrong\u003e2.3e-1\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eScientific notation is exactly made for \u003cstrong\u003edisplaying huge or tiny values in a few characters\u003c/strong\u003e.\u003cbr\u003eWe can use the same principle for finding good values for the step scale, we can just \u003cstrong\u003ekeep the pow of 10\u003c/strong\u003e part (\u003cstrong\u003eN\u003c/strong\u003e) and \u003cstrong\u003eround the value part\u003c/strong\u003e (\u003cstrong\u003eA\u003c/strong\u003e).\u003c/p\u003e\n\u003ch2 id=\"magic-numbers\"\u003eMagic numbers\u003c/h2\u003e\n\u003cp\u003eBut \u003cstrong\u003erounding is not enough\u003c/strong\u003e, I have found that good pattern numbers of step range is those divisible by 2, 5 and 10.\u003c/p\u003e\n\u003cp\u003eIn math term, we need to find a step range \u003cem\u003esr\u003c/em\u003e, where\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e∀ n ∈ |N, ∀ a ∈ {1, 2, 5}, ∃ sr, sr = a x 10^n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is basically because 2 x 5 = 10 : using a step of 5 we have a 10 modularity every 2 step, and, using a step of 2 we have a 10 modularity every 5 step.\u003c/p\u003e\n\u003cp\u003e** 2 step:** 0 2 4 6 8 \u003cstrong\u003e10\u003c/strong\u003e 12 14 16 18 \u003cstrong\u003e20\u003c/strong\u003e …\u003cbr\u003e** 5 step:** 0 5 \u003cstrong\u003e10\u003c/strong\u003e 15 \u003cstrong\u003e20\u003c/strong\u003e 25 \u003cstrong\u003e30\u003c/strong\u003e 35 \u003cstrong\u003e40\u003c/strong\u003e 45 …\u003cbr\u003e\u003cstrong\u003e10 step:\u003c/strong\u003e \u003cstrong\u003e0 10 20 30 40 50 60 70 80 90\u003c/strong\u003e …\u003c/p\u003e\n\u003cp\u003eFor any dataset, we need to fallback on the closest step range in all of possible step ranges: … 0.002, 0.02, 0.2, 2, 20, 200, …, … 0.005, 0.05, 0.5, 5, 50, 500, …, and … 0.001, 0.01, 0.1, 1, 10, 100, …,\u003c/p\u003e\n\u003ch3 id=\"calculate-the-pow-of-10\"\u003eCalculate the pow of 10\u003c/h3\u003e\n\u003cp\u003eTo get the \u003cstrong\u003eN\u003c/strong\u003e value of the \u003cstrong\u003eA x 10N\u003c/strong\u003e form, we can use the log of 10:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eN = Math.log(number) / Math.log(10);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"calculate-the-value-modulo-10\"\u003eCalculate the value modulo 10\u003c/h3\u003e\n\u003cp\u003eTo get the \u003cstrong\u003eA\u003c/strong\u003e value of the \u003cstrong\u003eA x 10N\u003c/strong\u003e form, we can just divide the number by \u003cstrong\u003e10N\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eA = number / Math.pow(10, N);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"rounding-the-number\"\u003e‘Rounding’ the number\u003c/h3\u003e\n\u003cp\u003eWe know just need to change the value of \u003cstrong\u003eA\u003c/strong\u003e and make it more “readable”.\u003cbr\u003eWe can map the value as follow:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif A ∈ [0, 1.5[ then A becomes 1\nif A ∈ [1.5, 3.5[ then A becomes 2\nif A ∈ [3.5, 7.5[ then A becomes 5\nif A ∈ [7.5, 10[ then A becomes 10\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote that these rules may probably be improved, I would love if someone could improve this (because I use a arithmetic mean approach and it should probably be arithmetic).\u003c/p\u003e\n\u003ch2 id=\"implementation\"\u003eImplementation\u003c/h2\u003e\n\u003ch3 id=\"scala\"\u003eScala\u003c/h3\u003e\n\u003cscript src=\"https://gist.github.com/1987311.js?file=GridUtils.scala\"\u003e\u003c/script\u003e\n\n\u003ch3 id=\"javascript\"\u003eJavascript\u003c/h3\u003e\n\u003cscript src=\"https://gist.github.com/1987311.js?file=GridUtils.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003e\u003cstrong\u003eUsage example:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eGridUtils.findNiceRoundStep(xMax, 10);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhere \u003cem\u003exMax\u003c/em\u003e is the scale of the axis, and \u003cem\u003e10\u003c/em\u003e is the desired number of graduation split.\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eFinding the best grid step is finally a simple thing to implement but is an essential feature every chart libraries should have.\u003c/p\u003e\n","data":{"title":"Chart libraries headaches – finding the best grid step","description":"If you have ever made a chart library in your life, you’ve probably asked yourself how to find the best scale for the grid in order to have nice values to display in the axis.","thumbnail":"/images/2012/02/wrong-chart-scale.png","author":"Gaetan","layout":"post","permalink":"/2012/03/chart-libraries-headaches-finding-the-best-grid-step/","tags":["javascript","math"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2012","month":"03","slug":"chart-libraries-headaches-finding-the-best-grid-step"},"buildId":"S3Z5qT3u2kAg4fq91nZqQ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>