<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="I learned to use Backbone.js and Three.js (a famous library on top of WebGL) to make a FPS in only one week."/><meta name="keywords" content="gamedev, GLSL, WebGL"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="How I learned Backbone.js, Three.js, GLSL in one week"/><meta name="og:title" content="How I learned Backbone.js, Three.js, GLSL in one week"/><meta name="twitter:description" content="I learned to use Backbone.js and Three.js (a famous library on top of WebGL) to make a FPS in only one week."/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2012/07/dta1.png"/><meta name="twitter:image" content="http://greweb.me//images/2012/07/dta1.png"/><link rel="image_src" href="http://greweb.me//images/2012/07/dta1.png"/><title>@greweb - How I learned Backbone.js, Three.js, GLSL in one week</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-682ed58dee9e3e5c50ef.js" defer=""></script><script src="/_next/static/chunks/framework-c93ed74a065331c4bd75.js" defer=""></script><script src="/_next/static/chunks/main-005750ed97c879f2d59b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-092526a60f8cb7d1b3d6.js" defer=""></script><script src="/_next/static/chunks/988-83f401159b53b3fa4628.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-0f67605ef98ac8184736.js" defer=""></script><script src="/_next/static/HOUnMOTnD5RIDb4iqestS/_buildManifest.js" defer=""></script><script src="/_next/static/HOUnMOTnD5RIDb4iqestS/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">How I learned Backbone.js, Three.js, GLSL in one week</a></h1><time class="date" dateTime="2012-07-03">2012-07-03</time><span class="tags"><a class="tag">gamedev</a><a class="tag">GLSL</a><a class="tag">WebGL</a></span></header><div class="entry-content"><p><img src="/images/2012/07/dta1.png" alt=""></p>
<p>Last week was the <a href="http://7dfps.org/">7dfps challenge</a>, an open challenge where participants had to make a FPS in only one week.
Such contest are very very interesting for those who want to experiment with things. Challenging yourself is IMO the best way to learn new things. You may also know the famous <a href="http://www.ludumdare.com/">“Ludum Dare” contest</a>.</p>
<p>I learned to use Backbone.js and Three.js (a famous library on top of WebGL) in only one week, so you have no excuse to not be able to do the same!</p>
<p><a href="http://youcanmakevideogames.com/">-&gt; You can make games!</a></p>
<blockquote>
<p>“If Lawnmower Man f****d Tron on the bonnet of a tank”<br><strong><em>YouBigNugget</em></strong></p>
</blockquote>
<p>I’ve only used web technologies, no need of any plugin, just a recent browser like Chrome / Firefox.</p>
<p>This is the result:</p>
<iframe width="640" height="360" src="http://www.youtube.com/embed/g9CldBI9C6E?feature=player_embedded" frameborder="0" allowfullscreen></iframe>

<p>and you can play it here:</p>
<p><strong><a href="http://gre.github.io/dta">Play the game</a></strong></p>
<!--more-->

<h2 id="overview-of-a-one-week-game-development">Overview of a one week game development</h2>
<h3 id="backbonejs-for-the-model-events-and-class-inherence">Backbone.js, for the model, events and class inherence</h3>
<p>I’m a fan of the “do it yourself” idea, not using any library or only using small 140byt.es codes. But the frequent issue with that is (1) always doing the same thing again and again, (2) taking a lot of time on the architecture, and not finishing anything. When you have a due date, relying on libraries and frameworks could save you a lot of time.<br>I’ve choose Backbone.js for its Model architecture with class inherence, a get/set system, and also its event system bound to model instances, the destroy function with the “destroy” event to bind on,… It was also a new library to learn for me.</p>
<h4 id="models">Models</h4>
<p>Here is the class diagram of the game:</p>
<p><img src="/images/2012/07/f5dea341.jpg" alt="not available"></p>
<h3 id="learning-threejs-a-3d-library-on-top-of-webgl">Learning Three.js, a 3D library on top of WebGL.</h3>
<p>WebGL is <a href="http://caniuse.com/#search=webgl">more and more supported by browsers</a>.<br>WebGL means OpenGL in the web. It allows to make efficient and hardware accelerated 3D computation.</p>
<p>Here is the same, not using any library but using pure WebGL wasn’t possible in one week! This is why I’ve chosen to use Three.js, probably today the most popular WebGL library.<br>I was impressed how Three.js is finally not so hard to use, knowing some basic 3D concepts from my old Blender days.</p>
<p>You create a <code>Scene</code>, add a <code>Camera</code>, add Meshes to the scene, A <code>Mesh</code> has a <code>Material</code> and a <code>Geometry</code>, … everything very straighforward.</p>
<p>One challenging part was when trying to compute global world position relative to a given object position, for instance to compute the Bullet initial position and orientation from the Tank position and orientation.</p>
<p>Fortunately I’ve got some help <img src="http://gre.github.io/dta" alt=":)"> and got the answer: multiply your vector with the worldMatrix of the mesh.</p>
<blockquote class="twitter-tweet" data-in-reply-to="212609230891524096" width="550" lang="fr"><p>@<a href="https://twitter.com/greweb">greweb</a> Should be calculatable quite easily. Multiply the position vector by the object’s matrixWorld property.</p>
<p>&mdash; Paul Lewis (@aerotwist) <a href="https://twitter.com/aerotwist/status/212617930024816641" data-datetime="2012-06-12T18:50:39+00:00">Juin 12, 2012</a></p></blockquote>

<blockquote class="twitter-tweet" data-in-reply-to="212609230891524096" width="550" lang="fr"><p>@<a href="https://twitter.com/greweb">greweb</a> var position = new THREE.Vector3().getPositionFromMatrix( object.matrixWorld );</p>
<p>&mdash; Mr.doob (@mrdoob) <a href="https://twitter.com/mrdoob/status/212648943673290752" data-datetime="2012-06-12T20:53:53+00:00">Juin 12, 2012</a></p></blockquote>

<h3 id="playing-with-ai">Playing with AI</h3>
<p>Like TankKeyboardControls, I’ve created a new “TankControls” for computer tanks: <strong>TankRandomControls</strong> was the first dumb one, it just does random things:</p>
<pre><code class="language-javascript">function TankRandomControls () {
var self = this;
self.moveForward = false;
self.moveBackward = false;
self.moveLeft = false;
self.moveRight = false;
self.fire = false;
self.fireMissile = false;
var i = ;
setInterval (function () { // take random decisions every 0.5 second
  i;
self.moveForward = i%3== &amp;&amp; Math.random() &gt; 0.2;
self.moveBackward = !self.moveForward &amp;&amp; Math.random() &gt; 0.5;
self.moveLeft = Math.random() &lt; 0.1;
self.moveRight = Math.random() &lt; 0.1;
self.fire = Math.random() &gt; 0.2;
self.fireMissile = Math.random() &lt; 0.2;
}, 500);
}
</code></pre>
<p><strong>TankRemoteControls</strong> was the second one using some simple AI rules:</p>
<ul>
<li>Try to avoid walls and objects</li>
<li>Either do random things or target a tank (more likely)</li>
<li>Target the closest tank, update target every 5 seconds</li>
<li>Turn the tank to the target tank, shoot bullets and missiles</li>
<li>Move forward if the target is far away / Move backward if the target is too close</li>
</ul>
<p>See the source code here: .</p>
<h3 id="sounds">Sounds</h3>
<p>I’ve used <a href="http://www.egonelbre.com/js/jsfx/">JSFX</a>, an experimental library, were you can generate sounds based on a few parameters.<br>It’s a 8-bit sound generator perfect for generate old-school sounds.</p>
<p>So you can create each sound in Javascript like this:</p>
<pre><code class="language-javascript">SOUNDS = {
  bullet: jsfxlib.createWave([
    &quot;noise&quot;,
    7.0,
    0.18,
    0.0,
    0.082,
    0.0,
    0.222,
    20.0,
    800,
    2400.0,
    -0.428,
    0.0,
    0.0,
    0.01,
    0.0003,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.992,
    0.0,
    0.0,
    0.22,
    0.0,
  ]),
  missile: jsfxlib.createWave([
    &quot;noise&quot;,
    0.0,
    0.12,
    0.0,
    0.546,
    0.0,
    0.856,
    64.0,
    250,
    1063.0,
    0.28,
    0.086,
    0.024,
    5.4329,
    0.3565,
    0.466,
    -0.638,
    0.058,
    0.008,
    0.0,
    0.0,
    -0.114,
    0.216,
    0.98,
    -0.984,
    1.0,
    0.307,
    0.988,
  ]),
  explosion: jsfxlib.createWave([
    &quot;noise&quot;,
    1.0,
    0.4,
    0.02,
    0.682,
    1.746,
    1.97,
    100.0,
    378.0,
    2242.0,
    -0.55,
    -0.372,
    0.024,
    0.4899,
    -0.1622,
    0.262,
    0.34,
    0.724,
    0.0205,
    -0.102,
    0.0416,
    -0.098,
    0.1,
    0.805,
    0.094,
    0.428,
    0.0,
    -0.262,
  ]),
  collideWall: jsfxlib.createWave([
    &quot;noise&quot;,
    0.0,
    0.4,
    0.0,
    0.056,
    0.0,
    0.296,
    20.0,
    560.0,
    2400.0,
    -0.482,
    0.0,
    0.0,
    0.01,
    0.0003,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    1.0,
    0.0,
    0.0,
    0.0,
    0.0,
  ]),
};
// ...
// SOUNDS.bullet.play()
</code></pre>
<p>The jsfxlib.createWave function returns a HTML5 Audio element and you can play with its API (.play(), .pause(), …).<br>But doing this way, you will not be able to play a sound at the same time so I’ve made a buffer system which duplicate N times the sound in different audio elements.<br>I have also try to generate different sounds to randomize it a little.</p>
<p>See the full source code here: .</p>
<h3 id="post-processing-effects-with-glsl-shaders">Post Processing Effects with GLSL shaders</h3>
<p>I was very impressed by the power of GLSL for its possibilities and efficiency.<br>GLSL are definitely the indispensable thing you need to add a better atmosphere in your games.</p>
<h4 id="before">Before</h4>
<p><img src="/images/2012/06/before.png" alt=""></p>
<h4 id="after">After</h4>
<p><img src="/images/2012/06/after_.png" alt=""></p>
<p>and when getting shot:</p>
<p><img src="/images/2012/06/after.png" alt=""></p>
<p>These effects are done by combining these two GLSL effects.<br>Here is the GLSL code of these effects.</p>
<h4 id="the-radio-noise-effect">The radio noise effect</h4>
<script src="https://gist.github.com/2950478.js?file=radionoise.frag"></script>

<h4 id="the-shot-interference">The shot interference</h4>
<script src="https://gist.github.com/2950478.js?file=perturbation.frag"></script>

<h3 id="wait-what-is-this-crazy-glsl-language">Wait! what is this crazy “GLSL” language?</h3>
<p>GLSL is an OpenGL language close to the C syntax design to have a direct control of the graphic pipeline. You can directly add passes to the rendering process with GLSL shaders.<br>GLSL gives you a lot of very useful types (like vectors, matrix, …) and functions (like smoothstep, …). <a href="http://www.opengl.org/documentation/glsl/">Read the spec</a> to know more about it.<br>I also recommend you to experiment the <a href="http://glsl.heroku.com/">GLSL Sandbox</a>. You can see awesome demos and their codes shared by people made with GLSL. It also have an online IDE to easily code and instantly test your shaders.</p>
<h3 id="webgl-and-threejs-integration">WebGL and Three.js integration</h3>
<p>You can use GLSL in different ways with Three.js. You can add a GLSL shader to an object material, and you can also add GLSL shaders on top of the Canvas (post-processing). We will only see how to add GLSL shaders as a post processing render on the entire Canvas.</p>
<p>Fortunately Three.js have some utils classes to make the GLSL shaders integration easier.</p>
<p>I have been inspired from the awesome work done here: .</p>
<p>There is a lot of code out there, so I’ve try to extract the minimum required for mixing the 2 GLSL shaders for a post-processing on the entire canvas of a Three.js scene:</p>
<iframe style="width: 100%; height: 400px;" src="http://jsfiddle.net/jggvJ/7/embedded/" frameborder="0" width="320" height="240"></iframe>

<p>As you can see, you can easily inject your own Javascript variables in a GLSL shader to make a bridge between the JS and the GLSL code and so having quite generic and configurable shaders.<br>Quite cool!</p>
<h3 id="adding-game-ui">Adding game UI</h3>
<p>Web, with HTML and CSS, allows to have different containers, layers, positioning systems,…<br>Perfect! For the game UI, we used different elements:</p>
<p><img src="/images/2012/06/ui.png" alt=""></p>
<p>Radar and Damage are implemented with an independent Canvas while Level is a simple text div.</p>
<p>For instance, this is Damage (I called LifeIndicator):</p>
<pre><code class="language-javascript">(function(){

var LifeIndicator = function (nodeId) {
this.canvas = document.getElementById(nodeId);
this.ctx = this.canvas.getContext(&quot;2d&quot;);
this.life = 1;
this.render();
}

LifeIndicator.prototype.setLife = function (life) {
this.life = life;
this.render();
}

LifeIndicator.prototype.render = function () {
var c = this.ctx;
var w = c.canvas.width, h = c.canvas.height;
c.clearRect(, , w, h);
// TODO
var g = Math.floor(255*this.life);
var r = 255-g;
c.fillStyle = &quot;rgb(&quot; r &quot;,&quot; g &quot;,0)&quot;;
var wt = 6;
var ht = 12;
c.fillRect((w-wt)/2, , wt, ht);
c.fillRect(, ht, w, h);
}

window.LifeIndicator = LifeIndicator;

}());
</code></pre>
<h2 id="play-framework-integration">Play Framework integration</h2>
<p>I was planning to make a multiplayer game but I couldn’t find the time for this.<br>I use Play Framework 2 and its power and concepts for handling streams (even if I don’t use it yet).<br>The only part I can show you for now is the game map generation. For making a multiplayer game, I needed to have the game state on server side to be able to submit game infos (map, players, …) to new players.</p>
<p>This is a few scala code to generate a nice distribution of random objects in the map:</p>
<pre><code class="language-scala">object Game {
  def createRandom: Game = {
    val random = new Random()
    val half = 5000
    val size = 2*half
    val split = 4
    val objects =
    Range(, split).map { xi =&gt;
      Range(, split).map { yi =&gt;
        val s = size.toDouble / split.toDouble
        val x = -half.toDouble math.round(s*(xi random.nextDouble));
        val y = -half.toDouble math.round(s*(yi random.nextDouble));
        var sizeRandom = random.nextDouble
        val w = 200.*math.ceil((1-sizeRandom)*8.);
        val h = 200.*math.ceil(sizeRandom*8.);
        RectObj(Vec3(x,y,), w, h)
      }.toList
    }.toList.flatten
    Game( (Vec3(-half, -half, ), Vec3(half, half, )), List(), objects, List() )
  }
}

case class Game (bounds: Tuple2[Vec3, Vec3], chars: List[Char], objects: List[GameObj], dynamics: List[GameDyn])
...
</code></pre>
<p><a href="https://github.com/gre/dta/blob/master/app/models/models.scala">See the full source</a> (some code may not be used).</p>
<h2 id="still-an-unfinished-game">Still an unfinished game</h2>
<p>There is more things to do now:</p>
<ul>
<li>More visual effects</li>
<li>More sound effects</li>
<li>A better collision system (using a physic engine?)</li>
<li>Multiplayer</li>
<li>A better gameplay with some goals, different kind of games, …</li>
</ul>
<h3 id="initial-multiplayer-objective-rescheduled">Initial multiplayer objective rescheduled</h3>
<p>My initial game release was focus on the game core, graphisms and gameplay.</p>
<p>I was unfortunately not ready enough to make the multi-player real-time part for the first week sprint but I have some though on the subject.<br>I was asking myself what are the best way to make the game synchronisation between clients while trying to keep as much client-side code as possible. I wanted a scalable decentralized game. I had some though on how to solve this issue. For instance, when a client shoots, he sends a “shoot” event with the timestamp, server just streams events (with a tick frequency) sent by clients and clients replay the game exactly the same way everywhere (using all these time-based events) with some interpolation with the current time.<br>I need to think more about this now, and try to use <a href="http://playframework.org/">PlayFramework</a>.</p>
<h2 id="source-code">Source code</h2>
<p><a href="http://github.com/gre/dta">http://github.com/gre/dta</a></p>
<p>**[EDIT] You may be mainly interested by the <a href="https://github.com/gre/dta/blob/master/app/assets/javascripts/main.js">main.js</a>. It shows how powerful the even-driven programming is, for plugging components together.<br>**</p>
<h2 id="special-thanks">Special thanks</h2>
<p><a href="http://twitter.com/mrspeaker">@mrspeaker</a> for helping me with Three.js &amp; also collision system,<br><a href="http://twitter.com/mrdoob">@mrdoob</a> &amp; <a href="http://twitter.com/aerotwist">@aerotwist</a> for replying to my newbies questions,<br>guys on IRC (#three.js),<br>and of-course 7dfps guys.</p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/profile.jpg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">creative coder experimenting with GLSL shaders, Rust, and fountain pens robot plots. infinite noise explorer.</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a><a href="https://hic.link/greweb" class="jsx-2519965637"><img alt="" src="/icons/hic.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2012-07-03-how-i-learned-backbone-js-three-js-glsl-in-one-week","year":"2012","month":"07","day":"03","slug":"how-i-learned-backbone-js-three-js-glsl-in-one-week","content":"\u003cp\u003e\u003cimg src=\"/images/2012/07/dta1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eLast week was the \u003ca href=\"http://7dfps.org/\"\u003e7dfps challenge\u003c/a\u003e, an open challenge where participants had to make a FPS in only one week.\nSuch contest are very very interesting for those who want to experiment with things. Challenging yourself is IMO the best way to learn new things. You may also know the famous \u003ca href=\"http://www.ludumdare.com/\"\u003e“Ludum Dare” contest\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eI learned to use Backbone.js and Three.js (a famous library on top of WebGL) in only one week, so you have no excuse to not be able to do the same!\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://youcanmakevideogames.com/\"\u003e-\u0026gt; You can make games!\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“If Lawnmower Man f****d Tron on the bonnet of a tank”\u003cbr\u003e\u003cstrong\u003e\u003cem\u003eYouBigNugget\u003c/em\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI’ve only used web technologies, no need of any plugin, just a recent browser like Chrome / Firefox.\u003c/p\u003e\n\u003cp\u003eThis is the result:\u003c/p\u003e\n\u003ciframe width=\"640\" height=\"360\" src=\"http://www.youtube.com/embed/g9CldBI9C6E?feature=player_embedded\" frameborder=\"0\" allowfullscreen\u003e\u003c/iframe\u003e\n\n\u003cp\u003eand you can play it here:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"http://gre.github.io/dta\"\u003ePlay the game\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003ch2 id=\"overview-of-a-one-week-game-development\"\u003eOverview of a one week game development\u003c/h2\u003e\n\u003ch3 id=\"backbonejs-for-the-model-events-and-class-inherence\"\u003eBackbone.js, for the model, events and class inherence\u003c/h3\u003e\n\u003cp\u003eI’m a fan of the “do it yourself” idea, not using any library or only using small 140byt.es codes. But the frequent issue with that is (1) always doing the same thing again and again, (2) taking a lot of time on the architecture, and not finishing anything. When you have a due date, relying on libraries and frameworks could save you a lot of time.\u003cbr\u003eI’ve choose Backbone.js for its Model architecture with class inherence, a get/set system, and also its event system bound to model instances, the destroy function with the “destroy” event to bind on,… It was also a new library to learn for me.\u003c/p\u003e\n\u003ch4 id=\"models\"\u003eModels\u003c/h4\u003e\n\u003cp\u003eHere is the class diagram of the game:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2012/07/f5dea341.jpg\" alt=\"not available\"\u003e\u003c/p\u003e\n\u003ch3 id=\"learning-threejs-a-3d-library-on-top-of-webgl\"\u003eLearning Three.js, a 3D library on top of WebGL.\u003c/h3\u003e\n\u003cp\u003eWebGL is \u003ca href=\"http://caniuse.com/#search=webgl\"\u003emore and more supported by browsers\u003c/a\u003e.\u003cbr\u003eWebGL means OpenGL in the web. It allows to make efficient and hardware accelerated 3D computation.\u003c/p\u003e\n\u003cp\u003eHere is the same, not using any library but using pure WebGL wasn’t possible in one week! This is why I’ve chosen to use Three.js, probably today the most popular WebGL library.\u003cbr\u003eI was impressed how Three.js is finally not so hard to use, knowing some basic 3D concepts from my old Blender days.\u003c/p\u003e\n\u003cp\u003eYou create a \u003ccode\u003eScene\u003c/code\u003e, add a \u003ccode\u003eCamera\u003c/code\u003e, add Meshes to the scene, A \u003ccode\u003eMesh\u003c/code\u003e has a \u003ccode\u003eMaterial\u003c/code\u003e and a \u003ccode\u003eGeometry\u003c/code\u003e, … everything very straighforward.\u003c/p\u003e\n\u003cp\u003eOne challenging part was when trying to compute global world position relative to a given object position, for instance to compute the Bullet initial position and orientation from the Tank position and orientation.\u003c/p\u003e\n\u003cp\u003eFortunately I’ve got some help \u003cimg src=\"http://gre.github.io/dta\" alt=\":)\"\u003e and got the answer: multiply your vector with the worldMatrix of the mesh.\u003c/p\u003e\n\u003cblockquote class=\"twitter-tweet\" data-in-reply-to=\"212609230891524096\" width=\"550\" lang=\"fr\"\u003e\u003cp\u003e@\u003ca href=\"https://twitter.com/greweb\"\u003egreweb\u003c/a\u003e Should be calculatable quite easily. Multiply the position vector by the object’s matrixWorld property.\u003c/p\u003e\n\u003cp\u003e\u0026mdash; Paul Lewis (@aerotwist) \u003ca href=\"https://twitter.com/aerotwist/status/212617930024816641\" data-datetime=\"2012-06-12T18:50:39+00:00\"\u003eJuin 12, 2012\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\" data-in-reply-to=\"212609230891524096\" width=\"550\" lang=\"fr\"\u003e\u003cp\u003e@\u003ca href=\"https://twitter.com/greweb\"\u003egreweb\u003c/a\u003e var position = new THREE.Vector3().getPositionFromMatrix( object.matrixWorld );\u003c/p\u003e\n\u003cp\u003e\u0026mdash; Mr.doob (@mrdoob) \u003ca href=\"https://twitter.com/mrdoob/status/212648943673290752\" data-datetime=\"2012-06-12T20:53:53+00:00\"\u003eJuin 12, 2012\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\n\u003ch3 id=\"playing-with-ai\"\u003ePlaying with AI\u003c/h3\u003e\n\u003cp\u003eLike TankKeyboardControls, I’ve created a new “TankControls” for computer tanks: \u003cstrong\u003eTankRandomControls\u003c/strong\u003e was the first dumb one, it just does random things:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003efunction TankRandomControls () {\nvar self = this;\nself.moveForward = false;\nself.moveBackward = false;\nself.moveLeft = false;\nself.moveRight = false;\nself.fire = false;\nself.fireMissile = false;\nvar i = ;\nsetInterval (function () { // take random decisions every 0.5 second\n  i;\nself.moveForward = i%3== \u0026amp;\u0026amp; Math.random() \u0026gt; 0.2;\nself.moveBackward = !self.moveForward \u0026amp;\u0026amp; Math.random() \u0026gt; 0.5;\nself.moveLeft = Math.random() \u0026lt; 0.1;\nself.moveRight = Math.random() \u0026lt; 0.1;\nself.fire = Math.random() \u0026gt; 0.2;\nself.fireMissile = Math.random() \u0026lt; 0.2;\n}, 500);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eTankRemoteControls\u003c/strong\u003e was the second one using some simple AI rules:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTry to avoid walls and objects\u003c/li\u003e\n\u003cli\u003eEither do random things or target a tank (more likely)\u003c/li\u003e\n\u003cli\u003eTarget the closest tank, update target every 5 seconds\u003c/li\u003e\n\u003cli\u003eTurn the tank to the target tank, shoot bullets and missiles\u003c/li\u003e\n\u003cli\u003eMove forward if the target is far away / Move backward if the target is too close\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSee the source code here: .\u003c/p\u003e\n\u003ch3 id=\"sounds\"\u003eSounds\u003c/h3\u003e\n\u003cp\u003eI’ve used \u003ca href=\"http://www.egonelbre.com/js/jsfx/\"\u003eJSFX\u003c/a\u003e, an experimental library, were you can generate sounds based on a few parameters.\u003cbr\u003eIt’s a 8-bit sound generator perfect for generate old-school sounds.\u003c/p\u003e\n\u003cp\u003eSo you can create each sound in Javascript like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eSOUNDS = {\n  bullet: jsfxlib.createWave([\n    \u0026quot;noise\u0026quot;,\n    7.0,\n    0.18,\n    0.0,\n    0.082,\n    0.0,\n    0.222,\n    20.0,\n    800,\n    2400.0,\n    -0.428,\n    0.0,\n    0.0,\n    0.01,\n    0.0003,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.992,\n    0.0,\n    0.0,\n    0.22,\n    0.0,\n  ]),\n  missile: jsfxlib.createWave([\n    \u0026quot;noise\u0026quot;,\n    0.0,\n    0.12,\n    0.0,\n    0.546,\n    0.0,\n    0.856,\n    64.0,\n    250,\n    1063.0,\n    0.28,\n    0.086,\n    0.024,\n    5.4329,\n    0.3565,\n    0.466,\n    -0.638,\n    0.058,\n    0.008,\n    0.0,\n    0.0,\n    -0.114,\n    0.216,\n    0.98,\n    -0.984,\n    1.0,\n    0.307,\n    0.988,\n  ]),\n  explosion: jsfxlib.createWave([\n    \u0026quot;noise\u0026quot;,\n    1.0,\n    0.4,\n    0.02,\n    0.682,\n    1.746,\n    1.97,\n    100.0,\n    378.0,\n    2242.0,\n    -0.55,\n    -0.372,\n    0.024,\n    0.4899,\n    -0.1622,\n    0.262,\n    0.34,\n    0.724,\n    0.0205,\n    -0.102,\n    0.0416,\n    -0.098,\n    0.1,\n    0.805,\n    0.094,\n    0.428,\n    0.0,\n    -0.262,\n  ]),\n  collideWall: jsfxlib.createWave([\n    \u0026quot;noise\u0026quot;,\n    0.0,\n    0.4,\n    0.0,\n    0.056,\n    0.0,\n    0.296,\n    20.0,\n    560.0,\n    2400.0,\n    -0.482,\n    0.0,\n    0.0,\n    0.01,\n    0.0003,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    1.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n  ]),\n};\n// ...\n// SOUNDS.bullet.play()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe jsfxlib.createWave function returns a HTML5 Audio element and you can play with its API (.play(), .pause(), …).\u003cbr\u003eBut doing this way, you will not be able to play a sound at the same time so I’ve made a buffer system which duplicate N times the sound in different audio elements.\u003cbr\u003eI have also try to generate different sounds to randomize it a little.\u003c/p\u003e\n\u003cp\u003eSee the full source code here: .\u003c/p\u003e\n\u003ch3 id=\"post-processing-effects-with-glsl-shaders\"\u003ePost Processing Effects with GLSL shaders\u003c/h3\u003e\n\u003cp\u003eI was very impressed by the power of GLSL for its possibilities and efficiency.\u003cbr\u003eGLSL are definitely the indispensable thing you need to add a better atmosphere in your games.\u003c/p\u003e\n\u003ch4 id=\"before\"\u003eBefore\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"/images/2012/06/before.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch4 id=\"after\"\u003eAfter\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"/images/2012/06/after_.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eand when getting shot:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2012/06/after.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThese effects are done by combining these two GLSL effects.\u003cbr\u003eHere is the GLSL code of these effects.\u003c/p\u003e\n\u003ch4 id=\"the-radio-noise-effect\"\u003eThe radio noise effect\u003c/h4\u003e\n\u003cscript src=\"https://gist.github.com/2950478.js?file=radionoise.frag\"\u003e\u003c/script\u003e\n\n\u003ch4 id=\"the-shot-interference\"\u003eThe shot interference\u003c/h4\u003e\n\u003cscript src=\"https://gist.github.com/2950478.js?file=perturbation.frag\"\u003e\u003c/script\u003e\n\n\u003ch3 id=\"wait-what-is-this-crazy-glsl-language\"\u003eWait! what is this crazy “GLSL” language?\u003c/h3\u003e\n\u003cp\u003eGLSL is an OpenGL language close to the C syntax design to have a direct control of the graphic pipeline. You can directly add passes to the rendering process with GLSL shaders.\u003cbr\u003eGLSL gives you a lot of very useful types (like vectors, matrix, …) and functions (like smoothstep, …). \u003ca href=\"http://www.opengl.org/documentation/glsl/\"\u003eRead the spec\u003c/a\u003e to know more about it.\u003cbr\u003eI also recommend you to experiment the \u003ca href=\"http://glsl.heroku.com/\"\u003eGLSL Sandbox\u003c/a\u003e. You can see awesome demos and their codes shared by people made with GLSL. It also have an online IDE to easily code and instantly test your shaders.\u003c/p\u003e\n\u003ch3 id=\"webgl-and-threejs-integration\"\u003eWebGL and Three.js integration\u003c/h3\u003e\n\u003cp\u003eYou can use GLSL in different ways with Three.js. You can add a GLSL shader to an object material, and you can also add GLSL shaders on top of the Canvas (post-processing). We will only see how to add GLSL shaders as a post processing render on the entire Canvas.\u003c/p\u003e\n\u003cp\u003eFortunately Three.js have some utils classes to make the GLSL shaders integration easier.\u003c/p\u003e\n\u003cp\u003eI have been inspired from the awesome work done here: .\u003c/p\u003e\n\u003cp\u003eThere is a lot of code out there, so I’ve try to extract the minimum required for mixing the 2 GLSL shaders for a post-processing on the entire canvas of a Three.js scene:\u003c/p\u003e\n\u003ciframe style=\"width: 100%; height: 400px;\" src=\"http://jsfiddle.net/jggvJ/7/embedded/\" frameborder=\"0\" width=\"320\" height=\"240\"\u003e\u003c/iframe\u003e\n\n\u003cp\u003eAs you can see, you can easily inject your own Javascript variables in a GLSL shader to make a bridge between the JS and the GLSL code and so having quite generic and configurable shaders.\u003cbr\u003eQuite cool!\u003c/p\u003e\n\u003ch3 id=\"adding-game-ui\"\u003eAdding game UI\u003c/h3\u003e\n\u003cp\u003eWeb, with HTML and CSS, allows to have different containers, layers, positioning systems,…\u003cbr\u003ePerfect! For the game UI, we used different elements:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2012/06/ui.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eRadar and Damage are implemented with an independent Canvas while Level is a simple text div.\u003c/p\u003e\n\u003cp\u003eFor instance, this is Damage (I called LifeIndicator):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e(function(){\n\nvar LifeIndicator = function (nodeId) {\nthis.canvas = document.getElementById(nodeId);\nthis.ctx = this.canvas.getContext(\u0026quot;2d\u0026quot;);\nthis.life = 1;\nthis.render();\n}\n\nLifeIndicator.prototype.setLife = function (life) {\nthis.life = life;\nthis.render();\n}\n\nLifeIndicator.prototype.render = function () {\nvar c = this.ctx;\nvar w = c.canvas.width, h = c.canvas.height;\nc.clearRect(, , w, h);\n// TODO\nvar g = Math.floor(255*this.life);\nvar r = 255-g;\nc.fillStyle = \u0026quot;rgb(\u0026quot; r \u0026quot;,\u0026quot; g \u0026quot;,0)\u0026quot;;\nvar wt = 6;\nvar ht = 12;\nc.fillRect((w-wt)/2, , wt, ht);\nc.fillRect(, ht, w, h);\n}\n\nwindow.LifeIndicator = LifeIndicator;\n\n}());\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"play-framework-integration\"\u003ePlay Framework integration\u003c/h2\u003e\n\u003cp\u003eI was planning to make a multiplayer game but I couldn’t find the time for this.\u003cbr\u003eI use Play Framework 2 and its power and concepts for handling streams (even if I don’t use it yet).\u003cbr\u003eThe only part I can show you for now is the game map generation. For making a multiplayer game, I needed to have the game state on server side to be able to submit game infos (map, players, …) to new players.\u003c/p\u003e\n\u003cp\u003eThis is a few scala code to generate a nice distribution of random objects in the map:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-scala\"\u003eobject Game {\n  def createRandom: Game = {\n    val random = new Random()\n    val half = 5000\n    val size = 2*half\n    val split = 4\n    val objects =\n    Range(, split).map { xi =\u0026gt;\n      Range(, split).map { yi =\u0026gt;\n        val s = size.toDouble / split.toDouble\n        val x = -half.toDouble math.round(s*(xi random.nextDouble));\n        val y = -half.toDouble math.round(s*(yi random.nextDouble));\n        var sizeRandom = random.nextDouble\n        val w = 200.*math.ceil((1-sizeRandom)*8.);\n        val h = 200.*math.ceil(sizeRandom*8.);\n        RectObj(Vec3(x,y,), w, h)\n      }.toList\n    }.toList.flatten\n    Game( (Vec3(-half, -half, ), Vec3(half, half, )), List(), objects, List() )\n  }\n}\n\ncase class Game (bounds: Tuple2[Vec3, Vec3], chars: List[Char], objects: List[GameObj], dynamics: List[GameDyn])\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/gre/dta/blob/master/app/models/models.scala\"\u003eSee the full source\u003c/a\u003e (some code may not be used).\u003c/p\u003e\n\u003ch2 id=\"still-an-unfinished-game\"\u003eStill an unfinished game\u003c/h2\u003e\n\u003cp\u003eThere is more things to do now:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMore visual effects\u003c/li\u003e\n\u003cli\u003eMore sound effects\u003c/li\u003e\n\u003cli\u003eA better collision system (using a physic engine?)\u003c/li\u003e\n\u003cli\u003eMultiplayer\u003c/li\u003e\n\u003cli\u003eA better gameplay with some goals, different kind of games, …\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"initial-multiplayer-objective-rescheduled\"\u003eInitial multiplayer objective rescheduled\u003c/h3\u003e\n\u003cp\u003eMy initial game release was focus on the game core, graphisms and gameplay.\u003c/p\u003e\n\u003cp\u003eI was unfortunately not ready enough to make the multi-player real-time part for the first week sprint but I have some though on the subject.\u003cbr\u003eI was asking myself what are the best way to make the game synchronisation between clients while trying to keep as much client-side code as possible. I wanted a scalable decentralized game. I had some though on how to solve this issue. For instance, when a client shoots, he sends a “shoot” event with the timestamp, server just streams events (with a tick frequency) sent by clients and clients replay the game exactly the same way everywhere (using all these time-based events) with some interpolation with the current time.\u003cbr\u003eI need to think more about this now, and try to use \u003ca href=\"http://playframework.org/\"\u003ePlayFramework\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"source-code\"\u003eSource code\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://github.com/gre/dta\"\u003ehttp://github.com/gre/dta\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e**[EDIT] You may be mainly interested by the \u003ca href=\"https://github.com/gre/dta/blob/master/app/assets/javascripts/main.js\"\u003emain.js\u003c/a\u003e. It shows how powerful the even-driven programming is, for plugging components together.\u003cbr\u003e**\u003c/p\u003e\n\u003ch2 id=\"special-thanks\"\u003eSpecial thanks\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://twitter.com/mrspeaker\"\u003e@mrspeaker\u003c/a\u003e for helping me with Three.js \u0026amp; also collision system,\u003cbr\u003e\u003ca href=\"http://twitter.com/mrdoob\"\u003e@mrdoob\u003c/a\u003e \u0026amp; \u003ca href=\"http://twitter.com/aerotwist\"\u003e@aerotwist\u003c/a\u003e for replying to my newbies questions,\u003cbr\u003eguys on IRC (#three.js),\u003cbr\u003eand of-course 7dfps guys.\u003c/p\u003e\n","data":{"title":"How I learned Backbone.js, Three.js, GLSL in one week","author":"Gaetan","description":"I learned to use Backbone.js and Three.js (a famous library on top of WebGL) to make a FPS in only one week.","thumbnail":"/images/2012/07/dta1.png","layout":"post","permalink":"/2012/07/how-i-learned-backbone-js-three-js-glsl-in-one-week/","tags":["gamedev","GLSL","WebGL"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2012","month":"07","slug":"how-i-learned-backbone-js-three-js-glsl-in-one-week"},"buildId":"HOUnMOTnD5RIDb4iqestS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>