<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="In this article, we will focus on the power of CSS as a descriptive language, current template system approach and their problems with modularity and extensibility, and try to mix both features from the concept to a concrete implementation."/><meta name="keywords" content="css, javascript, templating"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="CSS-selector-based templating system for scalable JavaScript applications"/><meta name="og:title" content="CSS-selector-based templating system for scalable JavaScript applications"/><meta name="twitter:description" content="In this article, we will focus on the power of CSS as a descriptive language, current template system approach and their problems with modularity and extensibility, and try to mix both features from the concept to a concrete implementation."/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2012/02/218px-Mir_diagram-fr.svg_.png"/><meta name="twitter:image" content="http://greweb.me//images/2012/02/218px-Mir_diagram-fr.svg_.png"/><link rel="image_src" href="http://greweb.me//images/2012/02/218px-Mir_diagram-fr.svg_.png"/><title>@greweb - CSS-selector-based templating system for scalable JavaScript applications</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-3efa3b6043722353fd27.js" defer=""></script><script src="/_next/static/chunks/framework-c93ed74a065331c4bd75.js" defer=""></script><script src="/_next/static/chunks/main-005750ed97c879f2d59b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-092526a60f8cb7d1b3d6.js" defer=""></script><script src="/_next/static/chunks/988-83f401159b53b3fa4628.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-0f67605ef98ac8184736.js" defer=""></script><script src="/_next/static/-L4W7d2blbDCNXHVWGxGZ/_buildManifest.js" defer=""></script><script src="/_next/static/-L4W7d2blbDCNXHVWGxGZ/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">CSS-selector-based templating system for scalable JavaScript applications</a></h1><time class="date" dateTime="2012-02-04">2012-02-04</time><span class="tags"><a class="tag">css</a><a class="tag">javascript</a><a class="tag">templating</a></span></header><div class="entry-content"><img src="/images/2012/02/218px-Mir_diagram-fr.svg_.png" alt="" class="thumbnail-left" />

<p>In this article, we will focus on the power of <strong>CSS as a descriptive language</strong>, current template system approach and their problems with <strong>modularity</strong> and <strong>extensibility</strong>, and try to mix both features from the <strong>concept</strong> to a <strong>concrete implementation</strong>.</p>
<!--more-->

<br style="clear: both" />

<h2 id="what-is-css-">What is CSS ?</h2>
<p>CSS is an extremely powerful descriptive language.<br>It helps to define <strong>how to display a document</strong> (e.g. a web page).</p>
<p>A style sheet contains a set of <strong>CSS rules</strong>.<br>Each CSS rule has a <strong>CSS selector</strong> associated with a set of <strong>declarations</strong>.<br>You can see a CSS selector as a selection filter applied on every HTML element. A few element can match a CSS selector if they fit the structure describes in this selector.<br>Each <strong>declaration</strong> is composed of a couple (<strong>property</strong> : <strong>value</strong>).<br>The <strong>CSS property</strong> is a predefined property related to a display or layout behavior.<br>The <strong>value</strong> will apply a custom value for the property on all elements matching the CSS selector.</p>
<p>Let’s focus on some advantages of this descriptive language:</p>
<h3 id="a-css-rule-is-independant-from-others">A CSS rule is independant from others.</h3>
<p>The order of CSS rules <em>(selector declarations)</em> <strong>really</strong> does not matter.<br>The priority between CSS rules is based on the selector itself and not on their arrangement.</p>
<h3 id="you-can-mix-css-rule">You can “mix” CSS rule</h3>
<p>2 CSS rules can have the same CSS selector. An element can be matched with multiple CSS rules. CSS rules are merged, it’s called the cascading.<br>This is the most important feature of CSS.<br>It implies a very modular and extensible language.</p>
<h4 id="example">Example</h4>
<pre><code class="language-css">a {   
  color: #33CC00;  
  text-decoration: none;  
}  
a:hover { text-decoration: underline; }  
#articles {  
  font-size: 12px;  
}  
#articles a {  
  color: red; /* overriding the generic color of a */  
}
</code></pre>
<h2 id="some-limitations-of-todays-template-system">Some limitations of today’s template system</h2>
<p>Most of template system are based on inherence between templates.</p>
<ul>
<li>  You have usually an “inclusion” approach: a template will “include” multiple external template. <em>(Many template into Many template)</em></li>
<li>  And an “extension” approach: You define in a main template an area where you can append a template. Others templates “extend” your main template. <em>(One main template for Many template)</em></li>
</ul>
<p>These approaches aims to factorize template codes and that’s great.</p>
<p>But it doesn’t fit my needs:</p>
<ul>
<li>  It brings <strong>dependencies between templates</strong>. </li>
<li>If you add a new template, you have to modify existing templates.<br>  If your application tend to go modules based, this is going to be unmaintainable. </li>
</ul>
<blockquote>
<p><strong>web application module (n)</strong><br>1 : an independent unit of functionality that is part of the total structure of a web application </p>
</blockquote>
<h3 id="a-solution-for-scalable-applications-and-libraries">A solution for scalable applications and libraries</h3>
<p>I’ve recently started to rewrite my <a href="http://sliderjs.org/">SliderJS</a> library and I needed to split it into very modular features and having loose coupling between each component.</p>
<p>I followed this <a href="http://www.ubelly.com/2011/11/scalablejs/">Scalable JavaScript Application Architecture</a> article.</p>
<p>So, <strong>how to bring loose coupling in templating?</strong>.<br>Each module have its own template and know where to append. Bringing this logic in a main template would break the independency and if I need to add new modules soon, it will not working without modifiyng it.<br>How to keep the scalability of the main template without modifying it?</p>
<p>The best solution I found is to combine <strong>CSS selectors</strong> concepts with <strong>template system</strong> approaches.</p>
<h2 id="css-concepts-applied-on-templating">CSS concepts applied on templating</h2>
<p>I’ve decided to inspire from CSS: <strong>attaching a CSS selector with a template</strong>.<br>It benefits from some CSS advantages explained before.</p>
<h3 id="simple-twitter-widget-example">Simple twitter widget example</h3>
<pre><code class="language-html">&lt;div class=&quot;twitter&quot;&gt;
  &lt;h1&gt;Twitter&lt;/h1&gt;
  &lt;ul class=&quot;twitts&quot;&gt;
    &lt;li class=&quot;twitt&quot;&gt;Hello world!&lt;/li&gt;
  &lt;/ul&gt;
  &lt;footer&gt;&lt;a href=&quot;http://twitter.com/greweb&quot;&gt;Follow me on twitter&lt;/a&gt;&lt;/footer&gt;
&lt;/div&gt;
</code></pre>
<h4 id="classical-approach">Classical approach</h4>
<p>The way to template it with the classical approach would be:</p>
<pre><code class="language-html">&lt;div class=&quot;twitter&quot;&gt;
  &lt;h1&gt;Twitter&lt;/h1&gt;
  &lt;ul class=&quot;twitts&quot;&gt;
    {for twitt in twitts}
    &lt;li class=&quot;twitt&quot;&gt;{twitt}&lt;/li&gt;
    {/for}
  &lt;/ul&gt;
  &lt;footer&gt;&lt;a href=&quot;http://twitter.com/{me}&quot;&gt;Follow me on twitter&lt;/a&gt;&lt;/footer&gt;
&lt;/div&gt;
</code></pre>
<h4 id="css-selector-based-approach">CSS selector based approach</h4>
<p>But we can also split the original “template” in small fragments and mix all of them.<br>It helps to define each templates independently.</p>
<p><strong>We can identify:</strong></p>
<ul>
<li>A <strong>root template fragment</strong>:</li>
</ul>
<pre><code class="language-html">&lt;div class=&quot;twitter&quot;&gt;&lt;/div&gt;
</code></pre>
<ul>
<li>A <strong>header fragment</strong> appended with <code>.twitter</code> selector and with an <strong>high priority</strong>:</li>
</ul>
<pre><code class="language-html">&lt;h1&gt;Twitter&lt;/h1&gt;
</code></pre>
<ul>
<li>A <strong>twitts list fragment</strong> appended with <code>.twitter</code> selector:</li>
</ul>
<pre><code class="language-html">&lt;ul class=&quot;twitts&quot;&gt;
  {for twitt in twitts}
  &lt;li class=&quot;twitt&quot;&gt;{twitt}&lt;/li&gt;
  {/for}
&lt;/ul&gt;
</code></pre>
<p>with <strong>parameters</strong> <code>twitts = [ &quot;Hello world!&quot; ]</code></p>
<ul>
<li>An empty <strong>footer fragment</strong> appended with <code>.twitter</code> selector and with a <strong>low</strong> priority:</li>
</ul>
<pre><code class="language-html">&lt;footer&gt;&lt;/footer&gt;
</code></pre>
<ul>
<li>A “follow me” <strong>link fragment</strong> appended with <code>.twitter footer</code> selector:</li>
</ul>
<pre><code class="language-html">&lt;a href=&quot;http://twitter.com/{me}&quot;&gt;Follow me on twitter&lt;/a&gt;
</code></pre>
<p>with <strong>parameters</strong> <code>me = &quot;greweb&quot;</code></p>
<h3 id="advanced-example">Advanced example</h3>
<p>This is another example with a slider. </p>
<p>Let’s conceptually imagine the following template language:</p>
<pre><code class="language-html">@root { html: &lt;div class=&quot;slider&quot;&gt;&lt;/div&gt; }

.slider {
  html: &lt;div class=&quot;slides&quot;&gt;&lt;/div&gt;
}

.slider div.slides {
  html: &lt;canvas class=&quot;slides&quot;&gt;&lt;/canvas&gt;
}

.slider div.slides {
  html:
  &lt;div class=&quot;slide&quot;&gt;
    &lt;a href=&quot;&lt;%= link %&gt;&quot;&gt;
      &lt;img src=&quot;&lt;%= img %&gt;&quot; /&gt;
      &lt;span class=&quot;caption&quot;&gt;&lt;%= title %&gt;&lt;/span&gt;
    &lt;/a&gt;
  &lt;/div&gt;
}

.slider {
  priority: -10
  html: &lt;div class=&quot;pager&quot;&gt;&lt;/div&gt;
}

.slider div.pager {
  priority: 10
  html: &lt;a class=&quot;prevSlide&quot; href=&quot;javascript:;&quot;&gt;prev&lt;/a&gt;
}

.slider div.pager {
  priority: -10
  html: &lt;a class=&quot;nextSlide&quot; href=&quot;javascript:;&quot;&gt;next&lt;/a&gt;
}

.slider div.pager {
  html: &lt;span class=&quot;pages&quot;&gt;&lt;/span&gt;
}

.slider div.pager {
  html: &lt;span class=&quot;pages&quot;&gt;
    &lt;% for (var i=0; i&lt;slides.length; ++i) { %&gt;
    &lt;a class=&quot;page&quot; href=&quot;javascript:;&quot;&gt;&lt;%= i+1 %&gt;&lt;/a&gt;
    &lt;% } %&gt;
  &lt;/span&gt;
}
</code></pre>
<p>combined with some parameters, it will result</p>
<pre><code class="language-html">&lt;div class=&quot;slider&quot;&gt;
  &lt;div class=&quot;slides&quot;&gt;
    &lt;div class=&quot;slide&quot;&gt;&lt;a href=&quot;..&quot;&gt;&lt;img src=&quot;..&quot;/&gt;&lt;span class=&quot;caption&quot;&gt;...&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;slide&quot;&gt;...&lt;/div&gt;
    &lt;div class=&quot;slide&quot;&gt;...&lt;/div&gt;
    &lt;canvas class=&quot;slides&quot;&gt;&lt;/canvas&gt;
  &lt;/div&gt;
  &lt;div class=&quot;pager&quot;&gt;
    &lt;a href=&quot;javascript:;&quot; class=&quot;prevSlide&quot;&gt;prev&lt;/a&gt;
    &lt;div class=&quot;pages&quot;&gt;
      &lt;a href=&quot;javascript:;&quot; class=&quot;page&quot;&gt;1&lt;/a&gt;
      &lt;a href=&quot;javascript:;&quot; class=&quot;page&quot;&gt;2&lt;/a&gt;
      &lt;a href=&quot;javascript:;&quot; class=&quot;page&quot;&gt;3&lt;/a&gt;
    &lt;/div&gt;                                                                      
    &lt;a href=&quot;javascript:;&quot; class=&quot;nextSlide&quot;&gt;next&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>Of-course we could also do this programmatically with DOM. But see the benefit of such a descriptive way to define things?</p>
<p>You should keep in mind that <strong>the order of rules definition does not matter</strong>. In that’s sense, it is <strong>a mixable, extensible, modular and loosely-coupled template system</strong>.</p>
<h3 id="more-about-this-poc">More about this POC</h3>
<p>Unlike CSS, <strong>two same rules aren’t merged but are appended</strong>.</p>
<p>The <em><strong>priority</strong></em> governs the order of append. The higher the value is, the sooner it is appended to the containers selected by the CSS selector.</p>
<p>As you can see, there is a <strong>micro-templating</strong> inside each rule. For this example, it looks like the John Resig ‘s Micro Templating.</p>
<p>Note also that a rule must be aware of its <strong>parameters</strong> to work properly. But this only concerns the implementation: You have to find a way to give a dynamic reference of these parameters when you add a rule.</p>
<h3 id="concrete-implementation">Concrete implementation</h3>
<p>The code above was a conceptual proof of concept, but I implement a subset of these features in Javascript and made “SelectorTemplating.js” available here : <a href="https://gist.github.com/1731611">https://gist.github.com/1731611</a></p>
<p>This is how it can be used for (almost) the same example. You will see different style of usage:</p>
<pre><code class="language-javascript">var node = document.getElementById(&quot;slider&quot;);
var t = new SelectorTemplating(node);
var tmpl; // defined somewhere, the John Resig &#39;s Micro Templating.

// root module
function root () { return &#39;&lt;div class=&quot;slider&quot;&gt;&lt;/div&gt;&#39; }
t.add(null, root);

// slides module
var slidesTmpl = tmpl(&#39;&lt;div class=&quot;slides&quot;&gt; &lt;% if(obj.slides) { for(var i=0; i&lt;slides.length; ++i) { var s = slides[i]; %&gt; &lt;div class=&quot;slide&quot;&gt; &lt;a href=&quot;&lt;%= s.link %&gt;&quot;&gt; &lt;img src=&quot;&lt;%= s.img %&gt;&quot; /&gt; &lt;span class=&quot;caption&quot;&gt;&lt;%= s.title %&gt;&lt;/span&gt; &lt;/a&gt; &lt;/div&gt; &lt;% }} %&gt; &lt;/div&gt;&#39;)
var slides = [ ... ]; // mutable
t.add(&quot;.slider&quot;, function () { return slidesTmpl(slides: slides) });

// canvas module
t.add(&quot;.slider div.slides&quot;, function () { return &#39;&lt;canvas class=&quot;slides&quot;&gt;&lt;/canvas&gt;&#39; });

// pager module
var pagesTmpl = tmpl(&#39;&lt;div class=&quot;pager&quot;&gt; &lt;span class=&quot;pages&quot;&gt; &lt;% if(obj.slides) { for(var i=0; i&lt;slides.length; ++i) { %&gt; &lt;a href=&quot;javascript:;&quot; class=&quot;page&quot;&gt;&lt;%= i+1 %&gt;&lt;/a&gt; &lt;% }} %&gt; &lt;/span&gt; &lt;/div&gt;&#39;);
var slides = [...]; // synchronised with the slides module
var prevButton, nextButton; // DOM element init when templated
var pages = function () {
  return pagesTmpl(slides: slides);
}
t.add(&quot;.sliderjs&quot;, pages, null, -10);
t.add(&quot;.sliderjs .options&quot;, function () { return &#39;&lt;a class=&quot;prevSlide&quot; href=&quot;javascript:;&quot;&gt;prev&lt;/a&gt;&#39; }, function (n) { prevButton = n[0] }, 10 }); // prepend first in options
t.add(&quot;.sliderjs .options&quot;, function () { return &#39;&lt;a class=&quot;nextSlide&quot; href=&quot;javascript:;&quot;&gt;next&lt;/a&gt;&#39; }, function (n) { nextButton = n[0] }, -10 }); // append at the end of options

// when all modules are init :
t.init();
</code></pre>
<pre><code>t.add (selector, templateFunction, callback, priority)
 * selector is the selector function. if null, append to root.
 * a template function is an identifier in the template.
 * the callback is called at the end of the templating with 2 arguments : the appended nodes and the global container.
</code></pre>
<h4 id="algorithm-of-the-template-process">Algorithm of the template process</h4>
<pre><code>container := the container element
rules := an array containing all rules.
sort rules by priority.
(1) take one rule from rules
  - elements := []
  - if the selector is @root, elements := [container]
  - otherwise, elements := all elements which matches the selector
  - if the elements is empty, back to (1) by taking the next rule.
  - (2) if not, templatize the html and append it into all of these elements. remove the rule from rules. back to (1) by starting from the first rules. 

the loop (1) must end when :
  - there is no rules anymore
  - you have covered all the rules array without finding a match (without passing by (2) for this loop). In that case, it means some rules are not used.
</code></pre>
<p>There is a known limitation of the algorithm I intend to fix soon:
Once we found matching elements for a rule, we append the template in these elements once, and we remove the rule. It’s a simple way to avoid recursion. But this approach doesn’t work if a selector can potentially matches elements defined in different rules. <strong>I know how to fix this but it’s not yet implemented.</strong></p>
<h2 id="whats-next">What&#39;s next?</h2>
<p>We are working hard for the next version (v2) of <a href="http://sliderjs.org">SliderJS</a> by trying to make a revolutionary IDE platform for SliderJS. It requires a modulification of every components of SliderJS, we try to keep things simple (no external library required, the core system is only 4k sized). You will have more information soon!</p>
<p>This templating system should benefits of this work.</p>
<p>Keep in touch!</p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/profile.jpg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">creative coder experimenting with GLSL shaders, Rust, and fountain pens robot plots. infinite noise explorer.</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a><a href="https://hic.link/greweb" class="jsx-2519965637"><img alt="" src="/icons/hic.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2012-02-04-css-selector-based-templating-example-with-javascript","year":"2012","month":"02","day":"04","slug":"css-selector-based-templating-example-with-javascript","content":"\u003cimg src=\"/images/2012/02/218px-Mir_diagram-fr.svg_.png\" alt=\"\" class=\"thumbnail-left\" /\u003e\n\n\u003cp\u003eIn this article, we will focus on the power of \u003cstrong\u003eCSS as a descriptive language\u003c/strong\u003e, current template system approach and their problems with \u003cstrong\u003emodularity\u003c/strong\u003e and \u003cstrong\u003eextensibility\u003c/strong\u003e, and try to mix both features from the \u003cstrong\u003econcept\u003c/strong\u003e to a \u003cstrong\u003econcrete implementation\u003c/strong\u003e.\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003cbr style=\"clear: both\" /\u003e\n\n\u003ch2 id=\"what-is-css-\"\u003eWhat is CSS ?\u003c/h2\u003e\n\u003cp\u003eCSS is an extremely powerful descriptive language.\u003cbr\u003eIt helps to define \u003cstrong\u003ehow to display a document\u003c/strong\u003e (e.g. a web page).\u003c/p\u003e\n\u003cp\u003eA style sheet contains a set of \u003cstrong\u003eCSS rules\u003c/strong\u003e.\u003cbr\u003eEach CSS rule has a \u003cstrong\u003eCSS selector\u003c/strong\u003e associated with a set of \u003cstrong\u003edeclarations\u003c/strong\u003e.\u003cbr\u003eYou can see a CSS selector as a selection filter applied on every HTML element. A few element can match a CSS selector if they fit the structure describes in this selector.\u003cbr\u003eEach \u003cstrong\u003edeclaration\u003c/strong\u003e is composed of a couple (\u003cstrong\u003eproperty\u003c/strong\u003e : \u003cstrong\u003evalue\u003c/strong\u003e).\u003cbr\u003eThe \u003cstrong\u003eCSS property\u003c/strong\u003e is a predefined property related to a display or layout behavior.\u003cbr\u003eThe \u003cstrong\u003evalue\u003c/strong\u003e will apply a custom value for the property on all elements matching the CSS selector.\u003c/p\u003e\n\u003cp\u003eLet’s focus on some advantages of this descriptive language:\u003c/p\u003e\n\u003ch3 id=\"a-css-rule-is-independant-from-others\"\u003eA CSS rule is independant from others.\u003c/h3\u003e\n\u003cp\u003eThe order of CSS rules \u003cem\u003e(selector declarations)\u003c/em\u003e \u003cstrong\u003ereally\u003c/strong\u003e does not matter.\u003cbr\u003eThe priority between CSS rules is based on the selector itself and not on their arrangement.\u003c/p\u003e\n\u003ch3 id=\"you-can-mix-css-rule\"\u003eYou can “mix” CSS rule\u003c/h3\u003e\n\u003cp\u003e2 CSS rules can have the same CSS selector. An element can be matched with multiple CSS rules. CSS rules are merged, it’s called the cascading.\u003cbr\u003eThis is the most important feature of CSS.\u003cbr\u003eIt implies a very modular and extensible language.\u003c/p\u003e\n\u003ch4 id=\"example\"\u003eExample\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-css\"\u003ea {   \n  color: #33CC00;  \n  text-decoration: none;  \n}  \na:hover { text-decoration: underline; }  \n#articles {  \n  font-size: 12px;  \n}  \n#articles a {  \n  color: red; /* overriding the generic color of a */  \n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"some-limitations-of-todays-template-system\"\u003eSome limitations of today’s template system\u003c/h2\u003e\n\u003cp\u003eMost of template system are based on inherence between templates.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e  You have usually an “inclusion” approach: a template will “include” multiple external template. \u003cem\u003e(Many template into Many template)\u003c/em\u003e\u003c/li\u003e\n\u003cli\u003e  And an “extension” approach: You define in a main template an area where you can append a template. Others templates “extend” your main template. \u003cem\u003e(One main template for Many template)\u003c/em\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThese approaches aims to factorize template codes and that’s great.\u003c/p\u003e\n\u003cp\u003eBut it doesn’t fit my needs:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e  It brings \u003cstrong\u003edependencies between templates\u003c/strong\u003e. \u003c/li\u003e\n\u003cli\u003eIf you add a new template, you have to modify existing templates.\u003cbr\u003e  If your application tend to go modules based, this is going to be unmaintainable. \u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eweb application module (n)\u003c/strong\u003e\u003cbr\u003e1 : an independent unit of functionality that is part of the total structure of a web application \u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"a-solution-for-scalable-applications-and-libraries\"\u003eA solution for scalable applications and libraries\u003c/h3\u003e\n\u003cp\u003eI’ve recently started to rewrite my \u003ca href=\"http://sliderjs.org/\"\u003eSliderJS\u003c/a\u003e library and I needed to split it into very modular features and having loose coupling between each component.\u003c/p\u003e\n\u003cp\u003eI followed this \u003ca href=\"http://www.ubelly.com/2011/11/scalablejs/\"\u003eScalable JavaScript Application Architecture\u003c/a\u003e article.\u003c/p\u003e\n\u003cp\u003eSo, \u003cstrong\u003ehow to bring loose coupling in templating?\u003c/strong\u003e.\u003cbr\u003eEach module have its own template and know where to append. Bringing this logic in a main template would break the independency and if I need to add new modules soon, it will not working without modifiyng it.\u003cbr\u003eHow to keep the scalability of the main template without modifying it?\u003c/p\u003e\n\u003cp\u003eThe best solution I found is to combine \u003cstrong\u003eCSS selectors\u003c/strong\u003e concepts with \u003cstrong\u003etemplate system\u003c/strong\u003e approaches.\u003c/p\u003e\n\u003ch2 id=\"css-concepts-applied-on-templating\"\u003eCSS concepts applied on templating\u003c/h2\u003e\n\u003cp\u003eI’ve decided to inspire from CSS: \u003cstrong\u003eattaching a CSS selector with a template\u003c/strong\u003e.\u003cbr\u003eIt benefits from some CSS advantages explained before.\u003c/p\u003e\n\u003ch3 id=\"simple-twitter-widget-example\"\u003eSimple twitter widget example\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;div class=\u0026quot;twitter\u0026quot;\u0026gt;\n  \u0026lt;h1\u0026gt;Twitter\u0026lt;/h1\u0026gt;\n  \u0026lt;ul class=\u0026quot;twitts\u0026quot;\u0026gt;\n    \u0026lt;li class=\u0026quot;twitt\u0026quot;\u0026gt;Hello world!\u0026lt;/li\u0026gt;\n  \u0026lt;/ul\u0026gt;\n  \u0026lt;footer\u0026gt;\u0026lt;a href=\u0026quot;http://twitter.com/greweb\u0026quot;\u0026gt;Follow me on twitter\u0026lt;/a\u0026gt;\u0026lt;/footer\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"classical-approach\"\u003eClassical approach\u003c/h4\u003e\n\u003cp\u003eThe way to template it with the classical approach would be:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;div class=\u0026quot;twitter\u0026quot;\u0026gt;\n  \u0026lt;h1\u0026gt;Twitter\u0026lt;/h1\u0026gt;\n  \u0026lt;ul class=\u0026quot;twitts\u0026quot;\u0026gt;\n    {for twitt in twitts}\n    \u0026lt;li class=\u0026quot;twitt\u0026quot;\u0026gt;{twitt}\u0026lt;/li\u0026gt;\n    {/for}\n  \u0026lt;/ul\u0026gt;\n  \u0026lt;footer\u0026gt;\u0026lt;a href=\u0026quot;http://twitter.com/{me}\u0026quot;\u0026gt;Follow me on twitter\u0026lt;/a\u0026gt;\u0026lt;/footer\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"css-selector-based-approach\"\u003eCSS selector based approach\u003c/h4\u003e\n\u003cp\u003eBut we can also split the original “template” in small fragments and mix all of them.\u003cbr\u003eIt helps to define each templates independently.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWe can identify:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA \u003cstrong\u003eroot template fragment\u003c/strong\u003e:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;div class=\u0026quot;twitter\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eA \u003cstrong\u003eheader fragment\u003c/strong\u003e appended with \u003ccode\u003e.twitter\u003c/code\u003e selector and with an \u003cstrong\u003ehigh priority\u003c/strong\u003e:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;h1\u0026gt;Twitter\u0026lt;/h1\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eA \u003cstrong\u003etwitts list fragment\u003c/strong\u003e appended with \u003ccode\u003e.twitter\u003c/code\u003e selector:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;ul class=\u0026quot;twitts\u0026quot;\u0026gt;\n  {for twitt in twitts}\n  \u0026lt;li class=\u0026quot;twitt\u0026quot;\u0026gt;{twitt}\u0026lt;/li\u0026gt;\n  {/for}\n\u0026lt;/ul\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewith \u003cstrong\u003eparameters\u003c/strong\u003e \u003ccode\u003etwitts = [ \u0026quot;Hello world!\u0026quot; ]\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAn empty \u003cstrong\u003efooter fragment\u003c/strong\u003e appended with \u003ccode\u003e.twitter\u003c/code\u003e selector and with a \u003cstrong\u003elow\u003c/strong\u003e priority:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;footer\u0026gt;\u0026lt;/footer\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eA “follow me” \u003cstrong\u003elink fragment\u003c/strong\u003e appended with \u003ccode\u003e.twitter footer\u003c/code\u003e selector:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;a href=\u0026quot;http://twitter.com/{me}\u0026quot;\u0026gt;Follow me on twitter\u0026lt;/a\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewith \u003cstrong\u003eparameters\u003c/strong\u003e \u003ccode\u003eme = \u0026quot;greweb\u0026quot;\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"advanced-example\"\u003eAdvanced example\u003c/h3\u003e\n\u003cp\u003eThis is another example with a slider. \u003c/p\u003e\n\u003cp\u003eLet’s conceptually imagine the following template language:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e@root { html: \u0026lt;div class=\u0026quot;slider\u0026quot;\u0026gt;\u0026lt;/div\u0026gt; }\n\n.slider {\n  html: \u0026lt;div class=\u0026quot;slides\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;\n}\n\n.slider div.slides {\n  html: \u0026lt;canvas class=\u0026quot;slides\u0026quot;\u0026gt;\u0026lt;/canvas\u0026gt;\n}\n\n.slider div.slides {\n  html:\n  \u0026lt;div class=\u0026quot;slide\u0026quot;\u0026gt;\n    \u0026lt;a href=\u0026quot;\u0026lt;%= link %\u0026gt;\u0026quot;\u0026gt;\n      \u0026lt;img src=\u0026quot;\u0026lt;%= img %\u0026gt;\u0026quot; /\u0026gt;\n      \u0026lt;span class=\u0026quot;caption\u0026quot;\u0026gt;\u0026lt;%= title %\u0026gt;\u0026lt;/span\u0026gt;\n    \u0026lt;/a\u0026gt;\n  \u0026lt;/div\u0026gt;\n}\n\n.slider {\n  priority: -10\n  html: \u0026lt;div class=\u0026quot;pager\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;\n}\n\n.slider div.pager {\n  priority: 10\n  html: \u0026lt;a class=\u0026quot;prevSlide\u0026quot; href=\u0026quot;javascript:;\u0026quot;\u0026gt;prev\u0026lt;/a\u0026gt;\n}\n\n.slider div.pager {\n  priority: -10\n  html: \u0026lt;a class=\u0026quot;nextSlide\u0026quot; href=\u0026quot;javascript:;\u0026quot;\u0026gt;next\u0026lt;/a\u0026gt;\n}\n\n.slider div.pager {\n  html: \u0026lt;span class=\u0026quot;pages\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\n}\n\n.slider div.pager {\n  html: \u0026lt;span class=\u0026quot;pages\u0026quot;\u0026gt;\n    \u0026lt;% for (var i=0; i\u0026lt;slides.length; ++i) { %\u0026gt;\n    \u0026lt;a class=\u0026quot;page\u0026quot; href=\u0026quot;javascript:;\u0026quot;\u0026gt;\u0026lt;%= i+1 %\u0026gt;\u0026lt;/a\u0026gt;\n    \u0026lt;% } %\u0026gt;\n  \u0026lt;/span\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ecombined with some parameters, it will result\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;div class=\u0026quot;slider\u0026quot;\u0026gt;\n  \u0026lt;div class=\u0026quot;slides\u0026quot;\u0026gt;\n    \u0026lt;div class=\u0026quot;slide\u0026quot;\u0026gt;\u0026lt;a href=\u0026quot;..\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;..\u0026quot;/\u0026gt;\u0026lt;span class=\u0026quot;caption\u0026quot;\u0026gt;...\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\n    \u0026lt;div class=\u0026quot;slide\u0026quot;\u0026gt;...\u0026lt;/div\u0026gt;\n    \u0026lt;div class=\u0026quot;slide\u0026quot;\u0026gt;...\u0026lt;/div\u0026gt;\n    \u0026lt;canvas class=\u0026quot;slides\u0026quot;\u0026gt;\u0026lt;/canvas\u0026gt;\n  \u0026lt;/div\u0026gt;\n  \u0026lt;div class=\u0026quot;pager\u0026quot;\u0026gt;\n    \u0026lt;a href=\u0026quot;javascript:;\u0026quot; class=\u0026quot;prevSlide\u0026quot;\u0026gt;prev\u0026lt;/a\u0026gt;\n    \u0026lt;div class=\u0026quot;pages\u0026quot;\u0026gt;\n      \u0026lt;a href=\u0026quot;javascript:;\u0026quot; class=\u0026quot;page\u0026quot;\u0026gt;1\u0026lt;/a\u0026gt;\n      \u0026lt;a href=\u0026quot;javascript:;\u0026quot; class=\u0026quot;page\u0026quot;\u0026gt;2\u0026lt;/a\u0026gt;\n      \u0026lt;a href=\u0026quot;javascript:;\u0026quot; class=\u0026quot;page\u0026quot;\u0026gt;3\u0026lt;/a\u0026gt;\n    \u0026lt;/div\u0026gt;                                                                      \n    \u0026lt;a href=\u0026quot;javascript:;\u0026quot; class=\u0026quot;nextSlide\u0026quot;\u0026gt;next\u0026lt;/a\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOf-course we could also do this programmatically with DOM. But see the benefit of such a descriptive way to define things?\u003c/p\u003e\n\u003cp\u003eYou should keep in mind that \u003cstrong\u003ethe order of rules definition does not matter\u003c/strong\u003e. In that’s sense, it is \u003cstrong\u003ea mixable, extensible, modular and loosely-coupled template system\u003c/strong\u003e.\u003c/p\u003e\n\u003ch3 id=\"more-about-this-poc\"\u003eMore about this POC\u003c/h3\u003e\n\u003cp\u003eUnlike CSS, \u003cstrong\u003etwo same rules aren’t merged but are appended\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThe \u003cem\u003e\u003cstrong\u003epriority\u003c/strong\u003e\u003c/em\u003e governs the order of append. The higher the value is, the sooner it is appended to the containers selected by the CSS selector.\u003c/p\u003e\n\u003cp\u003eAs you can see, there is a \u003cstrong\u003emicro-templating\u003c/strong\u003e inside each rule. For this example, it looks like the John Resig ‘s Micro Templating.\u003c/p\u003e\n\u003cp\u003eNote also that a rule must be aware of its \u003cstrong\u003eparameters\u003c/strong\u003e to work properly. But this only concerns the implementation: You have to find a way to give a dynamic reference of these parameters when you add a rule.\u003c/p\u003e\n\u003ch3 id=\"concrete-implementation\"\u003eConcrete implementation\u003c/h3\u003e\n\u003cp\u003eThe code above was a conceptual proof of concept, but I implement a subset of these features in Javascript and made “SelectorTemplating.js” available here : \u003ca href=\"https://gist.github.com/1731611\"\u003ehttps://gist.github.com/1731611\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis is how it can be used for (almost) the same example. You will see different style of usage:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar node = document.getElementById(\u0026quot;slider\u0026quot;);\nvar t = new SelectorTemplating(node);\nvar tmpl; // defined somewhere, the John Resig \u0026#39;s Micro Templating.\n\n// root module\nfunction root () { return \u0026#39;\u0026lt;div class=\u0026quot;slider\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;\u0026#39; }\nt.add(null, root);\n\n// slides module\nvar slidesTmpl = tmpl(\u0026#39;\u0026lt;div class=\u0026quot;slides\u0026quot;\u0026gt; \u0026lt;% if(obj.slides) { for(var i=0; i\u0026lt;slides.length; ++i) { var s = slides[i]; %\u0026gt; \u0026lt;div class=\u0026quot;slide\u0026quot;\u0026gt; \u0026lt;a href=\u0026quot;\u0026lt;%= s.link %\u0026gt;\u0026quot;\u0026gt; \u0026lt;img src=\u0026quot;\u0026lt;%= s.img %\u0026gt;\u0026quot; /\u0026gt; \u0026lt;span class=\u0026quot;caption\u0026quot;\u0026gt;\u0026lt;%= s.title %\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;% }} %\u0026gt; \u0026lt;/div\u0026gt;\u0026#39;)\nvar slides = [ ... ]; // mutable\nt.add(\u0026quot;.slider\u0026quot;, function () { return slidesTmpl(slides: slides) });\n\n// canvas module\nt.add(\u0026quot;.slider div.slides\u0026quot;, function () { return \u0026#39;\u0026lt;canvas class=\u0026quot;slides\u0026quot;\u0026gt;\u0026lt;/canvas\u0026gt;\u0026#39; });\n\n// pager module\nvar pagesTmpl = tmpl(\u0026#39;\u0026lt;div class=\u0026quot;pager\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;pages\u0026quot;\u0026gt; \u0026lt;% if(obj.slides) { for(var i=0; i\u0026lt;slides.length; ++i) { %\u0026gt; \u0026lt;a href=\u0026quot;javascript:;\u0026quot; class=\u0026quot;page\u0026quot;\u0026gt;\u0026lt;%= i+1 %\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;% }} %\u0026gt; \u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt;\u0026#39;);\nvar slides = [...]; // synchronised with the slides module\nvar prevButton, nextButton; // DOM element init when templated\nvar pages = function () {\n  return pagesTmpl(slides: slides);\n}\nt.add(\u0026quot;.sliderjs\u0026quot;, pages, null, -10);\nt.add(\u0026quot;.sliderjs .options\u0026quot;, function () { return \u0026#39;\u0026lt;a class=\u0026quot;prevSlide\u0026quot; href=\u0026quot;javascript:;\u0026quot;\u0026gt;prev\u0026lt;/a\u0026gt;\u0026#39; }, function (n) { prevButton = n[0] }, 10 }); // prepend first in options\nt.add(\u0026quot;.sliderjs .options\u0026quot;, function () { return \u0026#39;\u0026lt;a class=\u0026quot;nextSlide\u0026quot; href=\u0026quot;javascript:;\u0026quot;\u0026gt;next\u0026lt;/a\u0026gt;\u0026#39; }, function (n) { nextButton = n[0] }, -10 }); // append at the end of options\n\n// when all modules are init :\nt.init();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003et.add (selector, templateFunction, callback, priority)\n * selector is the selector function. if null, append to root.\n * a template function is an identifier in the template.\n * the callback is called at the end of the templating with 2 arguments : the appended nodes and the global container.\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"algorithm-of-the-template-process\"\u003eAlgorithm of the template process\u003c/h4\u003e\n\u003cpre\u003e\u003ccode\u003econtainer := the container element\nrules := an array containing all rules.\nsort rules by priority.\n(1) take one rule from rules\n  - elements := []\n  - if the selector is @root, elements := [container]\n  - otherwise, elements := all elements which matches the selector\n  - if the elements is empty, back to (1) by taking the next rule.\n  - (2) if not, templatize the html and append it into all of these elements. remove the rule from rules. back to (1) by starting from the first rules. \n\nthe loop (1) must end when :\n  - there is no rules anymore\n  - you have covered all the rules array without finding a match (without passing by (2) for this loop). In that case, it means some rules are not used.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThere is a known limitation of the algorithm I intend to fix soon:\nOnce we found matching elements for a rule, we append the template in these elements once, and we remove the rule. It’s a simple way to avoid recursion. But this approach doesn’t work if a selector can potentially matches elements defined in different rules. \u003cstrong\u003eI know how to fix this but it’s not yet implemented.\u003c/strong\u003e\u003c/p\u003e\n\u003ch2 id=\"whats-next\"\u003eWhat\u0026#39;s next?\u003c/h2\u003e\n\u003cp\u003eWe are working hard for the next version (v2) of \u003ca href=\"http://sliderjs.org\"\u003eSliderJS\u003c/a\u003e by trying to make a revolutionary IDE platform for SliderJS. It requires a modulification of every components of SliderJS, we try to keep things simple (no external library required, the core system is only 4k sized). You will have more information soon!\u003c/p\u003e\n\u003cp\u003eThis templating system should benefits of this work.\u003c/p\u003e\n\u003cp\u003eKeep in touch!\u003c/p\u003e\n","data":{"title":"CSS-selector-based templating system for scalable JavaScript applications","description":"In this article, we will focus on the power of CSS as a descriptive language, current template system approach and their problems with modularity and extensibility, and try to mix both features from the concept to a concrete implementation.","thumbnail":"/images/2012/02/218px-Mir_diagram-fr.svg_.png","author":"Gaetan","layout":"post","permalink":"/2012/02/css-selector-based-templating-example-with-javascript/","tags":["css","javascript","templating"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2012","month":"02","slug":"css-selector-based-templating-example-with-javascript"},"buildId":"-L4W7d2blbDCNXHVWGxGZ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>