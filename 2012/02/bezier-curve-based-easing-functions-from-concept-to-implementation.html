<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="Many animation libraries are today using easing functions – functions of time returning a progression percentage value. We will see how we can generalize them with bezier curves."/><meta name="keywords" content="animation, bezier, css, javascript"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Bezier Curve based easing functions – from concept to implementation"/><meta name="og:title" content="Bezier Curve based easing functions – from concept to implementation"/><meta name="twitter:description" content="Many animation libraries are today using easing functions – functions of time returning a progression percentage value. We will see how we can generalize them with bezier curves."/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2012/02/bezier_transition_editor.png"/><meta name="twitter:image" content="http://greweb.me//images/2012/02/bezier_transition_editor.png"/><link rel="image_src" href="http://greweb.me//images/2012/02/bezier_transition_editor.png"/><title>@greweb - Bezier Curve based easing functions – from concept to implementation</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-381dbb3c33243b4920e6.js"></script><script src="/_next/static/chunks/webpack-17597d20e291f72b2439.js" defer=""></script><script src="/_next/static/chunks/framework-bdc1b4e5e48979e16d36.js" defer=""></script><script src="/_next/static/chunks/main-4ac108dd57980e4159e9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c981e0e3ce59f13eb8d0.js" defer=""></script><script src="/_next/static/chunks/5988-738c1ea5f97353b6463e.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-b78f23c90ce5148ef413.js" defer=""></script><script src="/_next/static/eN9Fpz7p7iXcxFNVbH2Wz/_buildManifest.js" defer=""></script><script src="/_next/static/eN9Fpz7p7iXcxFNVbH2Wz/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Bezier Curve based easing functions – from concept to implementation</a></h1><time class="date" dateTime="2012-02-29">2012-02-29</time><span class="tags"><a class="tag">animation</a><a class="tag">bezier</a><a class="tag">css</a><a class="tag">javascript</a></span></header><div class="entry-content"><blockquote>
<p><strong>EDIT 2014:</strong> This article ends up in an updated library available on <a href="http://npmjs.org/package/bezier-easing">NPM</a> (<code>bezier-easing</code>) and available on <a href="https://github.com/gre/bezier-easing">Github</a>. It has been used by Apple for the <a href="http://www.apple.com/mac-pro/">mac-pro page</a> and by <a href="http://velocityjs.org/">Velocity.js</a>. You can also find its usage in the <a href="http://greweb.me/glsl-transition/example/">glsl-transition examples</a>.</p>
</blockquote>
<img src="/images/2012/02/bezier_transition_editor.png" class="thumbnail-left" />

<p>Many animation libraries are today using <strong>easing functions</strong> – functions of time returning a progression percentage value. This is required to perform such cool effects:</p>
<iframe src="/demo/simple-easing-animation/" height="50" width="50%"></iframe>

<p>But most of these libraries implement a huge collection of functions. We will see how we can generalize them with bezier curves.</p>
<!--more-->

<p>For instance, we use to do this:</p>
<pre><code class="language-javascript">EasingFunctions = {
  linear: function (t) {
    return t;
  },
  easeInQuad: function (t) {
    return t * t;
  },
  easeOutQuad: function (t) {
    return t * (2 - t);
  },
  easeInOutQuad: function (t) {
    return t &lt; 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
  },
  easeInCubic: function (t) {
    return t * t * t;
  },
  easeOutCubic: function (t) {
    return --t * t * t + 1;
  },
  easeInOutCubic: function (t) {
    return t &lt; 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
  },
  easeInQuart: function (t) {
    return t * t * t * t;
  },
  easeOutQuart: function (t) {
    return 1 - --t * t * t * t;
  },
  easeInOutQuart: function (t) {
    return t &lt; 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t;
  },
  easeInQuint: function (t) {
    return t * t * t * t * t;
  },
  easeOutQuint: function (t) {
    return 1 + --t * t * t * t * t;
  },
  easeInOutQuint: function (t) {
    return t &lt; 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t;
  },
};
</code></pre>
<p>Defining such functions is lot of math fun but it is very <strong>specific</strong> and not really customizable. Hopefully, we can generalize these easing functions. With <strong>Bezier curves</strong>.</p>
<p>In fact, this work has already been done in CSS Transitions and CSS Animations specifications! You can use <code>transition-timing-function</code> CSS property and give a <code>cubic-bezier(x1, y1, x2, y2)</code> value (all <strong>ease, linear, ease-in, ease-out, ease-in-out</strong> values are just fallbacking on this cubic-bezier usage).</p>
<p><img src="/images/2012/02/TimingFunction.png" alt=""></p>
<p>In a bezier curve based easing function, the X axis is the <strong>time axis</strong> whereas the Y axis represents the <strong>percentage of progress</strong> of the animation.<br>The two points P1 and P2 are called <strong>handles</strong> and you can (exclusively) control their X and Y positions to generate every possible cubic timing function.</p>
<h3 id="live-demo">Live demo</h3>
<p>Try to interact with the handles:</p>
<iframe src="/demo/bezier-easing/" frameborder="0" width="560" height="400"></iframe>

<h2 id="implementation">Implementation</h2>
<p>Ok, so, this bezier curve concept is great but how can I implement it?</p>
<p>I’ve read <a href="http://13thparallel.com/archive/bezier-curves/">here</a> how simple is it to <strong>compute many points of a Bezier curve</strong> and potentially draw them:</p>
<pre><code class="language-javascript">function B1(t) {
  return t * t * t;
}
function B2(t) {
  return 3 * t * t * (1 - t);
}
function B3(t) {
  return 3 * t * (1 - t) * (1 - t);
}
function B4(t) {
  return (1 - t) * (1 - t) * (1 - t);
}
function getBezier(percent, C1, C2, C3, C4) {
  var pos = new coord();
  pos.x =
    C1.x * B1(percent) +
    C2.x * B2(percent) +
    C3.x * B3(percent) +
    C4.x * B4(percent);
  pos.y =
    C1.y * B1(percent) +
    C2.y * B2(percent) +
    C3.y * B3(percent) +
    C4.y * B4(percent);
  return pos;
}
</code></pre>
<p>But it’s not enough. We need to project a point to the Bezier curve, in other words, we need to get the Y of a given X in the bezier curve, and we can’t just get it with the <code>percent</code> parameter of the Bezier computation.<br><strong>We need an interpolation.</strong></p>
<h3 id="deep-into-firefox-implementation">Deep into Firefox implementation</h3>
<p>In Mozilla Firefox, The bezier curve interpolation is implemented in nsSMILKeySpline.cpp : .</p>
<p>What we can learn from it is:</p>
<ul>
<li>A first optimization store <strong>sample values of the bezier curve</strong> in a small table used to roughly find a initial X guess.</li>
<li>Then, it use two different implementation strategies: One use the <a href="http://en.wikipedia.org/wiki/Newton%27s_method">Newton’s method</a> and the other is just a <a href="http://en.wikipedia.org/wiki/Dichotomic_search">dichotomic search</a> (binary subdivision).</li>
<li>A <strong>criteria</strong> based on the <strong>slope</strong> give the best strategy to take.</li>
</ul>
<p>These sub-optimizations probably make the difference for the C++ version but are not really relevant for the JavaScript implementation. Moreover, I have only used the Newton’s method algorithm.<br>And this is the code:</p>
<script src="https://gist.github.com/1926947.js?file=KeySpline.js"></script>

<p>Now we can just alias some classic easing function – like CSS does.</p>
<script src="https://gist.github.com/1926947.js?file=EasingFunctions.json"></script>

<p>I’m working on the next version of <a href="http://sliderjs.org/">Slider.JS</a> which relies on 3 different technologies for image transitions: <strong>CSS Transitions</strong>, <strong>Canvas</strong> and <strong>GLSL shaders (from WebGL)</strong>.</p>
<hr>
<p>I have now found <strong>a common way to describe easing functions for both CSS-based and Javascript-based animations</strong>!</p>
<p>This example has shown that sometimes, finding a larger solution for a problem is more interesting than having specific solutions.<br><strong>This is called the <a href="http://en.wikipedia.org/wiki/Inventor&#39;s_paradox">Inventor’s paradox</a>.</strong></p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/logo.svg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">generative artist. doodling with algorithms (creative coding). shaders &amp; fountain pens robot plotting.</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://opensea.io/greweb" class="jsx-2519965637"><img alt="" src="/icons/eth.svg" class="jsx-2519965637"/></a><a href="https://objkt.com/profile/tz1cgQAQfECg5bPASYTMyJ9QJQjSUi8rfL67" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://fxhash.xyz/u/greweb" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2012-02-29-bezier-curve-based-easing-functions-from-concept-to-implementation","year":"2012","month":"02","day":"29","slug":"bezier-curve-based-easing-functions-from-concept-to-implementation","content":"\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eEDIT 2014:\u003c/strong\u003e This article ends up in an updated library available on \u003ca href=\"http://npmjs.org/package/bezier-easing\"\u003eNPM\u003c/a\u003e (\u003ccode\u003ebezier-easing\u003c/code\u003e) and available on \u003ca href=\"https://github.com/gre/bezier-easing\"\u003eGithub\u003c/a\u003e. It has been used by Apple for the \u003ca href=\"http://www.apple.com/mac-pro/\"\u003emac-pro page\u003c/a\u003e and by \u003ca href=\"http://velocityjs.org/\"\u003eVelocity.js\u003c/a\u003e. You can also find its usage in the \u003ca href=\"http://greweb.me/glsl-transition/example/\"\u003eglsl-transition examples\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cimg src=\"/images/2012/02/bezier_transition_editor.png\" class=\"thumbnail-left\" /\u003e\n\n\u003cp\u003eMany animation libraries are today using \u003cstrong\u003eeasing functions\u003c/strong\u003e – functions of time returning a progression percentage value. This is required to perform such cool effects:\u003c/p\u003e\n\u003ciframe src=\"/demo/simple-easing-animation/\" height=\"50\" width=\"50%\"\u003e\u003c/iframe\u003e\n\n\u003cp\u003eBut most of these libraries implement a huge collection of functions. We will see how we can generalize them with bezier curves.\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003cp\u003eFor instance, we use to do this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eEasingFunctions = {\n  linear: function (t) {\n    return t;\n  },\n  easeInQuad: function (t) {\n    return t * t;\n  },\n  easeOutQuad: function (t) {\n    return t * (2 - t);\n  },\n  easeInOutQuad: function (t) {\n    return t \u0026lt; 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  },\n  easeInCubic: function (t) {\n    return t * t * t;\n  },\n  easeOutCubic: function (t) {\n    return --t * t * t + 1;\n  },\n  easeInOutCubic: function (t) {\n    return t \u0026lt; 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n  },\n  easeInQuart: function (t) {\n    return t * t * t * t;\n  },\n  easeOutQuart: function (t) {\n    return 1 - --t * t * t * t;\n  },\n  easeInOutQuart: function (t) {\n    return t \u0026lt; 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t;\n  },\n  easeInQuint: function (t) {\n    return t * t * t * t * t;\n  },\n  easeOutQuint: function (t) {\n    return 1 + --t * t * t * t * t;\n  },\n  easeInOutQuint: function (t) {\n    return t \u0026lt; 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t;\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDefining such functions is lot of math fun but it is very \u003cstrong\u003especific\u003c/strong\u003e and not really customizable. Hopefully, we can generalize these easing functions. With \u003cstrong\u003eBezier curves\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIn fact, this work has already been done in CSS Transitions and CSS Animations specifications! You can use \u003ccode\u003etransition-timing-function\u003c/code\u003e CSS property and give a \u003ccode\u003ecubic-bezier(x1, y1, x2, y2)\u003c/code\u003e value (all \u003cstrong\u003eease, linear, ease-in, ease-out, ease-in-out\u003c/strong\u003e values are just fallbacking on this cubic-bezier usage).\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2012/02/TimingFunction.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eIn a bezier curve based easing function, the X axis is the \u003cstrong\u003etime axis\u003c/strong\u003e whereas the Y axis represents the \u003cstrong\u003epercentage of progress\u003c/strong\u003e of the animation.\u003cbr\u003eThe two points P1 and P2 are called \u003cstrong\u003ehandles\u003c/strong\u003e and you can (exclusively) control their X and Y positions to generate every possible cubic timing function.\u003c/p\u003e\n\u003ch3 id=\"live-demo\"\u003eLive demo\u003c/h3\u003e\n\u003cp\u003eTry to interact with the handles:\u003c/p\u003e\n\u003ciframe src=\"/demo/bezier-easing/\" frameborder=\"0\" width=\"560\" height=\"400\"\u003e\u003c/iframe\u003e\n\n\u003ch2 id=\"implementation\"\u003eImplementation\u003c/h2\u003e\n\u003cp\u003eOk, so, this bezier curve concept is great but how can I implement it?\u003c/p\u003e\n\u003cp\u003eI’ve read \u003ca href=\"http://13thparallel.com/archive/bezier-curves/\"\u003ehere\u003c/a\u003e how simple is it to \u003cstrong\u003ecompute many points of a Bezier curve\u003c/strong\u003e and potentially draw them:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003efunction B1(t) {\n  return t * t * t;\n}\nfunction B2(t) {\n  return 3 * t * t * (1 - t);\n}\nfunction B3(t) {\n  return 3 * t * (1 - t) * (1 - t);\n}\nfunction B4(t) {\n  return (1 - t) * (1 - t) * (1 - t);\n}\nfunction getBezier(percent, C1, C2, C3, C4) {\n  var pos = new coord();\n  pos.x =\n    C1.x * B1(percent) +\n    C2.x * B2(percent) +\n    C3.x * B3(percent) +\n    C4.x * B4(percent);\n  pos.y =\n    C1.y * B1(percent) +\n    C2.y * B2(percent) +\n    C3.y * B3(percent) +\n    C4.y * B4(percent);\n  return pos;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut it’s not enough. We need to project a point to the Bezier curve, in other words, we need to get the Y of a given X in the bezier curve, and we can’t just get it with the \u003ccode\u003epercent\u003c/code\u003e parameter of the Bezier computation.\u003cbr\u003e\u003cstrong\u003eWe need an interpolation.\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"deep-into-firefox-implementation\"\u003eDeep into Firefox implementation\u003c/h3\u003e\n\u003cp\u003eIn Mozilla Firefox, The bezier curve interpolation is implemented in nsSMILKeySpline.cpp : .\u003c/p\u003e\n\u003cp\u003eWhat we can learn from it is:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA first optimization store \u003cstrong\u003esample values of the bezier curve\u003c/strong\u003e in a small table used to roughly find a initial X guess.\u003c/li\u003e\n\u003cli\u003eThen, it use two different implementation strategies: One use the \u003ca href=\"http://en.wikipedia.org/wiki/Newton%27s_method\"\u003eNewton’s method\u003c/a\u003e and the other is just a \u003ca href=\"http://en.wikipedia.org/wiki/Dichotomic_search\"\u003edichotomic search\u003c/a\u003e (binary subdivision).\u003c/li\u003e\n\u003cli\u003eA \u003cstrong\u003ecriteria\u003c/strong\u003e based on the \u003cstrong\u003eslope\u003c/strong\u003e give the best strategy to take.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThese sub-optimizations probably make the difference for the C++ version but are not really relevant for the JavaScript implementation. Moreover, I have only used the Newton’s method algorithm.\u003cbr\u003eAnd this is the code:\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/1926947.js?file=KeySpline.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eNow we can just alias some classic easing function – like CSS does.\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/1926947.js?file=EasingFunctions.json\"\u003e\u003c/script\u003e\n\n\u003cp\u003eI’m working on the next version of \u003ca href=\"http://sliderjs.org/\"\u003eSlider.JS\u003c/a\u003e which relies on 3 different technologies for image transitions: \u003cstrong\u003eCSS Transitions\u003c/strong\u003e, \u003cstrong\u003eCanvas\u003c/strong\u003e and \u003cstrong\u003eGLSL shaders (from WebGL)\u003c/strong\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eI have now found \u003cstrong\u003ea common way to describe easing functions for both CSS-based and Javascript-based animations\u003c/strong\u003e!\u003c/p\u003e\n\u003cp\u003eThis example has shown that sometimes, finding a larger solution for a problem is more interesting than having specific solutions.\u003cbr\u003e\u003cstrong\u003eThis is called the \u003ca href=\"http://en.wikipedia.org/wiki/Inventor\u0026#39;s_paradox\"\u003eInventor’s paradox\u003c/a\u003e.\u003c/strong\u003e\u003c/p\u003e\n","data":{"title":"Bezier Curve based easing functions – from concept to implementation","description":"Many animation libraries are today using easing functions – functions of time returning a progression percentage value. We will see how we can generalize them with bezier curves.","thumbnail":"/images/2012/02/bezier_transition_editor.png","author":"Gaetan","layout":"post","permalink":"/2012/02/bezier-curve-based-easing-functions-from-concept-to-implementation/","tags":["animation","bezier","css","javascript"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2012","month":"02","slug":"bezier-curve-based-easing-functions-from-concept-to-implementation"},"buildId":"eN9Fpz7p7iXcxFNVbH2Wz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>