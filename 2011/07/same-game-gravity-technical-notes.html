<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="The Same Game is available for 6 different platforms. And I can pump out new builds for them all in around 15 minutes. Here’s how…"/><meta name="keywords" content="mobile, gamedev, canvas"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Same Game Gravity: 6 platforms, 1 codebase"/><meta name="og:title" content="Same Game Gravity: 6 platforms, 1 codebase"/><meta name="twitter:description" content="The Same Game is available for 6 different platforms. And I can pump out new builds for them all in around 15 minutes. Here’s how…"/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2011/07/gravity_exemple.png"/><meta name="twitter:image" content="http://greweb.me//images/2011/07/gravity_exemple.png"/><link rel="image_src" href="http://greweb.me//images/2011/07/gravity_exemple.png"/><title>@greweb - Same Game Gravity: 6 platforms, 1 codebase</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-c914a1e31212c00c738a.js" defer=""></script><script src="/_next/static/chunks/framework-bdc1b4e5e48979e16d36.js" defer=""></script><script src="/_next/static/chunks/main-3b0c517193ca5150f81f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c981e0e3ce59f13eb8d0.js" defer=""></script><script src="/_next/static/chunks/5988-738c1ea5f97353b6463e.js" defer=""></script><script src="/_next/static/chunks/2242-d7350c4a4015a6e6ffc2.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-476d7e87469cc8a40c59.js" defer=""></script><script src="/_next/static/kwag29-p4zBWeIUk2JJqu/_buildManifest.js" defer=""></script><script src="/_next/static/kwag29-p4zBWeIUk2JJqu/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Same Game Gravity: 6 platforms, 1 codebase</a></h1><time class="date" dateTime="2011-07-12">2011-07-12</time><span class="tags"><a class="tag">mobile</a><a class="tag">gamedev</a><a class="tag">canvas</a></span></header><div class="entry-content"><p>see also <a href="/2011/07/same-game-gravity-for-ipad-iphone-android-facebook-chrome-and-web/">Same Game Gravity presentation</a>.</p>
<p>2 years ago, I started to developed the <a href="http://gre.github.io/same-game-gravity">Same Game</a> as an HTML Canvas experiment. I’ve enjoyed developing this game, mostly because playing with HTML5 Canvas is so easy. Recently I’ve seen a nice increase in the user base (now around 250 visitors a day) – despite it being perhaps the simplest games I’ve ever developed. Simplicity is good, but my increase in users is thanks to the power of HTML5: The Same Game is available for 6 different platforms. And I can pump out new builds for them all in around 15 minutes. Here’s how…</p>
<p><strong>It’s often the simplest games which work. Too much complexity is not good.</strong></p>
<p><a href="http://gre.github.io/same-game-gravity"><br><img src="/images/2011/07/gravity_exemple.png" alt="">
</a></p>
<!--more-->

<p>In 2010, I learned how to make mobile web applications. It was also the year of the iPad. Out of interest I tried my same game canvas experiment on the iPad, and was surprised to find that it worked pretty well out of the box! Seeing it run on multiple devices was exciting – and the touch screens offered a new dimension for creating highly intuitive interactions. I mean, today, <strong>even my mum can play Same Game Gravity without any help!</strong> (That’s unfortunately not the case for her desktop)</p>
<p>That’s why I wanted to make Same Game for mobile. I started out developing and testing it as an Android application – because I have an Android phone. I created my own micro framework with some MVC concept (views, controllers, a router, etc.). The goal was to create <strong>a simple and light web app that look like a native application</strong>. For views? Portions of HTML. For transitions between views? CSS transitions. Supporting the “back” button of Android devices as a native application? I played with the hash (onhashchange event). </p>
<p>In short, the web is wide and worldly enough to do pretty much everything you want with…</p>
<p>So I implemented the Same Game on Android. But (naturally) the game already existed on Android! I had to find something new! I was itching to fully exploit the possibilities of a new technology. Mobile has great potential – so it would be bad not to make use of new APIs. I discovered <strong>the Accelerometer</strong>. My idea was gravity: change the balls position by rotating the device.</p>
<p>But, many of my friends don’t have Android phones!</p>
<p>The Same Game Gravity is now available for iPad, iPhone, Android, Facebook, Chrome Store and desktop browsers. That’s a lot of platforms, with a lot of APIs to learn – and potentially a LOT of work in maintenance. But thankfully I didn’t have to go off learning Objective-C and Java Android, or keep track of arm-fulls of repositories! All the platforms are supported from <strong>a single codebase</strong>: thanks to the power and awesomeness of JavaScript, HTML, and CSS – combined with a nifty tool I developed <a href="/2011/06/automating-web-app-development-for-multiple-platforms/">WebAppBuilder</a> to easily build each instance.</p>
<p><strong>I added a cool scoring system that spreads via multiple social networks simultaneously and easily – and now I have a truly cross-platform game!</strong></p>
<h3 id="the-code">The code</h3>
<p>Desktop version source code is available on <a href="https://github.com/gre/same-game-gravity">Github</a>.</p>
<h4 id="the-html">The HTML</h4>
<p>(see <a href="https://github.com/gre/same-game-gravity/blob/master/game.html">game.html</a>)</p>
<p>The HTML code is pretty simple.<br>Basically, there is a <strong>container which contains different</strong>. Each section is a view of the game.</p>
<p>For instance here is the game view :  </p>
<pre><code class="language-html">&lt;section id=&quot;game&quot;&gt;
  &lt;div class=&quot;turnleft&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;turnright&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;gameStatus&quot;&gt;
    &lt;a class=&quot;i18n-back back&quot; href=&quot;#!/&quot;&gt;Back&lt;/a&gt;
    &lt;span class=&quot;timeline&quot;&gt;
      &lt;span class=&quot;remainingSeconds&quot;&gt;&lt;span class=&quot;remainingSecondsTime&quot;&gt;&lt;/span&gt; s&lt;/span&gt;
    &lt;/span&gt;
  &lt;/div&gt;
  &lt;div id=&quot;gameContainer&quot;&gt;
    &lt;canvas class=&quot;highlight&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
    &lt;canvas class=&quot;main&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
  &lt;/div&gt;
&lt;/section&gt;
</code></pre>
<p>In the desktop version, <strong>game.html</strong> is wrapped into <strong>index.html</strong> in an iframe to keep the game independent of the context.</p>
<h4 id="the-css">The CSS</h4>
<p>(see <a href="https://github.com/gre/same-game-gravity/blob/master/game.css">game.css</a>)</p>
<p>CSS 3 is very rich.</p>
<p>CSS Transitions and CSS Transforms has been used to do view change.  </p>
<pre><code class="language-css">/* Pre conditions :
 * With Javascript: 
   - A class &quot;current&quot; is setted for the current section view. 
   - All section after &quot;current&quot; must take a &quot;after&quot; class. 
 */
#main.enabletransition &gt; section { /* #main must take &quot;enabletransition&quot; after the DOM load to avoid a first transition */
  transition-duration: 1s, 0s;  /* transform takes 1s duration, opacity doesn&#39;t have transition */
}
#main &gt; section {
  z-index: -1;
  opacity: 0;
  transition-delay: 0s, 1s; /* opacity go to 0 in 1s */
  transition-property: transform, opacity;
  transform: translateY(-100%); /* go above the page */
}
#main &gt; section.current {
  z-index: 0;
  opacity: 1;
  transition-delay: 0s, 0s;
  transition-transform: translateY(0%); /* go to the bottom */
}
#main &gt; section.after { /* same as &quot;#main &gt; section.current ~ section&quot; but without bugs */
  opacity: 0;
  transition-delay: 0s, 1s;
  transform: translateY(100%); /* go below the page */
}
 
/* Note that this is a part of the css code 
 * (you need to add -webkit-, -moz-, ... in some properties)
 */
</code></pre>
<h4 id="the-game-core">The game core</h4>
<p>(see <a href="https://github.com/gre/same-game-gravity/blob/master/game.js">game.js</a>)</p>
<p>Code is organized in different javascript “classes”.</p>
<p>The main components are :</p>
<ul>
<li>  <a href="https://github.com/gre/same-game-gravity/blob/master/game.js#L324">game.Grid</a> contains all the algorithm of the game.</li>
<li>  <a href="https://github.com/gre/same-game-gravity/blob/master/game.js#L687">game.GameCanvasRenderer</a> is a game renderer (graphic part of the game) based on HTML Canvas element. It contains different functions called by <strong>game.Game</strong>.</li>
<li>  <a href="https://github.com/gre/same-game-gravity/blob/master/game.js#L850">game.Game</a> contains all the game logic, the game loop and bind DOM events (touch, click, …).</li>
</ul>
<h4 id="gamedesktopjs-a-game-instance-for-the-desktop">game.desktop.js: a game instance for the desktop</h4>
<p>(see <a href="https://github.com/gre/same-game-gravity/blob/master/game.desktop.js">game.desktop.js</a>)</p>
<p>This file contains all the specific code for the desktop version (it overrides existing classes). But it mainly contains the <a href="https://github.com/gre/same-game-gravity/blob/master/game.desktop.js#L137">game controller</a> handling different views and using all game classes.</p>
<h5 id="some-significant-code">Some significant code</h5>
<pre><code class="language-javascript">// Colors.get(nb) : pick nb random colors 
var Colors = function() {
  var clrs = [ new Color(&#39;#D34040&#39;), new Color(&#39;#82D340&#39;), new Color(&#39;#40C2D3&#39;), new Color(&#39;#8B40D3&#39;), new Color(&#39;#D3C840&#39;) ];
  return {
      get: function(nb) {
      return clrs
      .sort(function(){ return Math.random() - 0.5; })
      .slice(0, nb);
    }
  }
}();
 
/** Game instanciation **/
 
var gridSizeByDifficulty = [ // Size of grid for each difficulty
  {w:8, h:8},
  {w:12, h: 12},
  {w: 16, h: 16}
];
var colorNumberByDifficulty = [3, 4, 5]; // Nb of colors for each difficulty
 
var difficulty; // can be 0 (easy), 1 (normal) or 2 (hard)
currentGame = new game.Game({
  gridSize: gridSizeByDifficulty[difficulty],
  colors: colors=Colors.get(colorNumberByDifficulty[difficulty]),
  container: &#39;#game&#39;, // container selector
  rendererClass: &#39;GameCanvasRenderer&#39;, // The class to use for rendering the game
  difficulty: difficulty,
  drawHover: true,
  globalTimer: new Timer().pause(),
  keepSquare: true // Keep a square ratio
});
</code></pre>
<h3 id="the-gravity">The gravity</h3>
<p>The game gravity was maybe the hardest part of the game development. </p>
<h4 id="using-device-accelerometer-for-mobiletablet-version">Using device Accelerometer for mobile/tablet version</h4>
<p>I needed to find ways to access to the device accelerometer. For Android I used <a href="http://docs.phonegap.com/phonegap_accelerometer_accelerometer.md.html">PhoneGap Accelerometer</a>. But on iPhone I wasn’t able to get PhoneGap’s accelerometer.getCurrentAcceleration to work properly, so I used DeviceMotion event supported by iOS 4.2 . (see <a href="http://dev.w3.org/geo/api/spec-source-orientation.html">DeviceOrientation spec</a>).</p>
<p>(A big thanks to <a href="http://twitter.com/42loops">@42loops</a> for that: <a href="https://github.com/peutetre/test-mobile-safari/blob/master/devicemotionevent.html">devicemotionevent.html</a>)</p>
<p><img src="/images/2011/07/c-rotation.png" alt="Device orientation schema"></p>
<h4 id="css-transforms-and-transitions-for-the-desktop-version">CSS Transforms and Transitions for the desktop version</h4>
<p>Computers don’t have an Accelerometer. <em>Except maybe some macbook but I’m not sure people would like to turn macbook in 360°!</em> but the gravity concept is crucial to the game. I ended up implementing “gravity” via the arrow keys.<br>The game is entirely rotated with <a href="https://github.com/gre/same-game-gravity/blob/master/game.desktop.js#L31">CSS Transforms</a> and animated with <a href="https://github.com/gre/same-game-gravity/blob/master/index.css#L35">CSS Transitions</a>.</p>
<h3 id="the-score-system">The score system</h3>
<p>I’ve written a web service with <a href="http://playframework.org/">Play! framework</a> to receive scores or retrieve them from Twitter, validate them and spread them with a json API and widgets.</p>
<p><img src="/images/2011/07/same_game_gravity_schema.jpg" alt="tweet example"></p>
<p><strong>This web service will be available soon for game developers.</strong></p>
<p>The power of this web service is the usage of <strong>social networks</strong>. It will retrieve peoples names, avatars, and their social links without needing to prompt the user.<br>For game developers, social scores sharing is a nice way of <strong>advertising your game</strong>: someone shares his scores to his friends: so your game can spread virally.</p>
<p>See that little hash “$4f005″? That’s a way to check if sent scores are valid.<br>In fact the web service allows you to handle your own security, via your own “twitter to scores” transformer. You can add a small Javascript function that is executed by the server when transforming a twit to scores – to ensure there hasn’t been any cheating.</p>
<p>The web service also provides <strong>generic widgets</strong> to easily embed game scores in websites.<br>If a player has played a few different games using this web scores service, we can provide a “transversal” widget contains all scores of a player.</p>
<h4 id="the-same-game-gravity-widget">The Same Game Gravity Widget</h4>
<p>Same Game Gravity use its own widget (<a href="http://same.greweb.fr/public/javascripts/same.scores.js">source code here</a>).</p>
<p>This widget is very customizable. Here’s an example of the code used to embed the widget anywhere (like in this blog post) :</p>
<pre><code class="language-html">&lt;script type=&quot;text/javascript&quot; src=&quot;http://same.greweb.fr/public/javascripts/same.scores.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
  new same.Scores({
    width: &#39;250px&#39;,
    height: &#39;400px&#39;,
    items: 3,
    period: &#39;all&#39;,
    platform: [&#39;web&#39;, &#39;mobile&#39;, &#39;tablet&#39;],
    type: [&#39;hs_hard&#39;, &#39;hs_normal&#39;, &#39;hs_easy&#39;],
    title: &#39;Best highscores ever&#39;,
    theme: {
      bg: &#39;rgb(218, 236, 244)&#39;,
      color: &#39;#000&#39;,
      scores_bg: &#39;rgba(255, 255, 255, 0.5)&#39;,
      scores_color: &#39;rgba(0, 0, 0, 0.8)&#39;,
      link: &#39;#1F98C7&#39;
    }
  }).init().fetch();
&lt;/script&gt;
</code></pre>
<h3 id="conclusion">Conclusion</h3>
<p>And here we are! 6 months to develop a game and release it on different platforms! I learn a lot about mobile development and I’m now more capable to develop other games.<br>I learned that you should avoid using Canvas if you can use DOM instead because performance are bad on some mobile device whereas CSS Transitions / Animations are hardware accelerated.</p>
<p>Finally, I learned that game development is not only about programming! The marketing and the graphical parts are so important too.</p>
<p>Want to checkout the code or contribute to the game i18n? Just fork the <a href="https://github.com/gre/same-game-gravity">game repository</a>.</p>
<h4 id="thanks">Thanks</h4>
<p>Big thanks to all game testers. Friends and colleagues, thank you very much!<br>Special thanks to @mrspeaker for English help !</p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/logo.svg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">As a generative plotter artist, I use code to create art (creative coding), draw with fountain pens on robots (plotting), and explore the boundaries of abstract art using algorithms in pursuit of increasingly realistic imagery. I do not produce prints; instead, I create unique &#x27;plots&#x27; - physical works of art that are truly one-of-a-kind.</div><div class="jsx-2519965637 social"><a href="https://discord.gg/DQBajxzn" class="jsx-2519965637"><img alt="" src="/icons/discord.svg" class="jsx-2519965637"/></a><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://opensea.io/greweb?tab=created" class="jsx-2519965637"><img alt="" src="/icons/eth.svg" class="jsx-2519965637"/></a><a href="https://fxhash.xyz/u/greweb" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2011-07-12-same-game-gravity-technical-notes","year":"2011","month":"07","day":"12","slug":"same-game-gravity-technical-notes","content":"\u003cp\u003esee also \u003ca href=\"/2011/07/same-game-gravity-for-ipad-iphone-android-facebook-chrome-and-web/\"\u003eSame Game Gravity presentation\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e2 years ago, I started to developed the \u003ca href=\"http://gre.github.io/same-game-gravity\"\u003eSame Game\u003c/a\u003e as an HTML Canvas experiment. I’ve enjoyed developing this game, mostly because playing with HTML5 Canvas is so easy. Recently I’ve seen a nice increase in the user base (now around 250 visitors a day) – despite it being perhaps the simplest games I’ve ever developed. Simplicity is good, but my increase in users is thanks to the power of HTML5: The Same Game is available for 6 different platforms. And I can pump out new builds for them all in around 15 minutes. Here’s how…\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eIt’s often the simplest games which work. Too much complexity is not good.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://gre.github.io/same-game-gravity\"\u003e\u003cbr\u003e\u003cimg src=\"/images/2011/07/gravity_exemple.png\" alt=\"\"\u003e\n\u003c/a\u003e\u003c/p\u003e\n\u003c!--more--\u003e\n\n\u003cp\u003eIn 2010, I learned how to make mobile web applications. It was also the year of the iPad. Out of interest I tried my same game canvas experiment on the iPad, and was surprised to find that it worked pretty well out of the box! Seeing it run on multiple devices was exciting – and the touch screens offered a new dimension for creating highly intuitive interactions. I mean, today, \u003cstrong\u003eeven my mum can play Same Game Gravity without any help!\u003c/strong\u003e (That’s unfortunately not the case for her desktop)\u003c/p\u003e\n\u003cp\u003eThat’s why I wanted to make Same Game for mobile. I started out developing and testing it as an Android application – because I have an Android phone. I created my own micro framework with some MVC concept (views, controllers, a router, etc.). The goal was to create \u003cstrong\u003ea simple and light web app that look like a native application\u003c/strong\u003e. For views? Portions of HTML. For transitions between views? CSS transitions. Supporting the “back” button of Android devices as a native application? I played with the hash (onhashchange event). \u003c/p\u003e\n\u003cp\u003eIn short, the web is wide and worldly enough to do pretty much everything you want with…\u003c/p\u003e\n\u003cp\u003eSo I implemented the Same Game on Android. But (naturally) the game already existed on Android! I had to find something new! I was itching to fully exploit the possibilities of a new technology. Mobile has great potential – so it would be bad not to make use of new APIs. I discovered \u003cstrong\u003ethe Accelerometer\u003c/strong\u003e. My idea was gravity: change the balls position by rotating the device.\u003c/p\u003e\n\u003cp\u003eBut, many of my friends don’t have Android phones!\u003c/p\u003e\n\u003cp\u003eThe Same Game Gravity is now available for iPad, iPhone, Android, Facebook, Chrome Store and desktop browsers. That’s a lot of platforms, with a lot of APIs to learn – and potentially a LOT of work in maintenance. But thankfully I didn’t have to go off learning Objective-C and Java Android, or keep track of arm-fulls of repositories! All the platforms are supported from \u003cstrong\u003ea single codebase\u003c/strong\u003e: thanks to the power and awesomeness of JavaScript, HTML, and CSS – combined with a nifty tool I developed \u003ca href=\"/2011/06/automating-web-app-development-for-multiple-platforms/\"\u003eWebAppBuilder\u003c/a\u003e to easily build each instance.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eI added a cool scoring system that spreads via multiple social networks simultaneously and easily – and now I have a truly cross-platform game!\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"the-code\"\u003eThe code\u003c/h3\u003e\n\u003cp\u003eDesktop version source code is available on \u003ca href=\"https://github.com/gre/same-game-gravity\"\u003eGithub\u003c/a\u003e.\u003c/p\u003e\n\u003ch4 id=\"the-html\"\u003eThe HTML\u003c/h4\u003e\n\u003cp\u003e(see \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.html\"\u003egame.html\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eThe HTML code is pretty simple.\u003cbr\u003eBasically, there is a \u003cstrong\u003econtainer which contains different\u003c/strong\u003e. Each section is a view of the game.\u003c/p\u003e\n\u003cp\u003eFor instance here is the game view :  \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;section id=\u0026quot;game\u0026quot;\u0026gt;\n  \u0026lt;div class=\u0026quot;turnleft\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;\n  \u0026lt;div class=\u0026quot;turnright\u0026quot;\u0026gt;\u0026lt;/div\u0026gt;\n  \u0026lt;div class=\u0026quot;gameStatus\u0026quot;\u0026gt;\n    \u0026lt;a class=\u0026quot;i18n-back back\u0026quot; href=\u0026quot;#!/\u0026quot;\u0026gt;Back\u0026lt;/a\u0026gt;\n    \u0026lt;span class=\u0026quot;timeline\u0026quot;\u0026gt;\n      \u0026lt;span class=\u0026quot;remainingSeconds\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;remainingSecondsTime\u0026quot;\u0026gt;\u0026lt;/span\u0026gt; s\u0026lt;/span\u0026gt;\n    \u0026lt;/span\u0026gt;\n  \u0026lt;/div\u0026gt;\n  \u0026lt;div id=\u0026quot;gameContainer\u0026quot;\u0026gt;\n    \u0026lt;canvas class=\u0026quot;highlight\u0026quot; width=\u0026quot;400\u0026quot; height=\u0026quot;300\u0026quot;\u0026gt;\u0026lt;/canvas\u0026gt;\n    \u0026lt;canvas class=\u0026quot;main\u0026quot; width=\u0026quot;400\u0026quot; height=\u0026quot;300\u0026quot;\u0026gt;\u0026lt;/canvas\u0026gt;\n  \u0026lt;/div\u0026gt;\n\u0026lt;/section\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the desktop version, \u003cstrong\u003egame.html\u003c/strong\u003e is wrapped into \u003cstrong\u003eindex.html\u003c/strong\u003e in an iframe to keep the game independent of the context.\u003c/p\u003e\n\u003ch4 id=\"the-css\"\u003eThe CSS\u003c/h4\u003e\n\u003cp\u003e(see \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.css\"\u003egame.css\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eCSS 3 is very rich.\u003c/p\u003e\n\u003cp\u003eCSS Transitions and CSS Transforms has been used to do view change.  \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-css\"\u003e/* Pre conditions :\n * With Javascript: \n   - A class \u0026quot;current\u0026quot; is setted for the current section view. \n   - All section after \u0026quot;current\u0026quot; must take a \u0026quot;after\u0026quot; class. \n */\n#main.enabletransition \u0026gt; section { /* #main must take \u0026quot;enabletransition\u0026quot; after the DOM load to avoid a first transition */\n  transition-duration: 1s, 0s;  /* transform takes 1s duration, opacity doesn\u0026#39;t have transition */\n}\n#main \u0026gt; section {\n  z-index: -1;\n  opacity: 0;\n  transition-delay: 0s, 1s; /* opacity go to 0 in 1s */\n  transition-property: transform, opacity;\n  transform: translateY(-100%); /* go above the page */\n}\n#main \u0026gt; section.current {\n  z-index: 0;\n  opacity: 1;\n  transition-delay: 0s, 0s;\n  transition-transform: translateY(0%); /* go to the bottom */\n}\n#main \u0026gt; section.after { /* same as \u0026quot;#main \u0026gt; section.current ~ section\u0026quot; but without bugs */\n  opacity: 0;\n  transition-delay: 0s, 1s;\n  transform: translateY(100%); /* go below the page */\n}\n \n/* Note that this is a part of the css code \n * (you need to add -webkit-, -moz-, ... in some properties)\n */\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"the-game-core\"\u003eThe game core\u003c/h4\u003e\n\u003cp\u003e(see \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.js\"\u003egame.js\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eCode is organized in different javascript “classes”.\u003c/p\u003e\n\u003cp\u003eThe main components are :\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e  \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.js#L324\"\u003egame.Grid\u003c/a\u003e contains all the algorithm of the game.\u003c/li\u003e\n\u003cli\u003e  \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.js#L687\"\u003egame.GameCanvasRenderer\u003c/a\u003e is a game renderer (graphic part of the game) based on HTML Canvas element. It contains different functions called by \u003cstrong\u003egame.Game\u003c/strong\u003e.\u003c/li\u003e\n\u003cli\u003e  \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.js#L850\"\u003egame.Game\u003c/a\u003e contains all the game logic, the game loop and bind DOM events (touch, click, …).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"gamedesktopjs-a-game-instance-for-the-desktop\"\u003egame.desktop.js: a game instance for the desktop\u003c/h4\u003e\n\u003cp\u003e(see \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.desktop.js\"\u003egame.desktop.js\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eThis file contains all the specific code for the desktop version (it overrides existing classes). But it mainly contains the \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.desktop.js#L137\"\u003egame controller\u003c/a\u003e handling different views and using all game classes.\u003c/p\u003e\n\u003ch5 id=\"some-significant-code\"\u003eSome significant code\u003c/h5\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// Colors.get(nb) : pick nb random colors \nvar Colors = function() {\n  var clrs = [ new Color(\u0026#39;#D34040\u0026#39;), new Color(\u0026#39;#82D340\u0026#39;), new Color(\u0026#39;#40C2D3\u0026#39;), new Color(\u0026#39;#8B40D3\u0026#39;), new Color(\u0026#39;#D3C840\u0026#39;) ];\n  return {\n      get: function(nb) {\n      return clrs\n      .sort(function(){ return Math.random() - 0.5; })\n      .slice(0, nb);\n    }\n  }\n}();\n \n/** Game instanciation **/\n \nvar gridSizeByDifficulty = [ // Size of grid for each difficulty\n  {w:8, h:8},\n  {w:12, h: 12},\n  {w: 16, h: 16}\n];\nvar colorNumberByDifficulty = [3, 4, 5]; // Nb of colors for each difficulty\n \nvar difficulty; // can be 0 (easy), 1 (normal) or 2 (hard)\ncurrentGame = new game.Game({\n  gridSize: gridSizeByDifficulty[difficulty],\n  colors: colors=Colors.get(colorNumberByDifficulty[difficulty]),\n  container: \u0026#39;#game\u0026#39;, // container selector\n  rendererClass: \u0026#39;GameCanvasRenderer\u0026#39;, // The class to use for rendering the game\n  difficulty: difficulty,\n  drawHover: true,\n  globalTimer: new Timer().pause(),\n  keepSquare: true // Keep a square ratio\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"the-gravity\"\u003eThe gravity\u003c/h3\u003e\n\u003cp\u003eThe game gravity was maybe the hardest part of the game development. \u003c/p\u003e\n\u003ch4 id=\"using-device-accelerometer-for-mobiletablet-version\"\u003eUsing device Accelerometer for mobile/tablet version\u003c/h4\u003e\n\u003cp\u003eI needed to find ways to access to the device accelerometer. For Android I used \u003ca href=\"http://docs.phonegap.com/phonegap_accelerometer_accelerometer.md.html\"\u003ePhoneGap Accelerometer\u003c/a\u003e. But on iPhone I wasn’t able to get PhoneGap’s accelerometer.getCurrentAcceleration to work properly, so I used DeviceMotion event supported by iOS 4.2 . (see \u003ca href=\"http://dev.w3.org/geo/api/spec-source-orientation.html\"\u003eDeviceOrientation spec\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003e(A big thanks to \u003ca href=\"http://twitter.com/42loops\"\u003e@42loops\u003c/a\u003e for that: \u003ca href=\"https://github.com/peutetre/test-mobile-safari/blob/master/devicemotionevent.html\"\u003edevicemotionevent.html\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2011/07/c-rotation.png\" alt=\"Device orientation schema\"\u003e\u003c/p\u003e\n\u003ch4 id=\"css-transforms-and-transitions-for-the-desktop-version\"\u003eCSS Transforms and Transitions for the desktop version\u003c/h4\u003e\n\u003cp\u003eComputers don’t have an Accelerometer. \u003cem\u003eExcept maybe some macbook but I’m not sure people would like to turn macbook in 360°!\u003c/em\u003e but the gravity concept is crucial to the game. I ended up implementing “gravity” via the arrow keys.\u003cbr\u003eThe game is entirely rotated with \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/game.desktop.js#L31\"\u003eCSS Transforms\u003c/a\u003e and animated with \u003ca href=\"https://github.com/gre/same-game-gravity/blob/master/index.css#L35\"\u003eCSS Transitions\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"the-score-system\"\u003eThe score system\u003c/h3\u003e\n\u003cp\u003eI’ve written a web service with \u003ca href=\"http://playframework.org/\"\u003ePlay! framework\u003c/a\u003e to receive scores or retrieve them from Twitter, validate them and spread them with a json API and widgets.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2011/07/same_game_gravity_schema.jpg\" alt=\"tweet example\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThis web service will be available soon for game developers.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe power of this web service is the usage of \u003cstrong\u003esocial networks\u003c/strong\u003e. It will retrieve peoples names, avatars, and their social links without needing to prompt the user.\u003cbr\u003eFor game developers, social scores sharing is a nice way of \u003cstrong\u003eadvertising your game\u003c/strong\u003e: someone shares his scores to his friends: so your game can spread virally.\u003c/p\u003e\n\u003cp\u003eSee that little hash “$4f005″? That’s a way to check if sent scores are valid.\u003cbr\u003eIn fact the web service allows you to handle your own security, via your own “twitter to scores” transformer. You can add a small Javascript function that is executed by the server when transforming a twit to scores – to ensure there hasn’t been any cheating.\u003c/p\u003e\n\u003cp\u003eThe web service also provides \u003cstrong\u003egeneric widgets\u003c/strong\u003e to easily embed game scores in websites.\u003cbr\u003eIf a player has played a few different games using this web scores service, we can provide a “transversal” widget contains all scores of a player.\u003c/p\u003e\n\u003ch4 id=\"the-same-game-gravity-widget\"\u003eThe Same Game Gravity Widget\u003c/h4\u003e\n\u003cp\u003eSame Game Gravity use its own widget (\u003ca href=\"http://same.greweb.fr/public/javascripts/same.scores.js\"\u003esource code here\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eThis widget is very customizable. Here’s an example of the code used to embed the widget anywhere (like in this blog post) :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;script type=\u0026quot;text/javascript\u0026quot; src=\u0026quot;http://same.greweb.fr/public/javascripts/same.scores.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt;\n\u0026lt;script type=\u0026quot;text/javascript\u0026quot;\u0026gt;\n  new same.Scores({\n    width: \u0026#39;250px\u0026#39;,\n    height: \u0026#39;400px\u0026#39;,\n    items: 3,\n    period: \u0026#39;all\u0026#39;,\n    platform: [\u0026#39;web\u0026#39;, \u0026#39;mobile\u0026#39;, \u0026#39;tablet\u0026#39;],\n    type: [\u0026#39;hs_hard\u0026#39;, \u0026#39;hs_normal\u0026#39;, \u0026#39;hs_easy\u0026#39;],\n    title: \u0026#39;Best highscores ever\u0026#39;,\n    theme: {\n      bg: \u0026#39;rgb(218, 236, 244)\u0026#39;,\n      color: \u0026#39;#000\u0026#39;,\n      scores_bg: \u0026#39;rgba(255, 255, 255, 0.5)\u0026#39;,\n      scores_color: \u0026#39;rgba(0, 0, 0, 0.8)\u0026#39;,\n      link: \u0026#39;#1F98C7\u0026#39;\n    }\n  }).init().fetch();\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\u003cp\u003eAnd here we are! 6 months to develop a game and release it on different platforms! I learn a lot about mobile development and I’m now more capable to develop other games.\u003cbr\u003eI learned that you should avoid using Canvas if you can use DOM instead because performance are bad on some mobile device whereas CSS Transitions / Animations are hardware accelerated.\u003c/p\u003e\n\u003cp\u003eFinally, I learned that game development is not only about programming! The marketing and the graphical parts are so important too.\u003c/p\u003e\n\u003cp\u003eWant to checkout the code or contribute to the game i18n? Just fork the \u003ca href=\"https://github.com/gre/same-game-gravity\"\u003egame repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch4 id=\"thanks\"\u003eThanks\u003c/h4\u003e\n\u003cp\u003eBig thanks to all game testers. Friends and colleagues, thank you very much!\u003cbr\u003eSpecial thanks to @mrspeaker for English help !\u003c/p\u003e\n","data":{"title":"Same Game Gravity: 6 platforms, 1 codebase","thumbnail":"/images/2011/07/gravity_exemple.png","description":"The Same Game is available for 6 different platforms. And I can pump out new builds for them all in around 15 minutes. Here’s how…","author":"Gaetan","layout":"post","permalink":"/2011/07/same-game-gravity-technical-notes/","tags":["mobile","gamedev","canvas"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2011","month":"07","slug":"same-game-gravity-technical-notes"},"buildId":"kwag29-p4zBWeIUk2JJqu","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>