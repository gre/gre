<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="Gaëtan Renaudeau"/><meta name="description" content="Panzer Dragoon 1k is a 2D remake of Panzer Dragoon in 1k of JavaScript I made for JS1K 2014"/><meta name="keywords" content="gamedev, js1k, javascript, canvas"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@greweb"/><meta name="twitter:title" content="Panzer Dragoon 1k"/><meta name="og:title" content="Panzer Dragoon 1k"/><meta name="twitter:description" content="Panzer Dragoon 1k is a 2D remake of Panzer Dragoon in 1k of JavaScript I made for JS1K 2014"/><meta name="twitter:creator" content="@greweb"/><meta name="og:image" content="http://greweb.me//images/2014/03/js1k.png"/><meta name="twitter:image" content="http://greweb.me//images/2014/03/js1k.png"/><link rel="image_src" href="http://greweb.me//images/2014/03/js1k.png"/><title>@greweb - Panzer Dragoon 1k</title><link href="http://fonts.googleapis.com/css?family=Fredericka+the+Great|Arapey|Roboto:400,700,400italic" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/styles/default.min.css"/><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/highlight.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/javascript.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/cpp.min.js"></script><script src="https://unpkg.com/@highlightjs/cdn-assets@10.7.2/languages/glsl.min.js"></script><link rel="stylesheet" href="/style/main.css"/><meta name="next-head-count" content="25"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-11911496995bbdbf52b1.js" defer=""></script><script src="/_next/static/chunks/framework-c93ed74a065331c4bd75.js" defer=""></script><script src="/_next/static/chunks/main-005750ed97c879f2d59b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-092526a60f8cb7d1b3d6.js" defer=""></script><script src="/_next/static/chunks/988-83f401159b53b3fa4628.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D-098b94d3fea72f3bf0b3.js" defer=""></script><script src="/_next/static/F2yQ5leE89DP0W3PbwaMO/_buildManifest.js" defer=""></script><script src="/_next/static/F2yQ5leE89DP0W3PbwaMO/_ssgManifest.js" defer=""></script><style id="__jsx-2519965637">.block.jsx-2519965637{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.block.jsx-2519965637 .right.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637{margin-top:10px;}.block.jsx-2519965637 .social.jsx-2519965637 a.jsx-2519965637{padding:10px;}.block.jsx-2519965637 .social.jsx-2519965637 img.jsx-2519965637{height:20px;}</style><style id="__jsx-3621368397">.container.jsx-3621368397{min-height:100vh;padding:0 0.5rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style id="__jsx-3469673304">html,body{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto, Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue, sans-serif;}*{box-sizing:border-box;}a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:active{-webkit-text-decoration:underline;text-decoration:underline;}</style></head><body><div id="__next"><div class="jsx-3621368397 container"><div id="container"><div id="main"><div id="content"><article><header><h1><a href="/">Panzer Dragoon 1k</a></h1><time class="date" dateTime="2014-03-12">2014-03-12</time><span class="tags"><a class="tag">gamedev</a><a class="tag">js1k</a><a class="tag">javascript</a><a class="tag">canvas</a></span></header><div class="entry-content"><p><a href="http://js1k.com/2014-dragons/demo/1790"><img src="/images/2014/03/js1k.png" alt="" class="thumbnail-left" /></a></p>
<p>This article introduces my journey into the JS1K world
and a few tricks I&#39;ve used for my entry <a href="http://js1k.com/2014-dragons/demo/1790">&quot;Panzer Dragoon 1k&quot;</a> (<a href="https://gist.github.com/gre/9504494">source</a>).</p>
<p>Welcome to the world of hacks, tricks and getting-things-done-at-any-price.
You will turn the worst JavaScript practices and ugliest JavaScript facts to your advantage.
Welcome to the world where coding the bad way is satisfying!</p>
<h2 id="panzer-dragoon-1k">Panzer Dragoon 1k</h2>
<ul>
<li><strong><a href="http://js1k.com/2014-dragons/demo/1790">Play the JS1K entry</a></strong></li>
<li><a href="https://gist.github.com/gre/9504494">Source Code</a></li>
</ul>
<h2 id="panzer-dragoon-original-game">Panzer Dragoon Original Game</h2>
<iframe width="640" height="480" src="//www.youtube.com/embed/peoRBj9U-jI" frameborder="0" allowfullscreen></iframe>

<!--more-->

<h1 id="js1k">JS1K</h1>
<p><strong><a href="http://js1k.com/">JS1K</a></strong> is a competition where you have to make a demo (or a game, or anything)
in less than <strong>1 kilobytes</strong> of JavaScript: <strong>less than 1024 characters of source code</strong>.</p>
<p>To reach that goal you will need ideas, JS ninja tricks 
and most important: <strong>patience and perseverance</strong>!
But really, <strong>anyone can participate</strong>.</p>
<p>I recommend that you take a look at <a href="http://js1k.com/">js1k.com</a> and browse the existing entries.
There is awesome guys participating to this yearly event,
I had the chance to meet some of them at <a href="http://demojs.org/">DemoJS 2013</a> Paris event.
Also checkout <a href="http://www.p01.org/">www.p01.org</a> which contains some very good examples of crazy short demos.</p>
<h2 id="tools">Tools</h2>
<p>But first things first: you need tools to minimize source code (it can simply be removing comments and spaces, minifiers, or it can be much more crazy tools like crushers).</p>
<p>Personally, I&#39;m using:</p>
<pre><code class="language-bash">cat source.js | uglifyjs -c unused=false | tee minified.js | jscrush &gt; crushed.js &amp;&amp; wc -c *.js
</code></pre>
<p>This small homemade command (to use in a npm script) results for my game in:</p>
<pre><code>    1019 crushed.js
    1756 minified.js
    7241 source.js
</code></pre>
<p>If you are interested, I&#39;ve made this toolkit available in a complete boilerplate 
that you can easily fork for your own usage: 
<a href="https://gist.github.com/gre/9364718">https://gist.github.com/gre/9364718</a>.</p>
<blockquote>
<p><strong>P.S.</strong> <a href="https://github.com/gre/jscrush/"><code>jscrush</code></a> is a npm module that you can directly use from the CLI 
but it is a port of the awesome <a href="http://www.iteral.com/jscrush/">www.iteral.com/jscrush/</a>.</p>
</blockquote>
<h1 id="the-beginning-saving-bytes">The beginning: Saving bytes</h1>
<p>It quickly becomes frustrating to compete in JS1K
because you are basically trying to put a cow in a car (or an elephant if you are ambitious!).
But this frustration actually becomes addictive!</p>
<p><strong>Saving bytes</strong> is your job - once you get your first working prototype, and inevitably blow your byte limit.</p>
<p>When you reach that limit, a good idea is to practice an <strong>&quot;add feature -&gt; remove code&quot;</strong> development loop 
that really makes you think hard about your ultimate goal, and helps improve your entry.</p>
<blockquote>
<p><strong>The JS1K-based development:</strong>
Adding more and more features,
figuring out how to fill everything in,
re-thinking your demo to only keep the essential features.
This will keep making your demo better.</p>
</blockquote>
<p>You have to make a very hard choice: <em><strong>Which feature to remove?</strong></em>
It is all about budget, not in term of money but in term of bytes!
A bit like in daily life: making choices with limited resources!</p>
<h2 id="jscrush">JSCrush</h2>
<p><em><strong>JSCrush</strong></em> is a crazy tool you may want to use to go deeper in the bytes reducing.</p>
<p>It basically implements a compression algorithm which is based on substring occurences.
The challenge of such a tool is not only to make a good compression but to make 
a very small decompressor embedded in the result code because 
this decompressor might be an overhead <em>(~ +60 bytes with small code)</em>.</p>
<p>If you are using <em>JSCrush</em> which I recommend for saving extra bytes,
you may want to use some tricks to go even further with it!</p>
<p>The first time, you usually can save about 20% of bytes with classic 1k minified code.
But if you optimize your code <strong>for</strong> <em>JSCrush</em>, you can save much more!
I&#39;ve achieved about a 40% code reduction in my demo!</p>
<p>Most of the tricks is about finding code patterns (same succession of JavaScript source code characters) 
and trying to duplicate them.</p>
<p>When I say <strong>duplicating code</strong>, it is really about <strong>DUPLICATING code!</strong></p>
<blockquote>
<p>Once &quot;indexed&quot;, a duplicated code is likely to just take one more byte in the final crushed JavaScript!</p>
</blockquote>
<h1 id="some-tips-and-tricks">Some tips and tricks</h1>
<p><a href="http://js1k.com/2014-dragons/demo/1790"><img src="/images/2014/03/js1k_2.png" alt="" class="thumbnail-right" /></a></p>
<p>This section will share with you a non-exhaustive list of tricks.
I&#39;m not going to talk so much about the basic and classic ones, 
but a few novel ones that I found to work well in my entry.
You may prefer to directly read the <a href="https://gist.github.com/gre/9504494">annotated source code of &quot;Panzer Dragoon 1K&quot;</a> instead!
Of course, most of those tricks work closely with the <code>| minify | jscrush</code> transformation.</p>
<blockquote>
<p>Careful! Some tricks might be counter-intuitive as first glance, 
again it ties-in with the way JSCrush is working.</p>
</blockquote>
<h2 id="reduce-your-language">Reduce your language</h2>
<p>All existing functions and properties are costly in bytes,
each time you use another one, it definitely add bytes.
To save bytes, you have to limit your set of functions/properties to use
or find ways to access them indirectly.</p>
<ul>
<li><strong>Use as few variables as you can</strong>: this is valid in computer science in general: the best systems are those with the fewest possible variables (states). if one variable can be computed out of others, it should be removed. Also consider allocating some temporary variables to re-use like in an assembly registry (e.g. <code>i</code>, <code>j</code>).</li>
<li><strong>Reduce the set of functions</strong> you authorize yourself to use! You may just need to use &quot;fillRect&quot; for everything, or &quot;arc&quot;. Also don&#39;t use both <code>Math.min</code> and <code>Math.max</code>, one can be implemented with the other.</li>
<li><strong>Minimize the different values / colors</strong> you are using (most of the time digits are fine, but <code>#RGB</code> colors are costy).</li>
</ul>
<h2 id="duplicated-wins">Duplicated wins!</h2>
<ul>
<li><p>Generally: try to <strong>duplicate the exact same code everywhere</strong>!</p>
</li>
<li><p><strong>Do not use explicit aliasing</strong> like <code>M=Math</code> and <code>C=M.cos</code>, JSCrush does that job for you.</p>
</li>
<li><p><strong>Get rid of intermediary computation.</strong> Prefer inline and duplicated computation over variable assigment.</p>
</li>
<li><p>Also, <code>a*(b+c)</code> might be more bytes than <code>a*b+a*c</code> if <code>a</code> is an expression. (but doesn&#39;t work in all cases)</p>
</li>
</ul>
<p><strong>A few examples:</strong></p>
<pre><code class="language-javascript">a = b+c; translate(a, a); // NOPE!
translate(b+c, b+c); // YES!
</code></pre>
<pre><code class="language-javascript">size = a+b+10; fillRect(x-size, y-size, 2*size, 2*size); // no please don&#39;t!
fillRect(x-(a+b+10), y-(a+b+10), 2*(a+b+10), 2*(a+b+10)); // YEAH!
</code></pre>
<pre><code class="language-javascript">fillRect(10,10,20,20);
...
fillRect(9,9,18,18); // Can you afford to use 10,10,20,20 instead?
</code></pre>
<p>In my demo, I was able to factorize some code. For instance the way I draw and update the x,y of my opponents and particles are the same duplicate chunk of code:</p>
<pre><code class="language-javascript">    bga();
    arc(
      // Update
      e[0] += e[3],
      e[1] += e[4],
      e[2],
      0, 9);
    fl();
</code></pre>
<ul>
<li>You sometimes can <strong>save bytes by adding more code</strong>! For instance, if you need <code>fillStyle</code> and <code>strokeStyle</code>, it may save bytes to always set both color at the same time! <code>fillStyle = strokeStyle = ...</code> even if you only need once.</li>
<li>Always <strong>use the same <code>function parameters</code></strong>. In my game, I use <code>function(e){</code> everywhere even if I don&#39;t use that <code>e</code> in all my functions. This is saving a bunch of bytes with JSCrush.</li>
<li><strong>Here&#39;s a particularly crazy trick:</strong> If you have different collections of complex objects, you can simply represent each item by a vector (an array) and figure out how you can make use the same indexes for the use-case.</li>
</ul>
<p>In my game:</p>
<pre><code class="language-javascript">o = []; // an opponent: [ 0: x, 1: y, 2: health, 3: vx, 4: vy, 5: locked, 6: hitTime ]
p = []; // a particule: [ 0: x, 1: y, 2: size,   3: vx, 4: vy, 5: damage ]
</code></pre>
<ul>
<li>You also may find better way of managing collections. Instead of using <code>t.push(o)</code> to add, <code>t.splice(i, 1)</code> to remove, and <code>for(i=0;e=o[i];i++){...}</code> to iterate. I am using <code>t[Math.random()]=o</code> to add, <code>delete t[i]</code> to remove and <code>for(i in o){ e=o[i]; ... }</code> to iterate. It saved a lot of bytes if you already use <code>Math.random()</code> somewhere else! For-in loops are also quite short and can by used for other tricks (e.g. <em>Programmatical aliasing</em>).</li>
</ul>
<blockquote class="twitter-tweet" lang="fr"><p>My <a href="https://twitter.com/search?q=%23js1k&amp;src=hash">#js1k</a> uses `t[Math.random()]=insert`, for-in loops and `delete t[i]` rather than push and splice. Saving bytes with jscrush</p>&mdash; Gaëtan Renaudeau (@greweb) <a href="https://twitter.com/greweb/statuses/439324052403277824">28 Février 2014</a></blockquote>


<ul>
<li>Use just <strong>one letter variable names</strong> (mangling variables won&#39;t work because they are in window scope, and IMHO it is better for you to write them by hand)</li>
<li>You will probably need to <strong>initialize some variables</strong>, but do it only if necessary (if you have <code>ReferenceError</code>) and <strong>use the multi-assignment syntax</strong>: <code>A = B = 0</code> if you can. You should never have constant variables, it saves bytes to directly use the value inline.</li>
<li><strong><code>with(c){ ... }</code></strong> in your main loop may save bytes. It makes all functions and properties of c (the drawing context) in the scope.</li>
</ul>
<h2 id="language-tricks">Language tricks</h2>
<ul>
<li><strong>Never use <code>var</code></strong>, just put everything in <code>window</code></li>
<li><strong>Programmatically aliasing <code>c</code>&#39;s method</strong> may save you a lot of bytes (or may not, you have to check!). You also have to find the code which suit the best your use case. Be careful about collision. Here is mine: <code>for (e in c) c[e[0]+e[2]+(e[6]||&quot;&quot;)] = c[e];</code></li>
<li>Do not waste ANY value returned by assignment and operators (i++, x=.., x+=...). I&#39;m sure you can do it somewhere else!
Typical example:</li>
</ul>
<pre><code class="language-javascript">x += vx; y += vy; /* ... */ fillRect(x, y, s, s); // NOPE!
/* ... */ fillRect(x += vx, y += vy, s, s); // YES!
</code></pre>
<ul>
<li>Try to not separate update from drawing logic. Mixing them may save bytes.</li>
<li>You don&#39;t want to use <code>addEventListener</code>, just define listeners straight on window! e.g. <code>onclick = function(){...</code></li>
</ul>
<h2 id="make-your-js1k-now">Make your JS1K now!</h2>
<p><a href="http://js1k.com/2014-dragons/demo/1790"><img src="/images/2014/03/js1k_3.png" alt="" class="thumbnail-left" /></a></p>
<p>I&#39;m really eager to see all JS1K entries 
because I usually enjoy reading people&#39;s code and 
especially all the crazy tricks that I can learn from your code :-)</p>
<p>This article was just sharing a bunch of tricks which work for my entry,
but you will find much better tricks for your demo -
so please do it and make your crazy work!</p>
<hr>
<p><em>Special thanks to <a href="http://twitter.com/mrspeaker">@mrspeaker</a> for fixing my English</em>.</p>
</div><footer><div class="jsx-2519965637 block"><img src="http://greweb.me/logo.svg" width="100" class="jsx-2519965637"/><div class="jsx-2519965637 right"><div class="jsx-2519965637 description">generative artist. doodling with algorithms (creative coding). shaders &amp; fountain pens robot plotting.</div><div class="jsx-2519965637 social"><a href="https://twitter.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitter.svg" class="jsx-2519965637"/></a><a href="https://instagram.com/greweb" class="jsx-2519965637"><img alt="" src="/icons/instagram.svg" class="jsx-2519965637"/></a><a href="https://twitch.tv/greweb" class="jsx-2519965637"><img alt="" src="/icons/twitch.svg" class="jsx-2519965637"/></a><a href="https://github.com/gre" class="jsx-2519965637"><img alt="" src="/icons/github.svg" class="jsx-2519965637"/></a><a href="https://opensea.io/greweb" class="jsx-2519965637"><img alt="" src="/icons/eth.svg" class="jsx-2519965637"/></a><a href="https://objkt.com/profile/tz1cgQAQfECg5bPASYTMyJ9QJQjSUi8rfL67" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://fxhash.xyz/u/greweb" class="jsx-2519965637"><img alt="" src="/icons/tz.svg" class="jsx-2519965637"/></a><a href="https://greweb.itch.io" class="jsx-2519965637"><img alt="" src="/icons/iconmonstr-gamepad-3.svg" class="jsx-2519965637"/></a></div></div></div></footer></article></div></div></div><script>hljs.highlightAll();</script></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"2014-03-12-panzer-dragoon-1k","year":"2014","month":"03","day":"12","slug":"panzer-dragoon-1k","content":"\u003cp\u003e\u003ca href=\"http://js1k.com/2014-dragons/demo/1790\"\u003e\u003cimg src=\"/images/2014/03/js1k.png\" alt=\"\" class=\"thumbnail-left\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis article introduces my journey into the JS1K world\nand a few tricks I\u0026#39;ve used for my entry \u003ca href=\"http://js1k.com/2014-dragons/demo/1790\"\u003e\u0026quot;Panzer Dragoon 1k\u0026quot;\u003c/a\u003e (\u003ca href=\"https://gist.github.com/gre/9504494\"\u003esource\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eWelcome to the world of hacks, tricks and getting-things-done-at-any-price.\nYou will turn the worst JavaScript practices and ugliest JavaScript facts to your advantage.\nWelcome to the world where coding the bad way is satisfying!\u003c/p\u003e\n\u003ch2 id=\"panzer-dragoon-1k\"\u003ePanzer Dragoon 1k\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ca href=\"http://js1k.com/2014-dragons/demo/1790\"\u003ePlay the JS1K entry\u003c/a\u003e\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://gist.github.com/gre/9504494\"\u003eSource Code\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"panzer-dragoon-original-game\"\u003ePanzer Dragoon Original Game\u003c/h2\u003e\n\u003ciframe width=\"640\" height=\"480\" src=\"//www.youtube.com/embed/peoRBj9U-jI\" frameborder=\"0\" allowfullscreen\u003e\u003c/iframe\u003e\n\n\u003c!--more--\u003e\n\n\u003ch1 id=\"js1k\"\u003eJS1K\u003c/h1\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"http://js1k.com/\"\u003eJS1K\u003c/a\u003e\u003c/strong\u003e is a competition where you have to make a demo (or a game, or anything)\nin less than \u003cstrong\u003e1 kilobytes\u003c/strong\u003e of JavaScript: \u003cstrong\u003eless than 1024 characters of source code\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eTo reach that goal you will need ideas, JS ninja tricks \nand most important: \u003cstrong\u003epatience and perseverance\u003c/strong\u003e!\nBut really, \u003cstrong\u003eanyone can participate\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eI recommend that you take a look at \u003ca href=\"http://js1k.com/\"\u003ejs1k.com\u003c/a\u003e and browse the existing entries.\nThere is awesome guys participating to this yearly event,\nI had the chance to meet some of them at \u003ca href=\"http://demojs.org/\"\u003eDemoJS 2013\u003c/a\u003e Paris event.\nAlso checkout \u003ca href=\"http://www.p01.org/\"\u003ewww.p01.org\u003c/a\u003e which contains some very good examples of crazy short demos.\u003c/p\u003e\n\u003ch2 id=\"tools\"\u003eTools\u003c/h2\u003e\n\u003cp\u003eBut first things first: you need tools to minimize source code (it can simply be removing comments and spaces, minifiers, or it can be much more crazy tools like crushers).\u003c/p\u003e\n\u003cp\u003ePersonally, I\u0026#39;m using:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecat source.js | uglifyjs -c unused=false | tee minified.js | jscrush \u0026gt; crushed.js \u0026amp;\u0026amp; wc -c *.js\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis small homemade command (to use in a npm script) results for my game in:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    1019 crushed.js\n    1756 minified.js\n    7241 source.js\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you are interested, I\u0026#39;ve made this toolkit available in a complete boilerplate \nthat you can easily fork for your own usage: \n\u003ca href=\"https://gist.github.com/gre/9364718\"\u003ehttps://gist.github.com/gre/9364718\u003c/a\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eP.S.\u003c/strong\u003e \u003ca href=\"https://github.com/gre/jscrush/\"\u003e\u003ccode\u003ejscrush\u003c/code\u003e\u003c/a\u003e is a npm module that you can directly use from the CLI \nbut it is a port of the awesome \u003ca href=\"http://www.iteral.com/jscrush/\"\u003ewww.iteral.com/jscrush/\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"the-beginning-saving-bytes\"\u003eThe beginning: Saving bytes\u003c/h1\u003e\n\u003cp\u003eIt quickly becomes frustrating to compete in JS1K\nbecause you are basically trying to put a cow in a car (or an elephant if you are ambitious!).\nBut this frustration actually becomes addictive!\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSaving bytes\u003c/strong\u003e is your job - once you get your first working prototype, and inevitably blow your byte limit.\u003c/p\u003e\n\u003cp\u003eWhen you reach that limit, a good idea is to practice an \u003cstrong\u003e\u0026quot;add feature -\u0026gt; remove code\u0026quot;\u003c/strong\u003e development loop \nthat really makes you think hard about your ultimate goal, and helps improve your entry.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eThe JS1K-based development:\u003c/strong\u003e\nAdding more and more features,\nfiguring out how to fill everything in,\nre-thinking your demo to only keep the essential features.\nThis will keep making your demo better.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eYou have to make a very hard choice: \u003cem\u003e\u003cstrong\u003eWhich feature to remove?\u003c/strong\u003e\u003c/em\u003e\nIt is all about budget, not in term of money but in term of bytes!\nA bit like in daily life: making choices with limited resources!\u003c/p\u003e\n\u003ch2 id=\"jscrush\"\u003eJSCrush\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003e\u003cstrong\u003eJSCrush\u003c/strong\u003e\u003c/em\u003e is a crazy tool you may want to use to go deeper in the bytes reducing.\u003c/p\u003e\n\u003cp\u003eIt basically implements a compression algorithm which is based on substring occurences.\nThe challenge of such a tool is not only to make a good compression but to make \na very small decompressor embedded in the result code because \nthis decompressor might be an overhead \u003cem\u003e(~ +60 bytes with small code)\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eIf you are using \u003cem\u003eJSCrush\u003c/em\u003e which I recommend for saving extra bytes,\nyou may want to use some tricks to go even further with it!\u003c/p\u003e\n\u003cp\u003eThe first time, you usually can save about 20% of bytes with classic 1k minified code.\nBut if you optimize your code \u003cstrong\u003efor\u003c/strong\u003e \u003cem\u003eJSCrush\u003c/em\u003e, you can save much more!\nI\u0026#39;ve achieved about a 40% code reduction in my demo!\u003c/p\u003e\n\u003cp\u003eMost of the tricks is about finding code patterns (same succession of JavaScript source code characters) \nand trying to duplicate them.\u003c/p\u003e\n\u003cp\u003eWhen I say \u003cstrong\u003eduplicating code\u003c/strong\u003e, it is really about \u003cstrong\u003eDUPLICATING code!\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eOnce \u0026quot;indexed\u0026quot;, a duplicated code is likely to just take one more byte in the final crushed JavaScript!\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"some-tips-and-tricks\"\u003eSome tips and tricks\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"http://js1k.com/2014-dragons/demo/1790\"\u003e\u003cimg src=\"/images/2014/03/js1k_2.png\" alt=\"\" class=\"thumbnail-right\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis section will share with you a non-exhaustive list of tricks.\nI\u0026#39;m not going to talk so much about the basic and classic ones, \nbut a few novel ones that I found to work well in my entry.\nYou may prefer to directly read the \u003ca href=\"https://gist.github.com/gre/9504494\"\u003eannotated source code of \u0026quot;Panzer Dragoon 1K\u0026quot;\u003c/a\u003e instead!\nOf course, most of those tricks work closely with the \u003ccode\u003e| minify | jscrush\u003c/code\u003e transformation.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCareful! Some tricks might be counter-intuitive as first glance, \nagain it ties-in with the way JSCrush is working.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"reduce-your-language\"\u003eReduce your language\u003c/h2\u003e\n\u003cp\u003eAll existing functions and properties are costly in bytes,\neach time you use another one, it definitely add bytes.\nTo save bytes, you have to limit your set of functions/properties to use\nor find ways to access them indirectly.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUse as few variables as you can\u003c/strong\u003e: this is valid in computer science in general: the best systems are those with the fewest possible variables (states). if one variable can be computed out of others, it should be removed. Also consider allocating some temporary variables to re-use like in an assembly registry (e.g. \u003ccode\u003ei\u003c/code\u003e, \u003ccode\u003ej\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eReduce the set of functions\u003c/strong\u003e you authorize yourself to use! You may just need to use \u0026quot;fillRect\u0026quot; for everything, or \u0026quot;arc\u0026quot;. Also don\u0026#39;t use both \u003ccode\u003eMath.min\u003c/code\u003e and \u003ccode\u003eMath.max\u003c/code\u003e, one can be implemented with the other.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMinimize the different values / colors\u003c/strong\u003e you are using (most of the time digits are fine, but \u003ccode\u003e#RGB\u003c/code\u003e colors are costy).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"duplicated-wins\"\u003eDuplicated wins!\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eGenerally: try to \u003cstrong\u003eduplicate the exact same code everywhere\u003c/strong\u003e!\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eDo not use explicit aliasing\u003c/strong\u003e like \u003ccode\u003eM=Math\u003c/code\u003e and \u003ccode\u003eC=M.cos\u003c/code\u003e, JSCrush does that job for you.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eGet rid of intermediary computation.\u003c/strong\u003e Prefer inline and duplicated computation over variable assigment.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eAlso, \u003ccode\u003ea*(b+c)\u003c/code\u003e might be more bytes than \u003ccode\u003ea*b+a*c\u003c/code\u003e if \u003ccode\u003ea\u003c/code\u003e is an expression. (but doesn\u0026#39;t work in all cases)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eA few examples:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003ea = b+c; translate(a, a); // NOPE!\ntranslate(b+c, b+c); // YES!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003esize = a+b+10; fillRect(x-size, y-size, 2*size, 2*size); // no please don\u0026#39;t!\nfillRect(x-(a+b+10), y-(a+b+10), 2*(a+b+10), 2*(a+b+10)); // YEAH!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003efillRect(10,10,20,20);\n...\nfillRect(9,9,18,18); // Can you afford to use 10,10,20,20 instead?\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn my demo, I was able to factorize some code. For instance the way I draw and update the x,y of my opponents and particles are the same duplicate chunk of code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e    bga();\n    arc(\n      // Update\n      e[0] += e[3],\n      e[1] += e[4],\n      e[2],\n      0, 9);\n    fl();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eYou sometimes can \u003cstrong\u003esave bytes by adding more code\u003c/strong\u003e! For instance, if you need \u003ccode\u003efillStyle\u003c/code\u003e and \u003ccode\u003estrokeStyle\u003c/code\u003e, it may save bytes to always set both color at the same time! \u003ccode\u003efillStyle = strokeStyle = ...\u003c/code\u003e even if you only need once.\u003c/li\u003e\n\u003cli\u003eAlways \u003cstrong\u003euse the same \u003ccode\u003efunction parameters\u003c/code\u003e\u003c/strong\u003e. In my game, I use \u003ccode\u003efunction(e){\u003c/code\u003e everywhere even if I don\u0026#39;t use that \u003ccode\u003ee\u003c/code\u003e in all my functions. This is saving a bunch of bytes with JSCrush.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHere\u0026#39;s a particularly crazy trick:\u003c/strong\u003e If you have different collections of complex objects, you can simply represent each item by a vector (an array) and figure out how you can make use the same indexes for the use-case.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn my game:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eo = []; // an opponent: [ 0: x, 1: y, 2: health, 3: vx, 4: vy, 5: locked, 6: hitTime ]\np = []; // a particule: [ 0: x, 1: y, 2: size,   3: vx, 4: vy, 5: damage ]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eYou also may find better way of managing collections. Instead of using \u003ccode\u003et.push(o)\u003c/code\u003e to add, \u003ccode\u003et.splice(i, 1)\u003c/code\u003e to remove, and \u003ccode\u003efor(i=0;e=o[i];i++){...}\u003c/code\u003e to iterate. I am using \u003ccode\u003et[Math.random()]=o\u003c/code\u003e to add, \u003ccode\u003edelete t[i]\u003c/code\u003e to remove and \u003ccode\u003efor(i in o){ e=o[i]; ... }\u003c/code\u003e to iterate. It saved a lot of bytes if you already use \u003ccode\u003eMath.random()\u003c/code\u003e somewhere else! For-in loops are also quite short and can by used for other tricks (e.g. \u003cem\u003eProgrammatical aliasing\u003c/em\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote class=\"twitter-tweet\" lang=\"fr\"\u003e\u003cp\u003eMy \u003ca href=\"https://twitter.com/search?q=%23js1k\u0026amp;src=hash\"\u003e#js1k\u003c/a\u003e uses `t[Math.random()]=insert`, for-in loops and `delete t[i]` rather than push and splice. Saving bytes with jscrush\u003c/p\u003e\u0026mdash; Gaëtan Renaudeau (@greweb) \u003ca href=\"https://twitter.com/greweb/statuses/439324052403277824\"\u003e28 Février 2014\u003c/a\u003e\u003c/blockquote\u003e\n\n\n\u003cul\u003e\n\u003cli\u003eUse just \u003cstrong\u003eone letter variable names\u003c/strong\u003e (mangling variables won\u0026#39;t work because they are in window scope, and IMHO it is better for you to write them by hand)\u003c/li\u003e\n\u003cli\u003eYou will probably need to \u003cstrong\u003einitialize some variables\u003c/strong\u003e, but do it only if necessary (if you have \u003ccode\u003eReferenceError\u003c/code\u003e) and \u003cstrong\u003euse the multi-assignment syntax\u003c/strong\u003e: \u003ccode\u003eA = B = 0\u003c/code\u003e if you can. You should never have constant variables, it saves bytes to directly use the value inline.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ewith(c){ ... }\u003c/code\u003e\u003c/strong\u003e in your main loop may save bytes. It makes all functions and properties of c (the drawing context) in the scope.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"language-tricks\"\u003eLanguage tricks\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eNever use \u003ccode\u003evar\u003c/code\u003e\u003c/strong\u003e, just put everything in \u003ccode\u003ewindow\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProgrammatically aliasing \u003ccode\u003ec\u003c/code\u003e\u0026#39;s method\u003c/strong\u003e may save you a lot of bytes (or may not, you have to check!). You also have to find the code which suit the best your use case. Be careful about collision. Here is mine: \u003ccode\u003efor (e in c) c[e[0]+e[2]+(e[6]||\u0026quot;\u0026quot;)] = c[e];\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eDo not waste ANY value returned by assignment and operators (i++, x=.., x+=...). I\u0026#39;m sure you can do it somewhere else!\nTypical example:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003ex += vx; y += vy; /* ... */ fillRect(x, y, s, s); // NOPE!\n/* ... */ fillRect(x += vx, y += vy, s, s); // YES!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eTry to not separate update from drawing logic. Mixing them may save bytes.\u003c/li\u003e\n\u003cli\u003eYou don\u0026#39;t want to use \u003ccode\u003eaddEventListener\u003c/code\u003e, just define listeners straight on window! e.g. \u003ccode\u003eonclick = function(){...\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"make-your-js1k-now\"\u003eMake your JS1K now!\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"http://js1k.com/2014-dragons/demo/1790\"\u003e\u003cimg src=\"/images/2014/03/js1k_3.png\" alt=\"\" class=\"thumbnail-left\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI\u0026#39;m really eager to see all JS1K entries \nbecause I usually enjoy reading people\u0026#39;s code and \nespecially all the crazy tricks that I can learn from your code :-)\u003c/p\u003e\n\u003cp\u003eThis article was just sharing a bunch of tricks which work for my entry,\nbut you will find much better tricks for your demo -\nso please do it and make your crazy work!\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003eSpecial thanks to \u003ca href=\"http://twitter.com/mrspeaker\"\u003e@mrspeaker\u003c/a\u003e for fixing my English\u003c/em\u003e.\u003c/p\u003e\n","data":{"title":"Panzer Dragoon 1k","description":"Panzer Dragoon 1k is a 2D remake of Panzer Dragoon in 1k of JavaScript I made for JS1K 2014","thumbnail":"/images/2014/03/js1k.png","author":"Gaetan","layout":"post","tags":["gamedev","js1k","javascript","canvas"]}},"__N_SSG":true},"page":"/[year]/[month]/[slug]","query":{"year":"2014","month":"03","slug":"panzer-dragoon-1k"},"buildId":"F2yQ5leE89DP0W3PbwaMO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>